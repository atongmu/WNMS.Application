@{
    Layout = null;
}
@using WNMS.Model.DataModels;
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>@ViewBag.StationName</title>
    <link href="../../css/hyl.css" rel="stylesheet" />
    <link rel="Shortcut Icon" href="~/UploadImg/Logo/logo.png" />
    <link href="../../css/AdminLTE.lite.css" rel="stylesheet" />
    <link href="../../css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../css/font-awesome.css" rel="stylesheet" />
    <link href="../../css/zlw.css" rel="stylesheet" />
    <link href="../../css/set_10.css" rel="stylesheet" />
    @*<link href="//at.alicdn.com/t/font_1545052_hvghkazl5sa.css" rel="stylesheet" />*@
    <link href="~/css/ztreefont.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../css/font-awesome.css">
    <link href="../../css/sl_bengfang.css" rel="stylesheet" />
    <script src="../../js/jquery-1.12.4.min.js"></script>
    <script src="~/lib/layer/layer.js"></script>
    <link rel="stylesheet" href="../../css/gdmap.css">
    <link href="../../css/xiniconfont.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../css/fbmap.css">
    <!-- 地图 -->
    <link href="~/leafletmap/css/leaflet.css" rel="stylesheet" />
    <script src="~/leafletmap/1.3.1/leaflet.js"></script>
    <script src="~/leafletmap/lib/esri-leaflet-v3.0.4/esri-leaflet.js"></script>
    <script src="~/leafletmap/plugins/Proj4Leaflet-master/proj4.js"></script>
    <script src="~/leafletmap/plugins/Proj4Leaflet-master/proj4leaflet.js"></script>

    <style>
        .leaflet-control-attribution {
            display: none !important;
        }
        /*.leaflet-div-icon {
                                                                    background: none;
                                                                    border: none;
                                                                }*/
        html {
            height: 100%;
        }

        .nav-tabs-custom > .nav-tabs > li > a:hover {
            background: #d2ebff !important;
            color: #333 !important;
        }

        .nav-tabs-custom > .tab-content {
            padding: 10px 0
        }

        .nav-tabs-custom > .nav-tabs > li {
            margin-right: 0
        }

        body {
            height: 100%;
            overflow: hidden;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .form-control:focus {
            box-shadow: none
        }

        .detail_main {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .detail_qh {
            padding: 9px 0 0 50px;
            height: 40px;
            box-sizing: border-box;
            float: left;
        }

            .detail_qh ul {
                display: block;
            }

                .detail_qh ul li {
                    float: left;
                }

        .layui-layer-content {
            height: calc(100% - 90px)
        }

        /**
                                                                 * 参数表格
                                                                */
        .table-parameter {
            display: flex;
            flex-wrap: wrap;
            text-align: center;
            font-size: 0;
            border-left: 1px solid #e7e7e7;
            border-top: 1px solid #e7e7e7;
        }

            .table-parameter li {
                display: flex;
                align-items: center;
                padding-left: 0 !important;
                border-right: 1px solid #e7e7e7;
                border-bottom: 1px solid #e7e7e7;
            }

            .table-parameter .name {
                width: 140px;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                text-align: center;
                padding: 5px 3px;
                font-size: 13px;
                line-height: 20px;
                color: #020b1e;
                background-color: #f2f6fa;
                border-right: 1px solid #e7e7e7;
            }

            .table-parameter .value {
                flex: 1;
                font-size: 13px;
                line-height: 30px;
                color: #02153f;
            }

        .table-parameter-2 li {
            width: 50%;
        }

        .nav-tabs-custom > .tab-content {
            padding-top: 0;
        }

        .panel-section {
            position: relative;
            padding-top: 35px;
            padding-bottom: 10px;
        }

            .panel-section .messages_title1 {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                margin: 0;
            }

                .panel-section .messages_title1 .btn-group {
                    position: absolute;
                    top: 0;
                    right: 0;
                }

                    .panel-section .messages_title1 .btn-group .btn {
                        float: left;
                        margin-left: 10px;
                        font-size: 14px;
                        line-height: 30px;
                        color: #3c8dbc;
                        background: none;
                        border: none;
                    }

                        .panel-section .messages_title1 .btn-group .btn i {
                            position: relative;
                            top: -2px;
                            float: left;
                            margin-right: 5px;
                            font-size: 16px;
                            line-height: 30px;
                        }

                            .panel-section .messages_title1 .btn-group .btn i.fr {
                                float: right;
                                margin-right: 0;
                                margin-left: 5px;
                            }

        .panel-section-content {
            height: 100%;
            overflow-y: auto;
        }

        .IsHandle {
            color: #afbbbb !important
        }
    </style>
</head>
<body>
    <div class="zlww_ss"></div>
    <div class="bf_top form-inline clearfloat">
        <span class="title left">@ViewBag.StationName</span>
        <div class="detail_qh">
            <ul class="clearfloat">
                <li class="btn4act" onclick="LoadGui(0)">
                    <div class="set_10_button4 btn4 ">
                        <div class="icon">★</div>
                        <span>总览设备</span>
                    </div>
                </li>
                @{
                    var partitionl = ViewBag.partitionList as List<byte>;
                    foreach (var item in partitionl)
                    {
                        if (item == 1)
                        {
                            <li onclick="LoadGui(@item)">
                                <div class="set_10_button4 btn4">
                                    <div class="icon">★</div>
                                    <span>低区</span>
                                </div>
                            </li>
                        }
                        else if (item == 2)
                        {
                            <li onclick="LoadGui(@item)">
                                <div class="set_10_button4 btn4">
                                    <div class="icon">★</div>
                                    <span>中区</span>
                                </div>
                            </li>
                        }
                        else if (item == 3)
                        {
                            <li onclick="LoadGui(@item)">
                                <div class="set_10_button4 btn4">
                                    <div class="icon">★</div>
                                    <span>高区</span>
                                </div>
                            </li>
                        }
                        else if (item == 4)
                        {
                            <li onclick="LoadGui(@item)">
                                <div class="set_10_button4 btn4">
                                    <div class="icon">★</div>
                                    <span>超高区</span>
                                </div>
                            </li>
                        }
                        else if (item == 5)
                        {
                            <li onclick="LoadGui(@item)">
                                <div class="set_10_button4 btn4">
                                    <div class="icon">★</div>
                                    <span>超超高区</span>
                                </div>
                            </li>
                        }
                    }
                    <li onclick="Load3D()">
                        <div class="set_10_button4 btn4">
                            <div class="icon">★</div>
                            <span>3D</span>
                        </div>
                    </li>
                }
            </ul>
        </div>
        @*<div class="right">
        <label class="hyl_label">刷新频率(s)：</label>
        <select id="timelevle" class="hyl_select">
        <option value="30">30秒</option>
        <option value="60">1分钟</option>
        <option value="300" selected>5分钟</option>
        </select>
        </div>*@
    </div>

    <div class="bf_main">
        <div class="gy_img">
            <div class="detail_main">
                <iframe id="GUI" name="GUI" src="" style="height:100%;width:100%;border:none"></iframe>
            </div>
            <script>
                $(function () {
                    $(".detail_qh ul li").click(function () {
                        $(this).siblings('.detail_qh ul li').removeClass('btn4act');  // 删除其他兄弟元素的样式
                        $(this).addClass('btn4act');                            // 添加当前元素的样式
                    });
                });
            </script>
            <!-- <iframe src="~/pages/gyt/index.html" style="height:96%;width:100%;border:none"></iframe> -->
        </div>
        <!-- tab -->
        <div class="bf_tab nav-tabs-custom">
            <ul class="nav nav-tabs">
                <li class="active"><a href="#home" data-toggle="tab">泵站详情</a></li>
                <li><a href="#profile" data-toggle="tab">报警监控</a></li>
                <li><a href="#messages" data-toggle="tab">远程控制</a></li>
            </ul>
            <div class="tab-content" style="height:calc(100% - 34px)">
                <!-- 泵站详情 -->
                <div class="tab-pane active" id="home" style="height:100%;">
                    <div class="panel-section" style="height: 30%;">
                        <div class="messages_title1">
                            <div class="title">泵房统计</div>
                            <div class="btn-group">
                                <button type="button" id="moredata" class="btn">更多<i class="fr fa fa-angle-double-right"></i></button>
                            </div>
                        </div>

                        <div class="panel-section-content">
                            <ul class="table-parameter table-parameter-col2" id="sbzt">
                                <li>
                                    <div class="name">总电量</div>
                                    <div class="value">
                                        <span id="EnergyCon">0</span> kW·h
                                    </div>
                                </li>
                                <li>
                                    <div class="name">总流量</div>
                                    <div class="value">
                                        <span id="FlowCon">0</span> m³
                                    </div>
                                </li>
                                <li>
                                    <div class="name">吨水耗电</div>
                                    <div class="value">
                                        <span id="TonWater">0</span> kW·h/m³
                                    </div>
                                </li>
                                <li>
                                    <div class="name">余氯</div>
                                    <div class="value">
                                        <span id="cl">0</span> mg/L
                                    </div>
                                </li>
                                <li>
                                    <div class="name">浊度</div>
                                    <div class="value">
                                        <span id="tb">0</span> NTU
                                    </div>
                                </li>
                                <li>
                                    <div class="name">PH</div>
                                    <div class="value">
                                        <span id="ph">0</span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>

                    @*<ul class="clearfloat bf_list">
                    <li><p><span>总&nbsp;电&nbsp;量：</span><strong class="pr5px" id="EnergyCon">0</strong>kW·h</p></li>
                    <li><p><span>总&nbsp;流&nbsp;量：</span><strong class="pr5px" id="FlowCon">0</strong>m³</p></li>
                    <li><p><span>吨水耗电：</span><strong class="pr5px" id="TonWater">0</strong>kW·h/m³</p></li>
                    </ul>
                    <p class="messages_title1">实时数据</p>
                    <div class="bfxq_sj">
                    <div class="bfxq_sj_cli">
                    <img src="../../images/cl.png" />
                    <div class="bfxq_sj_cli_c">
                    <h3>余氯(mg/L)</h3>
                    <strong id="cl">0</strong>
                    </div>
                    </div>
                    <div class="bfxq_sj_cli">
                    <img src="../../images/zhuodu.png" />
                    <div class="bfxq_sj_cli_c">
                    <h3>浊度(NTU)</h3>
                    <strong id="tb">0</strong>
                    </div>
                    </div>
                    <div class="bfxq_sj_cli">
                    <img src="../../images/ph.png" />
                    <div class="bfxq_sj_cli_c">
                    <h3>PH</h3>
                    <strong id="ph">0</strong>
                    </div>
                    </div>
                    <p class="messages_title clear">
                    <span id="moredata" style="cursor:pointer;padding-left:8px">
                    更多
                    <i class="glyphicon glyphicon-menu-right"></i>
                    <i class="glyphicon glyphicon-menu-right" style="position: relative;left: -12px;"></i>
                    </span>

                    </p>
                    </div>*@

                    <!--map-->
                    <div class="panel-section height-30 bf-map" style="height: 35%;">
                        @*<p class="bf-tabs">
                        <span>视频监控</span>
                        <span class="ons">地图鹰眼</span>
                        </p>*@
                        <p class="messages_title1">地图鹰眼</p>
                        <div class="panel-section-content tabBox">
                            @*<div class="hidden jk-box relative">
                            <p><img src="../../images/null.png" /><span>暂无</span></p>
                            <iframe id="camera" src="" style="height:100%;border:none"></iframe>
                            </div>*@
                            <div id="gdmap" class="gdmaps"></div>
                        </div>
                    </div>

                    <div class="panel-section height-30 bf-lb" style="height: 35%;">
                        <p class="messages_title1">泵房样貌</p>
                        <!--轮播-->
                        <div id="myCarousel" class="panel-section-content carousel slide">
                            @{
                                var images = ViewBag.imgList as List<Attachment>;
                                int k = 1;
                                <ol class="carousel-indicators">
                                    @if (images.Count != 0)
                                    {
                                        for (var i = 0; i < images.Count; i++)
                                        {
                                            <li data-target="#myCarousel" data-slide-to="@i"></li>
                                        }
                                    }
                                    else
                                    {
                                        <li data-target="#myCarousel" data-slide-to="0"></li>
                                    }

                                </ol>
                            }
                            <!-- 轮播（Carousel）指标 -->
                            @*<ol class="carousel-indicators">
                            <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                            <li data-target="#myCarousel" data-slide-to="1"></li>
                            <li data-target="#myCarousel" data-slide-to="2"></li>
                            </ol>*@
                            <!-- 轮播（Carousel）项目 -->
                            <div class="carousel-inner">
                                @if (images.Count != 0)
                                {
                                    foreach (var item in images)
                                    {
                                        if (k == 1)
                                        {
                                            <div class="item active" style="background:url(@item.FileUrl) no-repeat left center;background-size:cover">
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="item" style="background:url(@item.FileUrl) no-repeat left center;background-size:cover">
                                            </div>
                                        }

                                    }
                                }
                                else
                                {
                                    <div class="item active" style="background:url('../../images/bflook.jpg') no-repeat left center;background-size:cover">
                                    </div>
                                }


                            </div>
                            <!-- 轮播（Carousel）导航 -->
                            <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
                                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                            <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
                                <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        </div>
                    </div>
                </div>
                <!-- 报警控制 -->
                <div class="tab-pane" id="profile">
                    <div class="tab2cont">
                        <ul id="eventList">
                            @{
                                var eventList = ViewBag.eventInfo as List<dynamic>;
                                if (eventList.Count > 0)
                                {
                                    foreach (var item in eventList)
                                    {
                                        var uniqueID = item.RTUID + "" + item.EventSource;
                                        <li id="@uniqueID">
                                            <div class="bfxq_list_t">

                                                @if (item.EventLevel == 3)
                                                {
                                                    <img class="" src="../../images/deviceAlarm3.png" alt="">
                                                    <div class="bfxq_list_b_msg">
                                                        <p>@item.EventTime</p>
                                                        <h3>@item.EventMessage</h3>
                                                    </div>
                                                    if (item.IsHandle == 1)
                                                    {
                                                        <p class="right bfxq_list_b_jj">
                                                            <i class="glyphicon glyphicon-edit IsHandle" onclick="HandleEvent(true,'@item.EventMessage','@item.EventTime',@item.RTUID,@item.EventSource)"></i>
                                                            &nbsp;提示性报警
                                                        </p>
                                                    }
                                                    else
                                                    {
                                                        <p class="right bfxq_list_b_jj">
                                                            <i class="glyphicon glyphicon-edit" onclick="HandleEvent(false,'@item.EventMessage','@item.EventTime',@item.RTUID,@item.EventSource)"></i>
                                                            &nbsp;提示性报警
                                                        </p>
                                                    }

                                                }
                                                else if (item.EventLevel == 2)
                                                {
                                                    <img class="" src="../../images/deviceAlarm2.png" alt="">
                                                    <div class="bfxq_list_b_msg">
                                                        <p>@item.EventTime</p>
                                                        <h3>@item.EventMessage</h3>
                                                    </div>
                                                    if (item.IsHandle == 1)
                                                    {
                                                        <p class="right bfxq_list_b_jj">
                                                            <i class="glyphicon glyphicon-edit IsHandle" onclick="HandleEvent(true,'@item.EventMessage','@item.EventTime',@item.RTUID,@item.EventSource)"></i>
                                                            &nbsp;一般性报警
                                                        </p>
                                                    }
                                                    else
                                                    {
                                                        <p class="right bfxq_list_b_jj">
                                                            <i class="glyphicon glyphicon-edit" onclick="HandleEvent(false,'@item.EventMessage','@item.EventTime',@item.RTUID,@item.EventSource)"></i>
                                                            &nbsp;一般性报警
                                                        </p>
                                                    }
                                                }
                                                else
                                                {
                                                    <img class="" src="../../images/deviceAlarm1.png" alt="">
                                                    <div class="bfxq_list_b_msg">
                                                        <p>@item.EventTime</p>
                                                        <h3>@item.EventMessage</h3>
                                                    </div>
                                                    if (item.IsHandle == 1)
                                                    {
                                                        <p class="right bfxq_list_b_jj">
                                                            <i class="glyphicon glyphicon-edit IsHandle" onclick="HandleEvent(true,'@item.EventMessage','@item.EventTime',@item.RTUID,@item.EventSource)"></i>
                                                            &nbsp;紧急报警
                                                        </p>
                                                    }
                                                    else
                                                    {
                                                        <p class="right bfxq_list_b_jj">
                                                            <i class="glyphicon glyphicon-edit" onclick="HandleEvent(false,'@item.EventMessage','@item.EventTime',@item.RTUID,@item.EventSource)"></i>
                                                            &nbsp;紧急报警
                                                        </p>
                                                    }
                                                }

                                            </div>
                                            <div class="bfxq_list_b">
                                                @{
                                                    TimeSpan ts = DateTime.Now - Convert.ToDateTime(item.EventTime);
                                                    var times = ts.Days + "天" + ts.Hours + "时" + ts.Minutes + "分" + ts.Seconds + "秒";
                                                    var currentValue = item.CurrentValue.ToString() == "-9999" ? "--" : item.CurrentValue.ToString();
                                                    var limitValue = item.LimitValue.ToString() == "-9999" ? "--" : item.LimitValue.ToString();
                                                    <p>
                                                        <span>持续时间：@times</span>
                                                        <span class="right"><var style="color: red;font-weight: 600;">@currentValue</var>/@limitValue </span>
                                                    </p>
                                                }

                                            </div>
                                        </li>
                                    }

                                }


                            }
                        </ul>
                        <div class="textCenter" style="position:absolute;top:50%;width:100%;transform: translateY(-50%)" id="eventnull">
                            <img src="~/images/null.png" width="150" />
                            <p class="f14px gray">暂无数据</p>
                        </div>
                    </div>
                </div>

                <!-- 远程控制 -->
                <div class="tab-pane" id="messages">
                    <div class="tab3cont">
                        @{
                            if (ViewBag.iscontoroller_bengfang == true)
                            {
                                <p class="messages_title1">泵房控制</p>
                                <div class="yckz_img_list">
                                    <ul class="clearfloat">
                                        <li onclick="StationCommand('open_ligth')">
                                            <i class="iconfont icon-dengpao"></i>
                                            <h6>开灯</h6>
                                        </li>
                                        <li onclick="StationCommand('open_door')">
                                            <i class="iconfont icon-IOTtubiao_huabanfuben"></i>
                                            <h6>开门</h6>
                                        </li>
                                        <li onclick="StationCommand('open_dehumidifier')">
                                            <i class="iconfont icon-tubiao-chushiji"></i>
                                            <h6>启动除湿机</h6>
                                        </li>
                                        <li onclick="StationCommand('open_stavalve')">
                                            <i class="iconfont icon-famen"></i>
                                            <h6>控制阀门</h6>
                                        </li>
                                    </ul>
                                </div>
                                <div class="yckz_img_list">
                                    <ul class="clearfloat">
                                        <li onclick="StationCommand('clear_ligth')">
                                            <i class="iconfont icon-tingzhi"></i>
                                            <h6>关灯</h6>
                                        </li>
                                        <li onclick="StationCommand('clear_door')">
                                            <i class="iconfont icon-menjinfangkeguanli"></i>
                                            <h6>关门</h6>
                                        </li>
                                        <li onclick="StationCommand('clear_dehumidifier')">
                                            <i class="iconfont icon-tubiao-chushijixian"></i>
                                            <h6>关闭除湿机</h6>
                                        </li>
                                        @*<li onclick="StationCommand('clear_stavalve')">
                                            <i class="iconfont icon-famen1"></i>
                                            <h6>关闭阀门</h6>
                                </li>*@
                                    </ul>
                                </div>
                            }
                            else
                            {
                                @*<div class="textCenter" style="position:absolute;top:50%;width:100%;transform: translateY(-50%)">
                        <img src="~/images/null.png" width="150" />
                        <p class="f14px gray">暂无数据</p>
                        </div>*@
                                <div class="yckz_img_list">
                                    <ul>
                                    </ul>
                                </div>
                            }

                        }


                        @{
                            if (ViewBag.iscontoroller == true)
                            {
                                var partitionk = ViewBag.partitionList as List<byte>;
                                foreach (var itemk in partitionk)
                                {
                                    if (itemk == 1)
                                    {
                                        <p class="messages_title1">低区 - 设备控制</p>
                                    }
                                    else if (itemk == 2)
                                    {
                                        <p class="messages_title1">中区 - 设备控制</p>
                                    }
                                    else if (itemk == 3)
                                    {
                                        <p class="messages_title1">高区 - 设备控制</p>
                                    }
                                    else if (itemk == 4)
                                    {
                                        <p class="messages_title1">超高区 - 设备控制</p>
                                    }
                                    else if (itemk == 5)
                                    {
                                        <p class="messages_title1">超超高区 - 设备控制</p>
                                    }
                                    else if (itemk == 6)
                                    {
                                        <p class="messages_title1">智能泵房 - 设备控制</p>
                                    }

                                    <div class="yckz_img_list">
                                        <ul class="clearfloat">
                                            <li onclick="RemoteCommand(@itemk,'start')" data-id="@itemk" data-value="start">
                                                <i class="iconfont icon-qidong"></i>
                                                <h6>启动</h6>
                                            </li>
                                            <li onclick="RemoteCommand(@itemk,'stop')">
                                                <i class="iconfont  icon-tingzhi"></i>
                                                <h6>停止</h6>
                                            </li>
                                            <li onclick="RemoteCommand(@itemk,'setpress')">
                                                <i class="iconfont icon-panel"></i>
                                                <h6>设定压力</h6>
                                            </li>
                                            <li onclick="RemoteCommand(@itemk,'VFDReset')">
                                                <i class="iconfont icon-icon-refresh"></i>
                                                <h6>变频复位</h6>
                                            </li>
                                        </ul>
                                    </div>
                                }
                            }
                            else
                            {
                                <div class="yckz_img_list">
                                    <ul>
                                    </ul>
                                </div>

                            }

                            if (ViewBag.iscontoroller_bengfang == false && ViewBag.iscontoroller == false)
                            {
                                <div class="textCenter" style="position:absolute;top:50%;width:100%;transform: translateY(-50%)">
                                    <img src="~/images/null.png" width="150" />
                                    <p class="f14px gray">暂无数据</p>
                                </div>
                            }

                        }
                    </div>
                </div>

                <!-- 灯控制
                <div id="light" class="tab-pane">

                </div>-->
                <!-- 除湿器控制
                <div id="exsiccator" class="tab-pane"></div>-->
            </div>
        </div>

    </div>
    <!-- 收缩按钮 -->


    <script>

        // 点击收缩
        $('.zlww_ss').click(function () {
            if ($(".zlww_ss").hasClass("ss_active")) {
                $('.bf_tab').css('right', '0px');
                $(".gy_img").css('width', 'calc(100% - 480px)');
                $('.zlww_ss').css('right', '480px').removeClass('ss_active');
                $('.zlww_ss').css('background-image', 'url(../../images/黑色收缩.svg)')
            } else {
                $('.bf_tab').css('right', '-480px');
                $(".gy_img").css('width', '100%');
                $('.zlww_ss').css('right', '0px').addClass('ss_active');
                $('.zlww_ss').css('background-image', 'url(../../images/黑色展开.svg)')
            }
        });
    </script>

    <script src="../../js/bootstrap.js"></script>
    <script src="~/js/jquery.signalR-2.2.1.min.js"></script>
    <script>
        var sid = @ViewBag.sid;
        var parid = @ViewBag.parid;
        var selectvalue = 0;
        var selectname = "";
        var pparid = 1;
        var myVar;
        var iszong = 0;
        var startTime = new Date(2017, 06, 06);
        var zongGui = '@ViewBag.guiPage'
        var paridArray = [];
        $(function () {
            if ($("#eventList li").length == 0) {
                $("#eventnull").css("display", "block");
            }
            else {
                $("#eventnull").css("display", "none");
            }
            $(".bf-tabs span").click(function () {
                $(this).addClass("ons").siblings("span").removeClass("ons");
                var indx = $(this).index();
                $(".tabBox div").eq(indx).removeClass("hidden").siblings("div").addClass("hidden");
                if (indx == 0) {
                    $("#camera").attr("src", "/Sws/Sws_Detail/CameraDetail/" + sid);
                }
            })
            //显示远程控制tab
            if (@ViewBag.ShowTab!= 1) {
                $(".nav-tabs li:nth-child(@ViewBag.ShowTab)").addClass('active').siblings('li').removeClass('active');
                $(".tab-content div:nth-child(@ViewBag.ShowTab)").addClass('active').siblings('div').removeClass('active');

            }

            $(".nav-tabs li:nth-child(1)").addClass('active').siblings('li').removeClass('active');
            $(".tab-content div:nth-child(1)").addClass('active').siblings('div').removeClass('active');

            //clearInterval(myVar);
            myVar = setInterval(function () {
                QueryEventJkList(1);//报警列表

            }, 300 * 1000);
            //myVar = setInterval(function () {
            //        LoadStationStatistics();
            //        LoadStationEvent();
            //        if (iszong == 0) {
            //            //$("#GUI")[0].contentWindow().LoadPartionNum();
            //            this.frames["GUI"].LoadPartionNum();
            //             LoadMapData();
            //        } else {
            //            //$("#GUI")[0].contentWindow().LoadStationJKPartuion();
            //            this.frames["GUI"].LoadStationJKPartuion();
            //        }

            //    }, $("#timelevle").val() * 1000);
            
            LoadGui("0");
            LoadTemInfo(0)
            //LoadStationStatistics();
            //LoadMapData();
            // LoadStationJKPartuion("1")

            //$("#timelevle").change(function () {
            //    clearInterval(myVar);
            //    myVar = setInterval(function () {
            //        LoadStationStatistics();
            //        LoadStationEvent();
            //        if (iszong == 0) {
            //            //$("#GUI")[0].contentWindow().LoadPartionNum();
            //            this.frames["GUI"].LoadPartionNum();
            //        } else {
            //            //$("#GUI")[0].contentWindow().LoadStationJKPartuion();
            //            this.frames["GUI"].LoadStationJKPartuion();
            //        }
            //        LoadMapData();
            //    }, $("#timelevle").val() * 1000);
            //})
            //signalRUpdate();

            signalRUpdate();

        })
        function signalRUpdate() {

            var url = "@ViewBag.signalrHubs";

            var conn = $.hubConnection(url);
            conn.qs = { "staionID": sid };

            var chart = conn.createHubProxy('updateDataHub');//updateDataHub//messageHub

            chart.on('revMsg', function (id, pumpNum, partition) {
                //LoadStationStatistics();右侧泵房统计信息

                //LoadMapData();//总工艺图信息以及泵房位置
                if (iszong == 0) {
                    if ($("#GUI")[0].contentWindow.LoadHpartition && partition != 6) {
                        $("#GUI")[0].contentWindow.LoadHpartition(paridArray[partition], partition, pumpNum);
                    }
                    LoadDataInfo(0);
                    $("#GUI")[0].contentWindow.LoadMapData();
                    $("#GUI")[0].contentWindow.LoadshuixiangData();
                } else {
                    if (partition == parid) {
                        if ($("#GUI")[0].contentWindow.LoadStationJKPartuion && partition != 6) {
                            $("#GUI")[0].contentWindow.LoadStationJKPartuion();
                        }
                    }

                }


            });
            //日志输出，以备调试使用

            // 开启hub连接
            conn.start().done(function () {
                console.log("connection is ok");
            }).fail(function () {
                console.log("connection is error");
            });
            conn.disconnected(function () {
                console.log("断开");
                //setTimeout(function () {
                //     conn.start();
                //}, 5000); // Restart connection after 5 seconds.
            });

        }
        //点击分区 获取对应的工艺图
        function LoadGui(partionid) {
            if (partionid == 0) {
                iszong = 0;
                $("#GUI").attr("src", zongGui);
                LoadMapData();
                LoadDataInfo(0);
                LoadshuixiangData()

            } else {
                parid = partionid;
                iszong = partionid;
                $.post("/Sws/Sws_Detail/LoadGuiInfo", { sid: sid, partionid: partionid }, function (data) {
                    if (data != "") {
                        $("#GUI").attr("src", data);
                    }
                })
            }
            LoadTemInfo(partionid);
        }

        //点击3D工艺图
        function Load3D() {
            iszong = -1;
        @*$("#GUI").attr("src", "@ViewBag.Threed");*@
                window.open("@ViewBag.Threed");
            LoadTemInfo(0);
        }

        //获取泵房统计数据
        function LoadStationStatistics() {
            $.post("/Sws/Sws_Detail/LoadStationStatistics", { sid: sid }, function (data) {
                if (data != "") {
                    $("#EnergyCon").html(data.energyCon);
                    $("#FlowCon").html(data.flowCon);
                    $("#TonWater").html(data.tonWater);
                }
            })
        }
        ///报警推送开始
        function pushEvent(RTUID, EventSource, EventLevel, EventTime, EventMessage, LevelName, CurrentValue, LimitValue) {

            if ($("#eventnull").css("display") == "block") {

                $("#eventnull").css("display", "none");
            }
            var html = "";
            var uniqueID1 = RTUID + "" + EventSource;
            html += '<li id="' + uniqueID1 + '">';
            html += '<div class="bfxq_list_t">';
            if (EventLevel == 3) {
                html += ' <img class="" src="../../images/deviceAlarm3.png" alt="">';
            } else if (EventLevel == 2) {
                html += ' <img class="" src="../../images/deviceAlarm2.png" alt="">';
            } else if (EventLevel == 1) {
                html += ' <img class="" src="../../images/deviceAlarm1.png" alt="">';
            }
            html += '<div class="bfxq_list_b_msg">';
            html += '<p>' + EventTime + '</p>';
            html += '<h3>' + EventMessage + '</h3>';
            html += '</div>';
            html += ' <p class="right bfxq_list_b_jj">';

            html += " <i class='glyphicon glyphicon-edit' onclick=" + '"' + "HandleEvent(false,'" + EventMessage + "','" + EventTime + "','" + RTUID + "','" + EventSource + "')" + '"' + "'></i> &nbsp;";
            html += '' + LevelName + '';

            html += '</p>';
            html += '</div>';
            html += '<div class="bfxq_list_b">';
            html += '<p>';
            var timeou = diffTime(EventTime, new Date())
            html += '<span>持续时间：' + timeou + '</span>';
            if (LimitValue == "-9999") {
                LimitValue = "--";
            }
            if (CurrentValue == "-9999") {

                CurrentValue = "--";
            }
            html += '<span class="right"><var style="color: red;font-weight: 600;">' + CurrentValue + '</var>/' + LimitValue + ' </span>';
            html += '</p>';
            html += '</div>';
            html += '</li>';

            $("#eventList").prepend(html);


        }
        function removeEvent(uniqueID1) {


            $("#eventList #" + uniqueID1 + "").remove();
            if ($("#eventList li").length == 0) {
                $("#eventnull").css("display", "block");
            }
        }

        ///报警推送结束

        //获取报警信息
        var reg = new RegExp("-", "g");//g,表示全部替换
        function QueryEventJkList(pageindex_) {
            $.post("/Sws/Sws_Detail/LoadEvent", { sid: sid }, function (data) {
                if (data.eventInfo.length > 0) {
                    $("#eventnull").css("display", "none");
                    $("#eventList").empty();
                    var html = "";
                    for (var i = 0; i < data.eventInfo.length; i++) {
                        var uniqueID1 = data.eventInfo[i].RTUID + "" + data.eventInfo[i].EventSource;
                        var event_time = data.eventInfo[i].EventTime.replace(reg, "/").replace("T", " ");
                        html += '<li id="' + uniqueID1 + '">';
                        html += '<div class="bfxq_list_t">';
                        if (data.eventInfo[i].EventLevel == 3) {
                            html += ' <img class="" src="../../images/deviceAlarm3.png" alt="">';
                        } else if (data.eventInfo[i].EventLevel == 2) {
                            html += ' <img class="" src="../../images/deviceAlarm2.png" alt="">';
                        } else if (data.eventInfo[i].EventLevel == 1) {
                            html += ' <img class="" src="../../images/deviceAlarm1.png" alt="">';
                        }
                        html += '<div class="bfxq_list_b_msg">';
                        html += '<p>' + event_time + '</p>';
                        html += '<h3>' + data.eventInfo[i].EventMessage + '</h3>';
                        html += '</div>';
                        html += ' <p class="right bfxq_list_b_jj">';
                        if (data.eventInfo[i].IsHandle == 1) {
                            html += " <i class='glyphicon glyphicon-edit IsHandle' onclick=" + '"' + "HandleEvent(true,'" + data.eventInfo[i].EventMessage + "','" + event_time + "','" + data.eventInfo[i].RTUID + "','" + data.eventInfo[i].EventSource + "')" + '"' + "'></i> &nbsp;";
                            html += '' + data.eventInfo[i].ItemName + '';
                        } else {
                            html += " <i class='glyphicon glyphicon-edit' onclick=" + '"' + "HandleEvent(false,'" + data.eventInfo[i].EventMessage + "','" + event_time + "','" + data.eventInfo[i].RTUID + "','" + data.eventInfo[i].EventSource + "')" + '"' + "'></i> &nbsp;";
                            html += '' + data.eventInfo[i].ItemName + '';
                        }
                        html += '</p>';
                        html += '</div>';
                        html += '<div class="bfxq_list_b">';
                        html += '<p>';
                        var timeou = diffTime(data.eventInfo[i].EventTime, new Date())
                        html += '<span>持续时间：' + timeou + '</span>';
                        if (data.eventInfo[i].LimitValue == "-9999") {
                            html += '<span class="right"><var style="color: red;font-weight: 600;">--</var>/-- </span>';
                        } else {
                            html += '<span class="right"><var style="color: red;font-weight: 600;">' + data.eventInfo[i].CurrentValue + '</var>/' + data.eventInfo[i].LimitValue + ' </span>';
                        }

                        html += '</p>';
                        html += '</div>';
                        html += '</li>';
                    }
                    $("#eventList").append(html);
                }
                else {
                    $("#eventList").empty();
                    $("#eventnull").css("display", "block");
                }
            })
        }
        function diffTime(startDate, endDate) {
            startDate = new Date(startDate);
            endDate = new Date(endDate);
            var diff = endDate.getTime() - startDate.getTime();//时间差的毫秒数
            if (diff < 0) {
                diff = 0;
            }
            //计算出相差天数
            var days = Math.floor(diff / (24 * 3600 * 1000));
            //计算出小时数
            var leave1 = diff % (24 * 3600 * 1000);    //计算天数后剩余的毫秒数
            var hours = Math.floor(leave1 / (3600 * 1000));
            //计算相差分钟数
            var leave2 = leave1 % (3600 * 1000);        //计算小时数后剩余的毫秒数
            var minutes = Math.floor(leave2 / (60 * 1000));
            //计算相差秒数
            var leave3 = leave2 % (60 * 1000);      //计算分钟数后剩余的毫秒数
            var seconds = Math.round(leave3 / 1000);
            var returnStr = seconds + "秒";

            returnStr = minutes + "分" + returnStr;


            returnStr = hours + "小时" + returnStr;


            returnStr = days + "天" + returnStr;

            //if (minutes > 0) {
            //    returnStr = minutes + "分" + returnStr;
            //}
            //if (hours > 0) {
            //    returnStr = hours + "小时" + returnStr;
            //}
            //if (days > 0) {
            //    returnStr = days + "天" + returnStr;
            //}
            return returnStr;
        }

        //报警处理
        function HandleEvent(ishandle, alarmMessage, eventtime, rtuid, eventsouce) {
            if (ishandle == true) {//已处理
                iframe1("报警处理", "500px", "500px", "/Sws/Sws_EventJK/HandleEventPage?" +
                    "ishandle=true&isrefresh=false&alarmMessage=" + encodeURIComponent(alarmMessage) + "&eventtime=" + eventtime + "&rtuid=" + rtuid + "&eventsouce=" + eventsouce + "");
            }
            else {//未处理
                //iframe("报警处理", "500px", "500px", "/Sws/Sws_EventJK/HandleEventPage?"+
                //    "ishandle=false&alarmMessage=" + encodeURIComponent(alarmMessage) + "&eventtime=" + eventtime + "&rtuid=" + rtuid + "&eventsouce=" + eventsouce + " ");
                iframeWithBtns("报警处理", "500px", "500px", "/Sws/Sws_EventJK/HandleEventPage?" +
                    "ishandle=false&isrefresh=false&alarmMessage=" + encodeURIComponent(alarmMessage) + "&eventtime=" + eventtime + "&rtuid=" + rtuid + "&eventsouce=" + eventsouce + " ", false, function (formIndex, formLayer) {
                        var currentIframe = window[formLayer.find('iframe')[0]['name']];
                        currentIframe.saveForm(function (data) {
                            if (data == "ok") {
                                layer.close(formIndex);
                            }
                        });
                    });

            }

        }
        //更多实时监控数据
        $("#moredata").click(function () {
            iframe1("实时数据", "800px", "600px", "/Sws/Sws_Detail/LoadMoreData/" + sid);
        })
        //远程控制
        function RemoteCommand(id, value) {
            var noewdate = new Date();
            var t3 = noewdate - startTime;
            pparid = id;
            if (t3 > 300000) {
                if (value == "start") {
                    selectvalue = 1;
                    TurnOnAction();
                } else if (value == "stop") {
                    selectvalue = 2;
                    TurnOnAction();
                } else if (value == "setpress") {
                    selectvalue = 3;
                    TurnOnAction();
                } else if (value == "VFDReset") {
                    selectvalue = 4;
                    TurnOnAction();
                } else {
                    selectvalue = 100;
                    selectname = value;
                    TurnOnAction();
                }
            } else {
                if (value == "start") {
                    selectvalue = 1;
                } else if (value == "stop") {
                    selectvalue = 2;
                } else if (value == "setpress") {
                    selectvalue = 3;
                } else if (value == "VFDReset") {
                    selectvalue = 4;
                } else {
                    selectvalue = 100;
                    selectname = value;
                }
                functionselect();
            }
        }

        function RemoteCommandSet(id, value) {
            var noewdate = new Date();
            var t3 = noewdate - startTime;
            pparid = id;
            if (t3 > 300000) {
                selectvalue = 101;
                selectname = value;
                TurnOnAction();
            } else {
                selectvalue = 101;
                selectname = value;
                functionselect();
            }
        }
        
        //泵房控制
        function StationCommand(value) {
            var noewdate = new Date();
            var t3 = noewdate - startTime;

            switch (value) {
                case 'open_ligth':
                    selectvalue = 12;
                    break;

                case 'clear_ligth':
                    selectvalue = 11;
                    break;
                case 'open_dehumidifier':
                    selectvalue = 44;
                    break;
                case 'clear_dehumidifier':
                    selectvalue = 45;
                    break;
                case 'open_stavalve':
                    selectvalue = 8;
                    break;
                default:
                    layer.alert("暂无相关设备", { icon: 2 });
                    break;
            }
            if (selectvalue==0){
                return
            }
            if (t3 > 300000) {
                // if (value == "ligth") {
                //     selectvalue = 5;
                //     TurnOnAction();
                // } else if (value == "door") {
                //     selectvalue = 6;
                //     TurnOnAction();
                // } else if (value == "dehumidifier") {
                //     layer.alert("暂无相关设备", { icon: 2 });
                //     //selectvalue = 7;
                //     //TurnOnAction();
                // } else if (value == "stavalve") {
                //     selectvalue = 8;
                //     TurnOnAction();
                // }
                TurnOnAction()
            } else {
                // if (value == "ligth") {
                //     selectvalue = 5;
                // } else if (value == "door") {
                //     selectvalue = 6;
                // } else if (value == "dehumidifier") {
                //     selectvalue = 7;
                //     layer.alert("暂无相关设备", { icon: 2 });
                //     return false;
                // } else if (value == "stavalve") {
                //     selectvalue = 8;
                // }
                functionselect();
            }
            //if (value == "ligth") {
            //    selectvalue = 5;
            //    TurnOnAction();
            //} else if (value == "door") {
            //     selectvalue = 6;
            //    TurnOnAction();
            //}else if (value == "dehumidifier") {
            //     selectvalue = 7;
            //    TurnOnAction();
            //}else if (value == "stavalve") {
            //     selectvalue = 8;
            //    TurnOnAction();
            //}
        }
        //权限验证
        function TurnOnAction() {
            iframeWithBtns("用户名确认", "400px", "300px", "/Sws/Sws_RemoteCommand/CheckUser", false, function (formIndex, formLayer) {
                var currentIframe = window[formLayer.find('iframe')[0]['name']];
                currentIframe.saveForm(function (data) {
                    if (data == "ok") {
                        layer.close(formIndex);
                    }
                });
            });
            //iframe("用户名确认", "500px", "50%", "/Sws/Sws_RemoteCommand/CheckUser");
        }
        function functionselect() {
            if (selectvalue == 1)
                TurnOnCommi();//权限和用户验证通过后
            if (selectvalue == 2)
                TurnOffCommi();
            if (selectvalue == 3)
                SetPressureCommi()
            if (selectvalue == 4)
                VFDResetCommi();
            if (selectvalue == 11 || selectvalue == 12)
                OpenligthCommi(selectvalue);
            if (selectvalue == 44 || selectvalue == 45)
                OpenDehumidifierCommi(selectvalue);
            if (selectvalue == 6)
                OpenDoorCommi();
            if (selectvalue == 7) { }
            if (selectvalue == 8) {
                OpenFaCommi();
            }
            if (selectvalue == 100) {
                SpRemote(selectname);
            }
            if (selectvalue == 101) {
                SetAllValue(selectname);
            }
        }
        //启动
        function TurnOnCommi() {//验证通过后发送设备启动指示
            $.post("/Sws/Sws_RemoteCommand/LoadTurnOn", { sid: sid, paid: pparid }, function (data) {
                var aa = eval(data);
                var json = JSON.parse(aa);
                layer.alert(json["Message"]);
            });
        }
        //关闭
        function TurnOffCommi() {
            $.post("/Sws/Sws_RemoteCommand/LoadTurnOff", { sid: sid, paid: pparid }, function (data) {
                var aa = eval(data);
                var json = JSON.parse(aa);
                layer.alert(json["Message"]);
            });
        }
        //设定压力
        function SetPressureCommi() {
            iframeWithBtns("设定压力设置", "500px", "300px", "/Sws/Sws_RemoteCommand/SetPressure?sid=" + sid + "&&paid=" + pparid, false, function (formIndex, formLayer) {
                var currentIframe = window[formLayer.find('iframe')[0]['name']];
                currentIframe.saveForm(function (data) {
                    if (data == "ok") {
                        layer.close(formIndex);
                    }
                });
            });
            //iframe("设定压力设置", "300px", "40%", "/Sws/Sws_RemoteCommand/SetPressure?sid=" + sid + "&&paid=" + pparid);
        }
        //变频复位
        function VFDResetCommi() {
            $.post("/Sws/Sws_RemoteCommand/LoadVFDReset", { sid: sid, paid: pparid }, function (data) {
                if (data.indexOf("权限") > -1) {
                    layer.alert("权限验证不通过！");
                } else {
                    var aa = eval(data);
                    var json = JSON.parse(aa);
                    layer.alert(json["Message"]);
                }

            });
        }
        //开门
        function OpenDoorCommi() {
            $.post("/Sws/Sws_RemoteCommand/LoadOpenDoor", { sid: sid, paid: pparid }, function (data) {
                var aa = eval(data);
                var json = JSON.parse(aa);
                layer.alert(json["Message"]);
            });
        }
        //开灯
        function OpenligthCommi(value) {
            $.post("/Sws/Sws_RemoteCommand/LoadOpenligth", { sid: sid, paid: pparid, value: value }, function (data) {
                var aa = eval(data);
                var json = JSON.parse(aa);
                layer.alert(json["Message"]);
            });
        }
        //除湿器
        function OpenDehumidifierCommi(value) {
            $.post("/Sws/Sws_RemoteCommand/LoadOpenDehumidifier", { sid: sid, paid: pparid, value: value }, function (data) {
                var aa = eval(data);
                var json = JSON.parse(aa);
                layer.alert(json["Message"]);
            });
        }
        //开阀门
        function OpenFaCommi() {
            iframe1("阀门控制", "500px", "500px", "/Sws/Sws_Detail/LoadFa?id=" + sid + "&type=1");
            //$.post("/Sws/Sws_RemoteCommand/LoadOpenFa", { sid: sid, paid: pparid }, function (data) {
            //    var aa = eval(data);
            //    var json = JSON.parse(aa);
            //    layer.alert(json["Message"]);
            //});
        }

        //阀门和泵的启停
        function SpRemote(cmtype) {
            $.post("/Sws/Sws_RemoteCommand/LoadRemote", { sid: sid, paid: pparid, cmtype: cmtype }, function (data) {
                if (data.indexOf("权限") > -1) {
                    layer.alert("权限验证不通过！");
                } else {
                    var aa = eval(data);
                    var json = JSON.parse(aa);
                    layer.alert(json["Message"]);
                }

            });
        }
        //设定各个参数值
        function SetAllValue(selectname) {
            iframeWithBtns("设定设置", "500px", "300px", "/Sws/Sws_RemoteCommand/SetAllValue?sid=" + sid + "&&paid=" + pparid + "&&cmtype=" + selectname, false, function (formIndex, formLayer) {
                var currentIframe = window[formLayer.find('iframe')[0]['name']];
                currentIframe.saveForm(function (data) {
                    if (data == "ok") {
                        layer.close(formIndex);
                    }
                });
            });
            //iframe("设定压力设置", "300px", "40%", "/Sws/Sws_RemoteCommand/SetPressure?sid=" + sid + "&&paid=" + pparid);
        }

        function iframe1(title, width, height, url) {
            layer.open({
                type: 2,
                title: title,
                shadeClose: true,
                shade: 0.7,
                area: [width, height],
                content: url,

            });
        }
        function iframe(title, width, height, url) {
            layer.open({
                type: 2,
                title: title,
                shadeClose: true,
                shade: 0.7,
                area: [width, height],
                content: url,
                btn: ["提交", "取消"],
                yes: function (index, layero) {
                    window.frames[0].saveForm();
                },
                cancel: function (index) {

                }
            });
        }
        function iframeWithBtns(title, width, height, url, isParent, func) {
            var options = {
                skin: 'layui-ext-skin01',
                type: 2,
                title: title,
                shadeClose: false,
                closeBtn: 0,
                shade: 0.7,
                area: [width, height],
                content: url,
                btn: ['提交', '取消'],
                yes: function (index, layero) {
                    func(index, layero);
                },
                cancel: function () { }
            };
            if (isParent === true) {
                parent.layer.open(
                    options
                );
            } else {
                layer.open(options);
            }
        }
    </script>
    <script>

        // //定义北京 54 坐标系
        //proj4.defs("EPSG:2436", "+proj=tmerc +lat_0=0 +lon_0=117 +k=1 +x_0=500000 +y_0=0 +ellps=krass +towgs84=15.8,-154.4,-82.3,0,0,0,0 +units=m +no_defs");

        var centerPoint = new L.LatLng(@ViewBag.lat, @ViewBag.lng);
        //Leaflet 坐标系参数
        var crs1 = new L.Proj.CRS("EPSG:2436", "+proj=tmerc +lat_0=0 +lon_0=117 +k=1 +x_0=500000 +y_0=0 +ellps=krass +towgs84=15.8,-154.4,-82.3,0,0,0,0 +units=m +no_defs",
            {
                origin: [-5123300.0, 10002300],  // 将刚刚的 Origin 复制到这里
                resolutions: [                 // 所有的分辨率复制到这里
                    76.43695495724326,
                    38.21834518669038,
                    19.109040301413938,
                    9.554387858775717,
                    4.777061637456608,
                    2.3883985267970536,
                    1.1940669714672763,
                    0.5969011938023876,
                    0.2984505969011938
                ]
                /*bounds: L.bounds([516911.9087096499, 2739564.213902506], [522879.9046456418, 2744911.94059796])*/
            });


        var tileMapUrl = "@ViewBag.ArcgisUrl";
        var map = L.map('gdmap', {
            crs: crs1,
            center: centerPoint,
            zoom: 5,
            minZoom: 2,
            maxZoom: 8

            //attributionControl: true,
        });
        var tileMapLayer = L.esri.tiledMapLayer({
            url: tileMapUrl
        });

        map.addLayer(tileMapLayer);
        var markericon1 = '' +
            '<div>' +
            '<div class="wfybf">  ' +
            '<div class="circle">' +
            '<img src="../../images/bftb.png">' +
            '</div> ' +
            '<div class="circle_bottom animation "></div>' +
            '<div class="circle_bottom2 animation2 "></div>' +
            '</div>' +
            '</div>';
        var myIcon = L.divIcon({ html: markericon1, iconSize: [30, 30], className: '' });
        var marker = L.marker([@ViewBag.lat, @ViewBag.lng], { icon: myIcon }).addTo(map);





        $(function () {
            var layui_yi = $('.data_layeryi').height();
            var layui_er = $('.data_layerer').height();
            var layuisanpadding = (layui_yi + layui_er + 30) + 'px';
            $('.data_layersan').css('padding-top', layuisanpadding)
            // 搜索框点击变长
            $(".shuai_layui_sea input").focus(function () {
                $('.shuai_layui_sea input').css('width', '200px')
            });
            $(".shuai_layui_sea input").blur(function () {
                $('.shuai_layui_sea input').css('width', '60px')
            });

            // LoadMapData();
        })

        function LoadMapData() {
            $.post("/Sws/Sws_Detail/LoadMapInfo", { sid: sid }, function (data) {
                
                //$("#cl").html(data.jk.cl);
                //$("#tb").html(data.jk.turbidity);
                //$("#ph").html(data.jk.ph);
                if (iszong == 0) {
                    $('#GUI').contents().find("#zhuodu").html(data.jk.turbidity + "[NTU]");
                    $('#GUI').contents().find("#yulu").html(data.jk.cl + "[mg/L]");
                    $('#GUI').contents().find("#ph").html(data.jk.ph);
                    $('#GUI').contents().find("#bfljdl1").html(data.jk.allInFlow + "kW·h");
                }


            })
        }


        function LoadshuixiangData() {
            $.post("/Sws/Sws_Detail/LoadshuixiangInfo", { sid: sid, partionid: 6 }, function (data) {
                
                if (data != "") {
                    if (iszong == 0) {
                        $('#GUI').contents().find("#sx1").html(data.jkdata.sx1 + "m");
                        $('#GUI').contents().find("#sx2").html(data.jkdata.sx2 + "m");
                        $('#GUI').contents().find("#sx3").html(data.jkdata.sx3 + "m");
                        $('#GUI').contents().find("#sx4").html(data.jkdata.sx4 + "m");
                        $('#GUI').contents().find("#sx5").html(data.jkdata.sx5 + "m");
                    }

                }

            })

        }

        ///获取泵站详情
        function LoadTemInfo(partionid) {
            $.post("/Sws/Sws_Detail/LoadTemInfo", { sid: sid, partionid: partionid }, function (data) {
                if (data != "") {
                    console.log(data)
                    //<li>
                    //    <div class="name">总电量</div>
                    //    <div class="value">
                    //    <span id="EnergyCon">0</span> kW·h
                    //    </div>
                    //</li>
                    var json = JSON.parse(data);
                    var many = json.dataInfosmany;
                    var less = json.dataInfosless;
                    $("#sbzt").empty();
                    var html = "";
                    for (var i = 0; i < less.length; i++) {
                        html += '<li><div class="name" title="' + less[i].Cnname + '">' + less[i].Cnname + '</div><div class="value"><span></span> ' + (less[i].Unit == "#" ? " " : less[i].Unit) + '</div></li>'
                    }
                    for (var i = 0; i < many.length; i++) {
                        html += '<li><div class="name"  title="' + many[i].Cnname + '">' + many[i].Cnname + '</div><div class="value"><span></span> ' + (many[i].Unit == "#" ? " " : many[i].Unit) + '</div></li>'
                    }

                    $("#sbzt").append(html);
                }
            })
            LoadDataInfo(partionid);
        }
        function LoadDataInfo(partionid) {
            $.post("/Sws/Sws_Detail/GetJKData", { sid: sid, partionid: partionid }, function (data) {
                
                var spans = $("#sbzt span");
                if (data != "") {
                    var json = JSON.parse(data);
                    var spanlength = spans.length;
                    if (json.Equipmentstate != "") {
                        jsonEquipmentstate = json.Equipmentstate;
                        for (var i = 0; i < spanlength; i++) {
                            spans[i].innerText = jsonEquipmentstate[i].AnalogValue;
                        }
                    }
                }
            })
        }
    </script>

</body>
</html>
