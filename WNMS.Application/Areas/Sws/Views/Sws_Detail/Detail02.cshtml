
@{
    Layout = null;
}
@using WNMS.Model.DataModels;
<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>@ViewBag.StationName</title>
    <link href="../../css/hyl.css" rel="stylesheet" />
    <link rel="Shortcut Icon" href="~/UploadImg/Logo/logo.png" />
    <link href="../../css/AdminLTE.lite.css" rel="stylesheet" />
    <link href="../../css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../css/font-awesome.css" rel="stylesheet" />
    <link href="../../css/zlw.css" rel="stylesheet" />
    <link href="../../css/set_10.css" rel="stylesheet" />
    @*<link href="//at.alicdn.com/t/font_1545052_hvghkazl5sa.css" rel="stylesheet" />*@
    <link href="~/css/ztreefont.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../css/font-awesome.css">
    <link href="../../css/sl_bengfang.css" rel="stylesheet" />
    <script src="../../js/jquery-1.12.4.min.js"></script>
    <script src="~/lib/layer/layer.js"></script>
    <link rel="stylesheet" href="../../css/gdmap.css">
    <link href="../../css/xiniconfont.css" rel="stylesheet" />
    <!-- 高德地图 -->
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=28068084e71b4dac1344e8d5c9451629"></script>
    <style>
        html {
            height: 100%;
        }

        .nav-tabs-custom > .nav-tabs > li > a:hover {
            background: #d2ebff !important;
            color: #333 !important;
        }

        .nav-tabs-custom > .tab-content {
            padding: 10px 0
        }

        .nav-tabs-custom > .nav-tabs > li {
            margin-right: 0
        }

        body {
            height: 100%;
            overflow: hidden;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .form-control:focus {
            box-shadow: none
        }

        .detail_main {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .detail_qh {
            padding: 9px 0 0 50px;
            height: 40px;
            box-sizing: border-box;
            float: left;
        }

            .detail_qh ul {
                display: block;
            }

                .detail_qh ul li {
                    float: left;
                }

        .custom-input-card {
            width: 18rem;
        }

            .custom-input-card .btn:last-child {
                margin-left: 1rem;
            }

        .content-window-card {
            position: relative;
            width: 23rem;
            padding: 0.75rem 0 0 1.25rem;
            box-shadow: none;
            bottom: 0;
            left: 0;
        }

        .chaochu {
            text-align: left !important
        }

            .chaochu i {
                display: inline-block;
                width: 8px;
                height: 8px;
                border-radius: 10px;
                margin-right: 6px;
                background: #0fd10a
            }

        .ls {
            background: #0fd10a !important
        }

        .hs {
            background: #ff0202 !important
        }

        .huis {
            background: #666 !important
        }

        .content-window-card p {
            height: 2rem;
        }

        .clearfloat:after {
            content: "";
            display: block;
            height: 0;
            clear: both;
            visibility: hidden;
        }

        input {
            outline: none
        }

        iframe {
            height: 100% !important
        }

        .clearfloat {
            zoom: 1;
        }
        .layui-layer-content{
            height:100%;
        }
    </style>
</head>
<body>
    <div class="zlww_ss"></div>
    <div class="bf_top form-inline">
        <span class="title"><i class="glyphicon glyphicon-menu-left"></i>@ViewBag.StationName</span>
        <div class="right">
            <label class="hyl_label">刷新频率(s)：</label>
            <select id="timelevle" class="hyl_select">
                <option value="30">30秒</option>
                <option value="60" selected="selected">1分钟</option>
                <option value="300">5分钟</option>
            </select>
        </div>
    </div>

    <div class="bf_main">
        <div class="gy_img">
            <div class="detail_main relative">
                <iframe id="GUI" style="height:100% !important;width:100%;border:none;position:absolute;left:0;right:0;top:0;bottom:0"></iframe>
            </div>
        </div>
        

        <!-- tab -->
        <div class="bf_tab nav-tabs-custom">
            <ul class="nav nav-tabs">
                <li class="active"><a href="#home" data-toggle="tab">泵站详情</a></li>
                <li><a href="#profile" data-toggle="tab">报警监控</a></li>
                <li><a href="#messages" data-toggle="tab">远程控制</a></li>
            </ul>
            <div class="tab-content" style="height:calc(100% - 34px)">
                <!-- 泵站详情 -->
                <div class="tab-pane active" id="home" style="height:100%;">
                    <p class="messages_title1">泵房统计(近七天)</p>
                    <ul class="clearfloat bf_list">
                        <li><p><span>总&nbsp;电&nbsp;量：</span><strong class="pr5px" id="EnergyCon">0</strong>KW·h</p></li>
                        <li><p><span>总&nbsp;流&nbsp;量：</span><strong class="pr5px" id="FlowCon">0</strong>m³</p></li>
                        <li><p><span>吨水耗电：</span><strong class="pr5px" id="TonWater">0</strong>kW·h/m³</p></li>
                    </ul>
                    <p class="messages_title1">实时数据</p>
                    <div class="bfxq_sj">
                        <div class="bfxq_sj_cli">
                            <img src="../../images/cl.png" />
                            <div class="bfxq_sj_cli_c">
                                <h3>余氯(mg/L)</h3>
                                <strong id="pcl">0</strong>
                            </div>
                        </div>
                        <div class="bfxq_sj_cli">
                            <img src="../../images/zhuodu.png" />
                            <div class="bfxq_sj_cli_c">
                                <h3>浊度(NTU)</h3>
                                <strong id="ptub">0</strong>
                            </div>
                        </div>
                        <div class="bfxq_sj_cli">
                            <img src="../../images/ph.png" />
                            <div class="bfxq_sj_cli_c">
                                <h3>PH</h3>
                                <strong id="pph">0</strong>
                            </div>
                        </div>
                        <p class="messages_title clear">
                            <span id="moredata" style="cursor:pointer;padding-left:8px">
                                更多
                                <i class="glyphicon glyphicon-menu-right"></i>
                                <i class="glyphicon glyphicon-menu-right" style="position: relative;left: -12px;"></i>
                            </span>
                        </p>
                    </div>
                    <p class="messages_title1">泵房样貌</p>
                    <div class="bfym_img" style="height:calc(100% - 280px);">

                        <div class="bf-lb">
                            <!--轮播-->
                            <div id="myCarousel" class="carousel slide">
                                @{
                                    var images = ViewBag.imgList as List<Attachment>;
                                    int k = 1;
                                    <ol class="carousel-indicators">
                                        @if (images.Count != 0)
                                        {
                                            for (var i = 0; i < images.Count; i++)
                                            {
                                                <li data-target="#myCarousel" data-slide-to="@i"></li>
                                            }
                                        }
                                        else
                                        {
                                            <li data-target="#myCarousel" data-slide-to="0"></li>
                                        }

                                    </ol>
                                }
                                <!-- 轮播（Carousel）指标 -->
                                <!-- 轮播（Carousel）项目 -->
                                <div class="carousel-inner">
                                    @if (images.Count != 0)
                                    {
                                        foreach (var item in images)
                                        {
                                            if (k == 1)
                                            {
                                                <div class="item active" style="background:url(@item.FileUrl) no-repeat left center;background-size:cover">

                                                </div>
                                            }
                                            else
                                            {
                                                <div class="item" style="background:url(@item.FileUrl) no-repeat left center;background-size:cover">

                                                </div>
                                            }

                                        }
                                    }
                                    else
                                    {
                                        <div class="item active" style="background:url('../../images/bflook.jpg') no-repeat left center;background-size:cover">

                                        </div>
                                    }


                                </div>
                                <!-- 轮播（Carousel）导航 -->
                                <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
                                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                </a>
                                <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
                                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </div>

                        </div>
                        <!--map-->
                        <div class="bf-map">
                            @*<p class="bf-tabs">
                                <span>视频监控</span>
                                <span class="ons">地图鹰眼</span>
                            </p>*@
                            <p class="messages_title1">地图鹰眼</p>
                            <div class="tabBox">
                                @*<div class="hidden jk-box relative">
                                    <p><img src="../../images/null.png" /><span>暂无</span></p>
                                </div>*@
                                <div id="gdmap" class="gdmaps"></div>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- 报警控制 -->
                <div class="tab-pane" id="profile">
                    <div class="tab2cont">
                        <ul id="eventList">
                            @{
                                var eventList = ViewBag.eventInfo as List<dynamic>;
                                if (eventList.Count > 0)
                                {
                                    foreach (var item in eventList)
                                    {
                                        <li>
                                            <div class="bfxq_list_t">

                                                @if (item.EventLevel == 1)
                                                {
                                                    <img class="" src="../../images/deviceAlarm1.png" alt="">
                                                    <div class="bfxq_list_b_msg">
                                                        <p>@item.EventTime</p>
                                                        <h3>@item.EventMessage</h3>
                                                    </div>
                                                    if (item.IsHandle == 1)
                                                    {
                                                        <p class="right bfxq_list_b_jj">
                                                            <i class="glyphicon glyphicon-edit" onclick="HandleEvent(true,'@item.EventMessage','@item.EventTime',@item.RTUID,@item.EventSource)"></i>
                                                            &nbsp;提示性报警
                                                        </p>
                                                    }
                                                    else
                                                    {
                                                        <p class="right bfxq_list_b_jj">
                                                            <i class="glyphicon glyphicon-edit" onclick="HandleEvent(false,'@item.EventMessage','@item.EventTime',@item.RTUID,@item.EventSource)"></i>
                                                            &nbsp;提示性报警
                                                        </p>
                                                    }

                                                }
                                                else if (item.EventLevel == 2)
                                                {
                                                    <img class="" src="../../images/deviceAlarm2.png" alt="">
                                                    <div class="bfxq_list_b_msg">
                                                        <p>@item.EventTime</p>
                                                        <h3>@item.EventMessage</h3>
                                                    </div>

                                                    if (item.IsHandle == 1)
                                                    {
                                                        <p class="right bfxq_list_b_jj">
                                                            <i class="glyphicon glyphicon-edit" onclick="HandleEvent(true,'@item.EventMessage','@item.EventTime',@item.RTUID,@item.EventSource)"></i>
                                                            &nbsp;一般性报警
                                                        </p>
                                                    }
                                                    else
                                                    {
                                                        <p class="right bfxq_list_b_jj">
                                                            <i class="glyphicon glyphicon-edit" onclick="HandleEvent(false,'@item.EventMessage','@item.EventTime',@item.RTUID,@item.EventSource)"></i>
                                                            &nbsp;一般性报警
                                                        </p>
                                                    }
                                                }
                                                else
                                                {
                                                    <img class="" src="../../images/deviceAlarm3.png" alt="">
                                                    <div class="bfxq_list_b_msg">
                                                        <p>@item.EventTime</p>
                                                        <h3>@item.EventMessage</h3>
                                                    </div>
                                                    if (item.IsHandle == 1)
                                                    {
                                                        <p class="right bfxq_list_b_jj">
                                                            <i class="glyphicon glyphicon-edit" onclick="HandleEvent(true,'@item.EventMessage','@item.EventTime',@item.RTUID,@item.EventSource)"></i>
                                                            &nbsp;紧急报警
                                                        </p>
                                                    }
                                                    else
                                                    {
                                                        <p class="right bfxq_list_b_jj">
                                                            <i class="glyphicon glyphicon-edit" onclick="HandleEvent(false,'@item.EventMessage','@item.EventTime',@item.RTUID,@item.EventSource)"></i>
                                                            &nbsp;紧急报警
                                                        </p>
                                                    }
                                                }

                                            </div>
                                            <div class="bfxq_list_b">
                                                @{
                                                    TimeSpan ts = DateTime.Now - Convert.ToDateTime(item.EventTime);
                                                    var times = ts.Days + "天" + ts.Hours + "时" + ts.Minutes + "分" + ts.Seconds + "秒";
                                                    var currentValue = item.CurrentValue.ToString() == "-9999" ? "--" : item.CurrentValue.ToString();
                                                    var limitValue = item.LimitValue.ToString() == "-9999" ? "--" : item.LimitValue.ToString();
                                                    <p>
                                                        <span>持续时间：@times</span>
                                                        <span class="right"><var style="color: red;font-weight: 600;">@currentValue</var>/@limitValue </span>
                                                    </p>
                                                }

                                            </div>
                                        </li>
                                    }
                                }
                                else
                                {
                                    <div class="textCenter" style="position:absolute;top:50%;width:100%;transform: translateY(-50%)">
                                        <img src="~/images/null.png" width="150" />
                                        <p class="f14px gray">暂无数据</p>
                                    </div>
                                }

                            }

                        </ul>
                    </div>
                </div>

                <!-- 远程控制 -->
                <div class="tab-pane" id="messages">
                    <div class="tab3cont">
                        @{
                            if (ViewBag.iscontoroller == true)
                            {
                                <p class="messages_title1">泵房控制</p>
                                <div class="yckz_img_list">
                                    <ul>
                                        <li onclick="StationCommand('ligth')">
                                            <i class="iconfont icon-dengpao"></i>
                                            <h6>灯</h6>
                                        </li>
                                        <li onclick="StationCommand('door')">
                                            <i class="iconfont  icon-IOTtubiao_huabanfuben"></i>
                                            <h6>门</h6>
                                        </li>
                                        <li onclick="StationCommand('dehumidifier')">
                                            <i class="iconfont   icon-tubiao-chushiji"></i>
                                            <h6>除湿机</h6>
                                        </li>
                                        <li onclick="StationCommand('stavalve')">
                                            <i class="iconfont  icon-famen"></i>
                                            <h6>阀门</h6>
                                        </li>
                                    </ul>
                                </div>
                            }
                            else
                            {
                                <div class="textCenter" style="position: absolute; top: 50%; width: 100%; transform: translateY(-50%) ">
                                    <img src="~/images/null.png" width="150" />
                                    <p class="f14px gray">暂无数据</p>
                                </div>
                            }

                        }

                    </div>
                </div>


            </div>
        </div>

    </div>





    <script src="../../js/bootstrap.js"></script>
    <script>
        var sid = @ViewBag.sid;
        var parid = @ViewBag.parid;
        var myVar;
        var startTime = new Date(2017, 06, 06);
        $(function () {
            $(".bf-tabs span").click(function () {
                $(this).addClass("ons").siblings("span").removeClass("ons");
                var indx = $(this).index();
                $(".tabBox div").eq(indx).removeClass("hidden").siblings("div").addClass("hidden");
            });
             //显示远程控制tab
            if (@ViewBag.ShowTab!=1) {
                $(".nav-tabs li:nth-child(@ViewBag.ShowTab)").addClass('active').siblings('li').removeClass('active');
                $(".tab-content div:nth-child(@ViewBag.ShowTab)").addClass('active').siblings('div').removeClass('active');

            }
            LoadStationStatistics();
             clearInterval(myVar);
            myVar = setInterval(function () {
                LoadStationStatistics();
                    //LoadStationEvent();
                LoadMapData();
                LoadStationEvent();
            }, $("#timelevle").val() * 1000);

        })
        $("#timelevle").change(function () {
                clearInterval(myVar);
                myVar = setInterval(function () {
                    LoadStationStatistics();
                    LoadMapData();
                    LoadStationEvent();
                }, $("#timelevle").val() * 1000);
            })

         //报警处理
        function HandleEvent(ishandle,alarmMessage,eventtime,rtuid,eventsouce) {
            if (ishandle == true) {//已处理
                iframe1("报警处理", "500px", "500px","/Sws/Sws_EventJK/HandleEventPage?"+
                    "ishandle=true&alarmMessage="+encodeURIComponent(alarmMessage)+"&eventtime="+eventtime+"&rtuid="+rtuid+"&eventsouce="+eventsouce+"");
            }
            else {//未处理
               //iframe("报警处理", "500px", "500px", "/Sws/Sws_EventJK/HandleEventPage?"+
               //    "ishandle=false&alarmMessage=" + encodeURIComponent(alarmMessage) + "&eventtime=" + eventtime + "&rtuid=" + rtuid + "&eventsouce=" + eventsouce + " ");
                 iframeWithBtns("报警处理", "500px","500px", "/Sws/Sws_EventJK/HandleEventPage?"+
                   "ishandle=false&alarmMessage=" + encodeURIComponent(alarmMessage) + "&eventtime=" + eventtime + "&rtuid=" + rtuid + "&eventsouce=" + eventsouce + " ", false, function (formIndex, formLayer) {
                    var currentIframe = window[formLayer.find('iframe')[0]['name']];
                    currentIframe.saveForm(function (data) {
                        if (data == "ok") {
                            layer.close(formIndex);
                        }
                    });
                });

            }

        }
         //更多实时监控数据
        $("#moredata").click(function () {
            iframe1("实时数据", "800px", "600px", "/Sws/Sws_Detail/LoadMoreZData/" + sid);
        })
        //获取泵房统计数据
        function LoadStationStatistics() {
            $.post("/Sws/Sws_Detail/LoadZStationStatistics", { sid: sid }, function (data) {
                if (data != "") {
                    $("#EnergyCon").html(data.energyCon);
                    $("#FlowCon").html(data.flowCon);
                    $("#TonWater").html(data.tonWater);
                }
            })
        }
         //获取报警信息
        function LoadStationEvent() {
            $.post("/Sws/Sws_Detail/LoadZEvent", { sid: sid }, function (data) {
                if (data != "") {
                    $("#eventList").empty();
                    var html = "";
                    for (var i = 0; i < data.eventInfo.length; i++) {
                        html += '<li>';
                        html += '<div class="bfxq_list_t">';
                        if (data.eventInfo[i].EventLevel == 3) {
                            html += ' <img class="" src="../../images/deviceAlarm3.png" alt="">';
                        } else if (data.eventInfo[i].EventLevel == 2) {
                            html += ' <img class="" src="../../images/deviceAlarm2.png" alt="">';
                        } else if(data.eventInfo[i].EventLevel == 1) {
                            html += ' <img class="" src="../../images/deviceAlarm1.png" alt="">';
                        }
                        html += '<div class="bfxq_list_b_msg">';
                         html += '<p>'+data.eventInfo[i].EventTime+'</p>';
                        html += '<h3>' + data.eventInfo[i].EventMessage + '</h3>';
                        html += '</div>';
                        html += ' <p class="right bfxq_list_b_jj">';
                        if (data.eventInfo[i].IsHandle == 1) {
                            html += " <i class='glyphicon glyphicon-edit' onclick=" + '"' + "HandleEvent(true,'"+  data.eventInfo[i].EventMessage +"','" + data.eventInfo[i].EventTime + "','" + data.eventInfo[i].RTUID + "','" + data.eventInfo[i].EventSource + "')" + '"' + "'></i> &nbsp;";
                            html+=''+data.eventInfo[i].ItemName+'';
                        } else {
                             html += " <i class='glyphicon glyphicon-edit' onclick=" + '"' + "HandleEvent(false,'"+  data.eventInfo[i].EventMessage +"','" +  data.eventInfo[i].EventTime + "','" + data.eventInfo[i].RTUID + "','" + data.eventInfo[i].EventSource + "')" + '"' + "'></i> &nbsp;";
                            html+=''+data.eventInfo[i].ItemName+'';
                        }
                        html += '</p>';
                        html += '</div>';
                        html += '<div class="bfxq_list_b">';
                        html += '<p>';
                        var timeou = diffTime(data.eventInfo[i].EventTime, new Date())
                        html += '<span>持续时间：' + timeou + '</span>';
                        if (data.eventInfo[i].LimitValue == "-9999") {
                            html += '<span class="right"><var style="color: red;font-weight: 600;">--</var>/-- </span>';
                        } else {
                            html += '<span class="right"><var style="color: red;font-weight: 600;">'+data.eventInfo[i].CurrentValue+'</var>/'+data.eventInfo[i].LimitValue+' </span>';
                        }

                        html += '</p>';
                        html += '</div>';
                        html += '</li>';
                    }
                    $("#eventList").append(html);
                }
            })
        }
         function diffTime(startDate, endDate) {
            startDate = new Date(startDate);
            endDate = new Date(endDate);
            var diff = endDate.getTime() - startDate.getTime();//时间差的毫秒数
            //计算出相差天数
            var days = Math.floor(diff / (24 * 3600 * 1000));
            //计算出小时数
            var leave1 = diff % (24 * 3600 * 1000);    //计算天数后剩余的毫秒数
            var hours = Math.floor(leave1 / (3600 * 1000));
           //计算相差分钟数
            var leave2 = leave1 % (3600 * 1000);        //计算小时数后剩余的毫秒数
            var minutes = Math.floor(leave2 / (60 * 1000));
            //计算相差秒数
            var leave3 = leave2 % (60 * 1000);      //计算分钟数后剩余的毫秒数
            var seconds = Math.round(leave3 / 1000);
            var returnStr = seconds + "秒";

                returnStr = minutes + "分" + returnStr;


                returnStr = hours + "小时" + returnStr;


                returnStr = days + "天" + returnStr;
            return returnStr;
        }


        //泵房控制
        function StationCommand(value) {
            var noewdate = new Date();
            var t3 = noewdate - startTime;
            if (t3 > 300000) {
                if (value == "ligth") {
                    selectvalue = 5;
                    TurnOnAction();
                } else if (value == "door") {
                    selectvalue = 6;
                    TurnOnAction();
                } else if (value == "dehumidifier") {
                    layer.alert("暂无相关设备", { icon: 2 });
                    //selectvalue = 7;
                    //TurnOnAction();
                } else if (value == "stavalve") {
                    selectvalue = 8;
                    selectvalue = 8;
                     layer.alert("暂无相关设备", { icon: 2 });
                }
            } else {
                if (value == "ligth") {
                    selectvalue = 5;
                } else if (value == "door") {
                    selectvalue = 6;
                } else if (value == "dehumidifier") {
                    selectvalue = 7;
                    layer.alert("暂无相关设备", { icon: 2 });
                    return false;
                } else if (value == "stavalve") {
                    selectvalue = 8;
                     layer.alert("暂无相关设备", { icon: 2 });
                    return false;
                }
                 functionselect();
            }
        }
        //权限验证
        function TurnOnAction() {
             iframeWithBtns("用户名确认", "500px", "300px", "/Sws/Sws_RemoteCommand/CheckUser", false, function (formIndex, formLayer) {
                    var currentIframe = window[formLayer.find('iframe')[0]['name']];
                    currentIframe.saveForm(function (data) {
                        if (data == "ok") {
                            layer.close(formIndex);
                        }
                    });
                });
        }
        function functionselect() {
             if (selectvalue == 1)
                TurnOnCommi();//权限和用户验证通过后
            if (selectvalue == 2)
                TurnOffCommi();
            if (selectvalue == 3)
                SetPressureCommi()
            if (selectvalue == 4)
                VFDResetCommi();
            if (selectvalue == 5)
                OpenligthCommi();
             if (selectvalue == 6)
                OpenDoorCommi();
            if (selectvalue == 7) {}
            if (selectvalue == 8) {
                 OpenFaCommi();
            }
        }
         //开门
        function OpenDoorCommi() {
            $.post("/Sws/Sws_RemoteCommand/LoadOpenDoor", { sid: sid, paid: parid }, function (data) {
                var aa = eval(data);
                var json = JSON.parse(aa);
                layer.alert(json["Message"]);
            });
        }
         //开灯
        function OpenligthCommi() {
            $.post("/Sws/Sws_RemoteCommand/LoadOpenligth", { sid: sid, paid: parid }, function (data) {
                var aa = eval(data);
                var json = JSON.parse(aa);
                layer.alert(json["Message"]);
            });
        }
         //开阀门
        function OpenFaCommi() {
            iframe1("阀门控制", "500px", "500px", "/Sws/Sws_Detail/LoadFa?id=" + sid+"&type=2");
            //$.post("/Sws/Sws_RemoteCommand/LoadOpenFa", { sid: sid, paid: pparid }, function (data) {
            //    var aa = eval(data);
            //    var json = JSON.parse(aa);
            //    layer.alert(json["Message"]);
            //});
        }
        function iframe1(title, width, height, url) {
            layer.open({
                type: 2,
                title: title,
                shadeClose: true,
                shade: 0.7,
                area: [width, height],
                content: url,

            });
        }
        function iframeWithBtns(title, width, height, url, isParent, func) {
            var options = {
                skin: 'layui-ext-skin01',
                type: 2,
                title: title,
                shadeClose: false,
                closeBtn: 0,
                shade: 0.7,
                area: [width, height],
                content: url,
                btn: ['提交', '取消'],
                yes: function (index, layero) {
                    func(index, layero);
                },
                cancel: function () { }
            };
            if (isParent === true) {
                parent.layer.open(
                    options
                );
            } else {
                layer.open(options);
            }
        }
    </script>
    <script>
        var map = new AMap.Map('gdmap', {
            center: [116.397428, 39.90923],
            mapStyle: 'amap://styles/8d723b70ba3f078f5fb4c35f177c05e3', //设置地图的显示样式
            layers: [//使用多个图层
                // new AMap.TileLayer.Satellite(),
                // new AMap.TileLayer.RoadNet()
            ],
            zooms: [4, 10],//设置地图级别范围
            zoom: 13
        });
        var infoWindow = new AMap.InfoWindow({ offset: new AMap.Pixel(12, -35) });
        //自定义maker图标
        var markericon1 = '' +
            '<div>' +
            '<img src="../../images/bj.png">' +
            '</div>';
        var markerContent1 = '' +
            '<div class="makercon overflow pad10px">' +
            '<div class="textCenter makercon-left"><i class="iconfont f24px icon-bengfang blue"></i><p class="mt5px">二供泵房</p></div>' +
            '<div class="makercon-right">' +
            '<p class="f16px fb ellipsis1">万象新城</p>' +
            '<div class="green f16px fb tb-f"><span>4.31</span><span>0.85</span><span>0.81</span></div>' +
            '<div class="tb-f f12px"><span>出瞬流</span><span>低区</span><span>中区</span></div>' +
            '</div > ' +
            '</div>' +
            '<div class="sj"></div>';


        var marker1 = new AMap.Marker({
            //    // 以 icon 的 [center bottom] 为原点
            offset: new AMap.Pixel(-10, -40),
            content: markericon1,     //自定义marker点
            position: new AMap.LngLat(116.368904, 39.923423),
        });

        // 将 markers 添加到地图
        //map.add(marker1);
        marker1.on('click', function (e) {
            infoWindow.setContent(markerContent1);
            infoWindow.open(map, e.target.getPosition());
        });


        var markericon2 = '' +
            '<div>' +
            '<img src="../../images/zx.png">' +
            '</div>';
        var markerContent2 = '' +
            '<div class="makercon overflow pad10px">' +
            '<div class="maptitle"><i class="iconfont f24px icon-bengfang blue"></i><p><span class="fb f16px">二供泵房</span><span class="pl10px">(出瞬流：<em class="green">0.00</em>)</span></p></div>' +
            '<ul class="maplist">' +
            //报警 给<span class="red">,绿色 <span class="green">
            '<li><span>分区</span><span>进压力</span><span>出压力</span><span>进瞬时</span></li>' +
            '<li><span>低区</span><span>0.13</span><span class="red">0.7</span><span>0.00</span></li>' +
            '<li><span>中区</span><span>0.13</span><span class="green">0.7</span><span>0.00</span></li>' +
            '<li><span>高区</span><span>0.13</span><span>0.7</span><span>0.00</span></li>' +
            '</ul > ' +
            '<div class="sj"></div>';

        var marker2 = new AMap.Marker({
            //    // 以 icon 的 [center bottom] 为原点
            offset: new AMap.Pixel(-10, -40),
            content: markericon2,     //自定义marker点
            position: new AMap.LngLat(116.368904, 42.923423),
        });
        // 将 markers 添加到地图
        //map.add(marker2);

        marker2.on('click', function (e) {
            infoWindow.setContent(markerContent2);
            infoWindow.open(map, e.target.getPosition());
        });


        var markericon3 = '' +
            '<div>' +
            '<img src="../../images/lx.png">' +
            '</div>';
        var markerContent3 = '' +
            '<div class="makercon overflow pad10px">' +
            '<div class="maptitle"><i class="iconfont f24px icon-bengfang blue"></i><p><span class="fb f16px">二供泵房</span><span class="pl10px">(出瞬流：<em class="green">0.00</em>)</span></p></div>' +
            '<ul class="maplist">' +
            //报警 给<span class="red">,绿色 <span class="green">
            '<li><span>分区</span><span>进压力</span><span>出压力</span><span>进瞬时</span></li>' +
            '<li><span>低区</span><span>0.13</span><span class="red">0.7</span><span>0.00</span></li>' +
            '<li><span>中区</span><span>0.13</span><span class="green">0.7</span><span>0.00</span></li>' +
            // '<li><span>高区</span><span>0.13</span><span>0.7</span><span>0.00</span></li>' +
            '</ul > ' +
            '<div class="sj"></div>';

        var marker3 = new AMap.Marker({
            //    // 以 icon 的 [center bottom] 为原点
            offset: new AMap.Pixel(-10, -40),
            content: markericon3,     //自定义marker点
            position: new AMap.LngLat(118.368904, 41.923423),
        });
        // 将 markers 添加到地图
        //map.add(marker3);

        marker3.on('click', function (e) {
            infoWindow.setContent(markerContent3);
            infoWindow.open(map, e.target.getPosition());
        });

        var markericon4 = '' +
            //报警 替换下面bgGreen 为 bgRed 离线为 bgGray
            '<div class="mapiconbox overflow bgGreen">' +
            '<span class="left"><i class="iconfont f18px icon-bengfang white pl5px pr5px"></i></span><span class="left">出瞬流 0.70</span>' +
            '</div>';
        var markerContent4 = '' +
            '<div class="makercon overflow pad10px">' +
            '<div class="maptitle"><i class="iconfont f24px icon-bengfang blue"></i><p><span class="fb f16px">二供泵房</span><span class="pl10px">(出瞬流：<em class="green">0.00</em>)</span></p></div>' +
            '<ul class="maplist">' +
            //报警 给<span class="red">,绿色 <span class="green">
            '<li><span>分区</span><span>进压力</span><span>出压力</span><span>进瞬时</span></li>' +
            '<li><span>低区</span><span>0.13</span><span class="red">0.7</span><span>0.00</span></li>' +
            '<li><span>中区</span><span>0.13</span><span class="green">0.7</span><span>0.00</span></li>' +
            // '<li><span>高区</span><span>0.13</span><span>0.7</span><span>0.00</span></li>' +
            '</ul > ' +
            '<div class="sj"></div>';

        var marker4 = new AMap.Marker({
            //    // 以 icon 的 [center bottom] 为原点
            offset: new AMap.Pixel(-45, -33),
            content: markericon4,     //自定义marker点
            position: new AMap.LngLat(118.368904, 38.923423),
        });
        // 将 markers 添加到地图
        //map.add(marker4);

        marker4.on('click', function (e) {
            infoWindow.setContent(markerContent4);
            infoWindow.open(map, e.target.getPosition());
        });

        var markericon5 = '' +
            '<div class="makercon overflow pad10px">' +
            '<div class="textCenter makercon-left"><i class="iconfont f24px icon-bengfang blue"></i><p class="mt5px">二供泵房</p></div>' +
            '<div class="makercon-right">' +
            '<p class="f16px fb ellipsis1">万象新城</p>' +
            '<div class="green f16px fb tb-f"><span>4.31</span><span>0.85</span><span>0.81</span></div>' +
            '<div class="tb-f f12px"><span>出瞬流</span><span>低区</span><span>中区</span></div>' +
            '</div > ' +
            '</div>' +
            '<div class="sj"></div>';
        var markerContent5 = '' +
            '<div class="makercon overflow pad10px">' +
            '<div class="maptitle"><i class="iconfont f24px icon-bengfang blue"></i><p><span class="fb f16px">二供泵房</span><span class="pl10px">(出瞬流：<em class="green">0.00</em>)</span></p></div>' +
            '<ul class="maplist">' +
            //报警 给<span class="red">,绿色 <span class="green">
            '<li><span>分区</span><span>进压力</span><span>出压力</span><span>进瞬时</span></li>' +
            '<li><span>低区</span><span>0.13</span><span class="red">0.7</span><span>0.00</span></li>' +
            '<li><span>中区</span><span>0.13</span><span class="green">0.7</span><span>0.00</span></li>' +
            // '<li><span>高区</span><span>0.13</span><span>0.7</span><span>0.00</span></li>' +
            '</ul > ' +
            '<div class="sj"></div>';

        var marker5 = new AMap.Marker({
            //    // 以 icon 的 [center bottom] 为原点
            offset: new AMap.Pixel(-128, -150),
            content: markericon5,     //自定义marker点
            position: new AMap.LngLat(115.068904, 38.023423),
        });
        // 将 markers 添加到地图
        // map.add(marker5);

        marker5.on('click', function (e) {
            infoWindow.setContent(markerContent5);
            infoWindow.open(map, e.target.getPosition());
        });

        $(function () {
            var layui_yi = $('.data_layeryi').height();
            var layui_er = $('.data_layerer').height();
            var layuisanpadding = (layui_yi + layui_er + 30) + 'px';
            $('.data_layersan').css('padding-top', layuisanpadding)
            // 搜索框点击变长
            $(".shuai_layui_sea input").focus(function () {
                $('.shuai_layui_sea input').css('width', '200px')
            });
            $(".shuai_layui_sea input").blur(function () {
                $('.shuai_layui_sea input').css('width', '60px')
            });
            // 点击收缩
            $('.zlw_ss').click(function () {
                if ($(".zlw_ss").hasClass("ss_active")) {
                    $('.data_layer').css('right', '0px');
                    $('.shuai_layui').css('right', '385px');
                    $('.zlw_ss').css('right', '378px').removeClass('ss_active');
                    $('.zlw_ss').css('background-image', 'url(/adminlte/images/收缩-触发-白色.svg)')
                } else {
                    $('.data_layer').css('right', '-380px');
                    $('.shuai_layui').css('right', '0px');
                    $('.zlw_ss').css('right', '-2px').addClass('ss_active');
                    $('.zlw_ss').css('background-image', 'url(/adminlte/images/展开-未触发-白色.svg)')
                }
            });
            var myheight = window.parent.$("#content-wrapper").height() - 100;
            $("#GUI").height(myheight).prop("src", "@ViewBag.GUIUrl");
            LoadMapData();


        });
        function LoadMapData() {
            $.post("/Sws/Sws_Detail/LoadZMapInfo", { sid: sid }, function (data) {
                if (data != null) {
                    $("#pcl").html(data.jk.cl);
                $("#ptub").html(data.jk.turbidity);
                $("#pph").html(data.jk.ph);
                    var markerContent = '';
                    if (data.jk.state == "故障") {
                        markerContent += '<div class="textCenter makercon-left"><i class="iconfont f24px icon-bengfang red"></i><p class="mt5px">直饮水泵房</p></div>';

                    } else if (data.jk.state == "正常") {
                        markerContent += '<div class="textCenter makercon-left"><i class="iconfont f24px icon-bengfang green"></i><p class="mt5px">直饮水泵房</p></div>';
                    } else {
                        markerContent += '<div class="textCenter makercon-left"><i class="iconfont f24px icon-bengfang gray"></i><p class="mt5px">直饮水泵房</p></div>';
                    }
                    markerContent += '<div class="makercon-right">';
                    markerContent += '<p class="f16px fb ellipsis1">' + data.jk.stationName + '</p>';
                    markerContent += '<div class="green f16px fb tb-f">';
                    var szstr = '';//各区数值
                    var fqstr = '<div class="tb-f f12px">';//各区名称
                    if (data.jk.deviceJKs.length > 0) {
                        for (var j = 0; j < data.jk.deviceJKs.length; j++) {
                            if (data.jk.deviceJKs[j].jPressOut.Value == true) {
                                szstr += '<span class="red">' + data.jk.deviceJKs[j].jPressOut.Key + '</span>'
                            } else {
                                szstr += '<span>' + data.jk.deviceJKs[j].jPressOut.Key + '</span>'
                            }
                            if (data.jk.deviceJKs[j].partition == 1) {
                                fqstr += '<span>低区</span>'
                            } else if (data.jk.deviceJKs[j].partition == 2) {
                                fqstr += '<span>中区</span>'
                            }
                            else if (data.jk.deviceJKs[j].partition == 3) {
                                fqstr += '<span>高区</span>'
                            }
                            else if (data.jk.deviceJKs[j].partition == 4) {
                                fqstr += '<span>超高区</span>'
                            }
                        }
                        fqstr += '</div>';
                        szstr += '</div>';
                        markerContent += szstr + fqstr;
                    }
                    markerContent += '</div></div><div class="sj">'
                    //设置宽度
                    var div = document.createElement('div');
                    if (data.jk.deviceJKs.length == 1) {
                        div.style.width = (data.jk.deviceJKs.length * 50 + 200) + 'px';
                    }
                    else if (data.jk.deviceJKs.length == 0) {
                        div.style.width = '300px';
                    }
                    else {
                        div.style.width = (data.jk.deviceJKs.length * 50 + 125) + 'px';
                    }
                    div.setAttribute("class", "makercon overflow pad10px");

                    div.innerHTML = markerContent;
                    marker = new AMap.Marker({
                        position: [data.jk.lng, data.jk.lat],
                        name: data.jk.stationName,
                        content: div,
                        offset: new AMap.Pixel(-135, -100), //相对于基点的偏移位置
                    });
                    marker.id = data.jk.stationID;
                    marker.on('mouseover', function (e) {
                        var id = this.id;
                        //LoadZStationJkData(id, e);
                    })
                    marker.on('mouseout', function (e) {
                        var id = this.id;
                        map.clearInfoWindow();
                    })
                    map.add(marker);
                    map.setZoomAndCenter(10, [data.jk.lng, data.jk.lat]); //同时设置地图层级与中心点
                }
            })
        }
    </script>
    <script>

        // 点击收缩
        $('.zlww_ss').click(function () {
            if ($(".zlww_ss").hasClass("ss_active")) {
                $('.bf_tab').css('right', '0px');
                $(".gy_img").css('width', 'calc(100% - 480px)');
                $('.zlww_ss').css('right', '480px').removeClass('ss_active');
                $('.zlww_ss').css('background-image', 'url(../../images/黑色收缩.svg)')
            } else {
                $('.bf_tab').css('right', '-480px');
                $(".gy_img").css('width', '100%');
                $('.zlww_ss').css('right', '0px').addClass('ss_active');
                $('.zlww_ss').css('background-image', 'url(../../images/黑色展开.svg)')
            }
        });
    </script>
</body>
</html>
