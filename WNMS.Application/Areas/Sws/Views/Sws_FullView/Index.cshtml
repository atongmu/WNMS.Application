
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>二供全览</title>
    <link rel="Shortcut Icon" href="~/UploadImg/Logo/logo.png" />
    <link href="~/DataV/css/css.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../css/gdmap.css">
    <link rel="stylesheet" href="../../css/hyl.css">
    <link href="../../css/ztreefont.css" rel="stylesheet">
    <script src="~/js/jquery-1.12.4.min.js"></script>
    <script src="~/js/echarts.min.js"></script>
    <script src="~/DataV/js/jquery.kxbdMarquee.js"></script>
    <script type="text/javascript" src="~/DataV/js/echarts-liquidfill.min.js"></script>
    <!-- Arcgis -->
    <!-- 地图 -->
    <link href="~/leafletmap/css/leaflet.1.3.1.css" rel="stylesheet" />
    <link href="~/leafletmap/plugins/Leaflet.MousePosition-master/L.Control.MousePosition.css" rel="stylesheet" />
    <script src="~/leafletmap/1.3.1/leaflet.js"></script>
    <script src="~/leafletmap/lib/esri-leaflet-v3.0.4/esri-leaflet.js"></script>
    <script src="~/leafletmap/plugins/Leaflet.MousePosition-master/L.Control.MousePosition.js"></script>
    <script src="~/leafletmap/plugins/Proj4Leaflet-master/proj4.js"></script>
    <script src="~/leafletmap/plugins/Proj4Leaflet-master/proj4leaflet.js"></script>
    <script src="~/leafletmap/plugins/leaflet.mapcache.js"></script>
    <style>
        .amap-container img {
            position: relative;
            left: -1px;
            top: 1px;
        }

        .clearfloat {
            zoom: 1;
        }

        .zlw_bjzblf {
            position: relative;
            z-index: 2;
        }

        .zlw_bjzblfer p {
            position: relative;
        }

            .zlw_bjzblfer p i {
                position: absolute;
                bottom: 0;
                left: 120px;
                margin: 0 !important;
            }

        .amap-overlays {
            z-index: 9999 !important;
        }

        .esri-popup_footer, .esri-popup_button--dock, .esri-popup__inline-actions-container {
            display: none;
        }

        .zlwdb {
            position: relative;
            padding-left: 30px;
            padding-right: 10px;
            width: 110px;
        }
    </style>
</head>
<body>
    <div class="zlw_content">

        <!-- star  body -->
        <div class="zlw_body clearfloat">
            <!-- star left -->
            <div class="zlw_body_lf">
                <!-- star 设备类型对比 -->
                <div class="zlw_sjlx">
                    <div class="zlw_title">
                        <p>设备类型对比</p>
                    </div>
                    <div class="zlw_sjlxcon">
                        <div id="mian_lef_lxdb" class="mian_lef_lxdb">
                            <div class="zlw_ldt">
                                <img src="../../DataV/images/07.png" class="dtyi" alt="">
                                <img src="../../DataV/images/06-4.png" class="dter" alt="">
                                <img src="../../DataV/images/06-3.png" class="dtsan" alt="">
                            </div>

                            <div class="mian_lef_lxdbcondk">
                                <ul class="mian_lef_lxdbcon clearfloat" id="devicetycount">
                                    <li><P>无负压设备  <i>0</i> </P></li>
                                    <li><P>BTG水箱设备  <i>0</i> </P></li>
                                    <li><P>ZBD设备  <i>0</i> </P></li>
                                    <li><P>BTG-B设备  <i>0</i> </P></li>
                                    <li><P>直饮水设备  <i>0</i> </P></li>
                                    <li><P>智能泵房  <i>0</i> </P></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 设备类型对比 end -->
                <!-- star 设备报警对比 -->
                <div class="zlw_sbbj">
                    <div class="zlw_sbbj_title">
                        <p>报警类型对比</p>
                    </div>
                    <div class="zlw_sbbjcon">
                        <!-- star 报警指标 -->
                        <div class="zlw_bjzb clearfloat">
                            <div class="zlw_bjzblf">
                                <div class="zlw_bjzblfyi">
                                    <p>报警指标</p>
                                </div>
                                <div class="zlw_bjzblfer">
                                    <p><span>报警数量</span><i id="eventcount">0</i></p>
                                    <p><span>总设备数量</span> <i id="devicecount">0</i> </p>
                                </div>
                            </div>
                            <div class="zlw_bjzbrg">
                                <div id="sbbj_bjzs_r"></div>
                            </div>
                        </div>
                        <!-- 报警指标 end -->
                        <!-- star 报警分类 -->
                        <div class="zlw_bjzb clearfloat">
                            <div class="zlw_bjzblf">
                                <div class="zlw_bjzblfyi">
                                    <p>报警分类指数</p>
                                </div>
                                <div class="zlw_bjzblfer zlw_bjerzblfer">
                                    <p><span>紧急报警</span><i id="level1">0</i></p>
                                    <p><span>一般报警</span><i id="level2">0</i> </p>
                                    <p><span>提示报警</span><i id="level3">0</i> </p>
                                </div>
                            </div>
                            <div class="zlw_bjzbrg">
                                <div id="sbbj_bjfl_r"></div>
                            </div>
                        </div>
                        <!-- 报警分类 end -->
                    </div>
                </div>
                <!-- 设备报警对比 end -->
            </div>
            <!-- left end -->
            <!-- star middle -->
            <div class="zlw_body_mid">
                <div class="zlw_body_con">
                    <!--  -->
                    <div class="zlw_body_conyi" id="zlw_body_conyi">
                        @*<div class="zlw_body_conyitop"></div>*@
                        <!-- 四个角直角 -->
                        <div class="dwtopl"></div>
                        <div class="dwtopr"></div>
                        <div class="dwbotl"></div>
                        <div class="dwbotr"></div>
                        <div class="map" id="container"></div>
                    </div>
                    <div class="zlw_body_coner">

                        <div class="zlw_body_conertitle">
                            <p>泵房统计</p>
                        </div>
                        <div class="zlw_body_conercon">
                            <ul class="clearfloat">
                                <li>
                                    <img src="~/DataV/images/全部泵房.png" alt="">
                                    <span id="stationNum">0</span>
                                    <p>泵房总数</p>
                                </li>
                                <li>
                                    <img src="~/DataV/images/正常泵房.png" alt="">
                                    <span id="okNum">0</span>
                                    <p>在线泵房</p>
                                </li>
                                <li>
                                    <img src="~/DataV/images/离线泵房.png" alt="">
                                    <span id="outNum">0</span>
                                    <p>离线泵房</p>
                                </li>
                                <li>
                                    <img src="~/DataV/images/报警泵房.png" alt="">
                                    <span id="alerNum">0</span>
                                    <p>报警泵房</p>
                                </li>


                            </ul>
                        </div>
                        <!-- 四个角直角 -->
                        <div class="xdwtopl"></div>
                        <div class="xdwtopr"></div>
                        <div class="xdwbotl"></div>
                        <div class="xdwbotr"></div>
                    </div>
                </div>
            </div>
            <!-- middle end -->
            <!-- star right -->
            <div class="zlw_body_rg">
                <div class="zlw_body_rg_top">
                    <ul class="clearfloat">
                        <!-- 通讯方式 -->
                        <li>
                            <div class="zlw_rg_title">
                                <p>本周报警Top5</p>
                            </div>
                            <div class="zlw_rg_content clearfloat">
                                <div class="zlw-ztnrrgkeryi" id="zlw-ztnrrgkeryi"></div>
                            </div>
                        </li>
                        <!-- 厂家对比 -->
                        <li>
                            <div class="zlw_rg_title">
                                <p>设备添加数量</p>
                            </div>
                            <div class="zlw_rg_content">
                                <div id="zlw-ztnrlf-botkconyi"></div>
                            </div>
                        </li>
                    </ul>
                </div>
                <!-- star 分区监控 -->
                <div class="zlw_body_rg_bottom">
                    <!-- 四个角直角 -->
                    <div class="xdwtopl"></div>
                    <div class="xxdwtopr"></div>
                    <div class="xdwbotl"></div>
                    <div class="xxdwbotr"></div>
                    <div class="zlw_body_rg_bottom_title">
                        <span>分区监控</span>
                        <span>进/出水(MPa)</span>
                        <span>出水瞬时(m³/h)</span>
                    </div>
                    <div class="zlw_body_rg_bottomcon">
                        <div id="marquee4">
                            <ul id="datalistul">
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- 分区监控 end -->
            </div>
            <!-- right end -->
        </div>
        <!-- body end -->
    </div>

    <script>

        // 报警指标
        var echartsSbbj_bjzs_r = echarts.init(document.getElementById('sbbj_bjzs_r'));
        var echartsSbbj_bjzs_rsetOption = ({
            series: [{
                type: 'liquidFill',
                radius: '70%',
                amplitude: '8%',
                data: [0.6],
                outline: {
                    show: false
                },
                shape: 'diamond',
                backgroundStyle: {
                    borderWidth: 4,
                    padding: 5,
                    borderColor: '#40a8ff',
                    color: 'rgba(0,0,0,0)'
                },
                itemStyle: {
                    normal: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0,
                            color: '#0A8AF9'
                        }, {
                            offset: 1,
                            color: '#5453FD'
                        }]),
                        shadowColor: '#6978F2',
                        shadowBlur: 20
                    }
                },
                label: {
                    normal: {
                        //formatter: (value * 100).toFixed(2) + '%',
                        textStyle: {
                            fontSize: 18,
                            color: '#53dbfd',
                            insideColor: '#ffffff'
                        }
                    }
                }
            }]

        })
        // 报警分类指数
        var echartSsbbj_bjfl_r = echarts.init(document.getElementById('sbbj_bjfl_r'));
        var echartSsbbj_bjfl_rsetOption = ({
            tooltip: {
                trigger: 'item',
                formatter: '{a} <br/>{b}: {c} ({d}%)'
            },
            // legend: {
            //     orient: 'vertical',
            //     left: -10,
            //     data: ['GPRS', '以太网', '互联网']
            // },
            color: ['#ff7200', '#02a4c7', '#e72847',],
            series: [
                {
                    name: '',
                    type: 'pie',
                    radius: ['50%', '70%'],
                    center: ["50%", "50%"],
                    avoidLabelOverlap: false,
                    label: {
                        normal: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            show: true,
                            textStyle: {
                                fontSize: '20',
                                fontWeight: 'bold'
                            }
                        }
                    },
                    labelLine: {
                        normal: {
                            show: false
                        }
                    },
                    data: [
                        { value: 335, name: '紧急报警' },
                        { value: 310, name: '一般报警' },
                        { value: 234, name: '提示报警' }
                    ]
                }
            ]
        })
        // 通讯方式
        var myChart5 = echarts.init(document.getElementById('zlw-ztnrrgkeryi'));
        // 指定图表的配置项和数据

        var myChart5setOption = ({
            color: ['#C25D74', '#EDABB4', '#9186ED'],
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            grid: {
                left: '5%',
                right: '10%',
                bottom: '3%',
                top: '3%',
                containLabel: true
            },
            xAxis: {
                type: 'value',
                boundaryGap: [0, 0.01],
                axisLabel: {
                    textStyle: {
                        fontSize: 12,
                        color: "#fff"
                    }
                },
                splitLine: {//控制网格的线条样式
                    show: true,
                    lineStyle: {
                        color: '#999',
                        width: 0,
                        type: 'deshed'
                    }
                }
            },
            yAxis: {
                type: 'category',
                data: ['小流量加压不成功', '软件超压', '定时停机', '设备下线', '小流量保压停机'],
                axisLabel: {
                    textStyle: {
                        fontSize: 12,
                        color: "#fff"
                    }
                }


            },
            series: [
                {
                    name: '数量',
                    type: 'bar',
                    barWidth: '50%',
                    data: [10, 20, 20, 30, 40, 45],
                    label: {
                        normal: {
                            show: true,
                            position: 'inside',
                            textStyle: {
                                color: '#fff'
                            }
                        },

                    },

                    itemStyle: {
                        //柱形图圆角，鼠标移上去效果
                        emphasis: {
                            color: new echarts.graphic.LinearGradient(
                                1, 1, 0, 1,
                                [
                                    { offset: 0, color: '#e56600' },
                                    { offset: 0.7, color: '#ee8027' },
                                    { offset: 1, color: '#f8a766' }
                                ]
                            )
                        },
                        normal: {
                            color: new echarts.graphic.LinearGradient(
                                1, 1, 0, 1,
                                [
                                    { offset: 0, color: '#f8a766' },
                                    { offset: 0.5, color: '#ee8027' },
                                    { offset: 1, color: '#e56600' }
                                ]
                            )
                        }
                    },

                    //itemStyle: {
                    //    normal: {
                    //        color: new echarts.graphic.LinearGradient(1, 0, 0, 0, [{
                    //            offset: 0,
                    //            color: "#009788" // 0% 处的颜色
                    //        }, {
                    //            offset: 0.6,
                    //            color: "#026A61" // 60% 处的颜色
                    //        }], false),
                    //    }
                    //}

                }

            ]
        });
        //设备添加数量
        var echartMain_rig_sbbj_top = echarts.init(document.getElementById('zlw-ztnrlf-botkconyi'));
        var echartMain_rig_sbbj_topsetOption = ({
            tooltip: {
                trigger: 'axis'
            },
            grid: {
                left: 35,
                right: 35,
                top: 20,
                bottom: 15,
                containLabel: true
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                axisLine: {//x轴的样式控制
                    show: true,　//显示与否
                    lineStyle: {//线条样式
                        color: '#2c345c',
                        width: 1,
                        type: 'solid'
                    }
                },
                axisLabel: {//控制x轴上的文字的样式
                    show: true,//显示与否
                    textStyle: {
                        color: '#a5ccfc',
                    },//控制x轴字体样式
                    fontSize: 12,
                    margin: 10,
                },
                data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月']
            },
            yAxis: [{
                type: 'value',
                //name : 'm³',
                nameTextStyle: {
                    color: '#fff',
                    fontSize: 15
                },
                splitLine: {//控制网格的线条样式
                    show: true,
                    lineStyle: {
                        color: {
                            type: 'linear',
                            x: 0,
                            y: 0,
                            x2: 1,
                            y2: 1,
                            colorStops: [{
                                offset: 0, color: 'rgba(7,25,82,0.4)' // 0% 处的颜色
                            },
                            {
                                offset: 0.5, color: 'rgba(87,98,133,1)' // 100% 处的颜色
                            },
                            {
                                offset: 1, color: 'rgba(7,25,82,0.4)' // 100% 处的颜色
                            }],
                            global: false // 缺省为 false
                        },
                        width: 1,
                        type: 'solid'
                    }
                },
                axisLine: {//x轴的样式控制
                    show: true,　//显示与否
                },
                axisTick: {
                    show: false,
                },
                axisLabel: {//控制x轴上的文字的样式
                    show: true,//显示与否
                    textStyle: {
                        color: '#a5ccfc',
                    },//控制x轴字体样式
                }
            }

            ],
            series: [
                {
                    type: 'line',
                    symbolSize: 5, // 设定实心点的大小
                    data: [320, 372, 171, 156, 210, 140, 180, 170, 165, 190, 222],
                    smooth: true,
                    itemStyle: {
                        color: '#1fbcfe'
                    },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0,
                            color: 'rgba(31, 188, 254,0.8)'
                        }, {
                            offset: 1,
                            color: 'rgba(31, 188, 254,0)'
                        }])
                    }
                }
            ]
        })
        // 跟随页面自适应
        window.onresize = function () {

            echartsSbbj_bjzs_r.resize();
            echartSsbbj_bjfl_r.resize();
            echartMain_rig_sbbj_top.resize();
            myChart5.resize();
        }
        var map;
        var layers = [];
        var myGroup;
        var mapselect;
        var infoWindow;
        var clusters;
        var isselect = 0;
        var areaname = '@Html.Raw(@ViewBag.AreaName)';


        //gis start

        var lng =@ViewBag.lng;
        var lat = @ViewBag.lat;
        var zoomend = @ViewBag.zoom;
        var isselect = 0;
        var view;
        var graphicsLayer;
        var ArcgisUrl = '@ViewBag.ArcgisUrl';
        var PipeUrl = '@ViewBag.PipeUrl';
        var graid = "";



        //表格滚动
        $(function () {

            initMap();
            //LoadDeviceType();
            LoadDeviceNewType();
            LoadEventType();
            LoadEventCount();
            //LoadEventRank();
            LoadNum();
            //LoadPumState();
            LoadDeviceUp();
            LoadJKData();


        })
        // 添加class
        $(function () {
            $(".zlw_header_menu  ul li").click(function () {
                $(this).siblings('.zlw_header_menu  ul li').removeClass('menuact');  // 删除其他兄弟元素的样式
                $(this).addClass('menuact');                            // 添加当前元素的样式
            });
        });


        //设备类型对比
        function LoadDeviceType() {
            $.post("/Sws/Sws_FullView/LoadDeviceChart", {}, function (data) {
                var jsData = JSON.parse(data);
                echartsMian_lef_lxdbsetOption.xAxis[0].data = jsData.devicetypeNatList;
                echartsMian_lef_lxdbsetOption.series[0].data = jsData.devicecount;
                echartsMian_lef_lxdb.setOption(echartsMian_lef_lxdbsetOption);
            })
        }
        //设备类型新对比
        function LoadDeviceNewType() {
            $.post("/Sws/Sws_FullView/LoadDeviceNewChart", {}, function (data) {
                var jsData = JSON.parse(data);
                $("#devicetycount").empty();
                var html = '';
                var itemLength = jsData.devicecount.length > 6 ? 6 : jsData.devicecount.length;

                for (var i = 0; i < itemLength; i++) {
                    html += '<li><P>' + jsData.devicecount[i].DeviceTypeName + ' <i>' + jsData.devicecount[i].CountRtu + '</i> </P></li>';
                }
                $("#devicetycount").append(html);
            })
        }
        //报警分类指数
        function LoadEventType() {
            $.post("/Sws/Sws_FullView/GetpieData", {}, function (data) {
                var jsData = JSON.parse(data);
                $("#level1").html(jsData.level1);
                $("#level2").html(jsData.level2);
                $("#level3").html(jsData.level3);
                echartSsbbj_bjfl_rsetOption.series[0].data = jsData.eventdata;
                echartSsbbj_bjfl_r.setOption(echartSsbbj_bjfl_rsetOption);
                //本周报警Top5
                myChart5setOption.yAxis.data = jsData.name;
                myChart5setOption.series[0].data = jsData.eventsourcelist;
                myChart5.setOption(myChart5setOption);
            })
        }
        //实时报警数量
        function LoadEventCount() {
            $.post("/Sws/Sws_FullView/LoadEventCount", {}, function (data) {
                var jsData = JSON.parse(data);
                $("#eventcount").html(jsData.allcount);
                $("#devicecount").html(jsData.alldevice);
                echartsSbbj_bjzs_rsetOption.series[0].data = jsData.prelist;
                echartsSbbj_bjzs_r.setOption(echartsSbbj_bjzs_rsetOption);
            })
        }
        //本周报警Top5
        function LoadEventRank() {
            $.post("/Sws/Sws_FullView/LoadEventRank", {}, function (data) {
                var jsData = JSON.parse(data);
                myChart5setOption.yAxis.data = jsData.name;
                myChart5setOption.series[0].data = jsData.eventsourcelist;
                myChart5.setOption(myChart5setOption);
            })
        }
        //获取在线离线数量
        function LoadNum() {
            $.post("/Sws/Map/QueryStationNum", {}, function (data) {
                $("#stationNum").html(data.allNum);
                $("#okNum").html(data.onlineNum);
                $("#alerNum").html(data.alarmNum);
                $("#outNum").html(data.offLineNum);
            })
        }
        //本年设备增长
        function LoadDeviceUp() {
            $.post("/Sws/Sws_FullView/loadDeviceUp", {}, function (data) {
                var jsData = JSON.parse(data);
                echartMain_rig_sbbj_topsetOption.xAxis.data = jsData.xAxis;
                echartMain_rig_sbbj_topsetOption.series[0].data = jsData.datas;
                echartMain_rig_sbbj_top.setOption(echartMain_rig_sbbj_topsetOption);
            })
        }
        //设备实时监控
        function LoadJKData() {
            $.post("/Sws/Sws_FullView/LoadDeviceJK", {}, function (data) {
                var jsData = JSON.parse(data);
                $("#datalistul").empty();
                var html = '';
                for (var i = 0; i < jsData.dataList.length; i++) {
                    html += '<li class="clearfloat">';
                    html += '<span>' + jsData.dataList[i].devicename + '</span>';
                    html += '<span>' + jsData.dataList[i].PressIN.Key + ' / ' + jsData.dataList[i].PressOut.Key + '</span>';
                    html += '<span>' + jsData.dataList[i].inflow + '</span>';
                    html += '</li>';
                }
                $("#datalistul").append(html);
                $("#marquee4").kxbdMarquee({ direction: "up", isEqual: false, scrollDelay: 80 });
            })
        }

        //地图初始化
         function initMap() {
            //proj4.defs("EPSG:2436", "+proj=tmerc +lat_0=0 +lon_0=117 +k=1 +x_0=500000 +y_0=0 +ellps=krass +towgs84=15.8,-154.4,-82.3,0,0,0,0 +units=m +no_defs");

            //var r = proj4("EPSG:2436", "EPSG:4326", [520061.79607555206, 2737925.6849408206]);
            /* var centerPoint = new L.LatLng(r[1], r[0]);*/
            var centerPoint = new L.LatLng(lat, lng);

            var crs1 = new L.Proj.CRS("EPSG:2436", "+proj=tmerc +lat_0=0 +lon_0=117 +k=1 +x_0=500000 +y_0=0 +ellps=krass +towgs84=15.8,-154.4,-82.3,0,0,0,0 +units=m +no_defs",
                {
                    origin: [-5123300.0, 10002300],  // 将刚刚的 Origin 复制到这里
                    resolutions: [                 // 所有的分辨率复制到这里
                        76.43695495724326,
                        38.21834518669038,
                        19.109040301413938,
                        9.554387858775717,
                        4.777061637456608,
                        2.3883985267970536,
                        1.1940669714672763,
                        0.5969011938023876,
                        0.2984505969011938
                    ]
                    /*bounds: L.bounds([516911.9087096499, 2739564.213902506], [522879.9046456418, 2744911.94059796])*/
                });


            var num = 6;
             map = L.map('container', { crs: crs1 }).setView(centerPoint, 0).setZoom(zoomend);
            var tileMapLayer = L.esri.tiledMapLayer({
                minzoom: 0,
                maxzoom: 6,
                url: ArcgisUrl
            });

            map.addLayer(tileMapLayer);

            var tileMapLayer1 = L.esri.dynamicMapLayer({
                url: PipeUrl
            });
            //监听地图级别
            map.on('zoomend', (e) => {
                var zoom = e.target.getZoom();
                LoadZoom(zoom);
            })
            map.addLayer(tileMapLayer1);
            myGroup = L.layerGroup();
        }
        //泵房地图数据加载
        function LoadPumState() {
            $.post("/Sws/Map/QueryTableData", { typecheck: "正常,故障,离线", stationName: ""}, function (data) {
                $("#stationData").empty();
                var html = "";
                for (var i = 0; i < data.dataTable.length; i++) {
                    html += '<div class="data_layersan_item clearfloat" onclick="Positioning(' + data.dataTable[i].stationID + ',1)">'
                    if (data.dataTable[i].state == "故障") {
                        html += '<span class="chaochu"><i class="hs"></i>' + data.dataTable[i].stationName + '</span>'
                    } else if (data.dataTable[i].state == "正常") {
                        html += '<span class="chaochu"><i></i>' + data.dataTable[i].stationName + '</span>'
                    } else {
                        html += '<span class="chaochu"><i class="huis"></i>' + data.dataTable[i].stationName + '</span>'
                    }


                    html += '<span>' + data.dataTable[i].updateTime + '</span>'
                    // html += ' <span><a href="javascript:void(0);" onClick="window.top.homeAddTab("sta'+data.dataTable[i].stationID+'","'+data.dataTable[i].stationName+'","/Sws/Sws_Detail/Index/'+data.dataTable[i].stationID+'")">详情</a></span>'
                    html += "<span><a href='javascript:void(0);' onClick=" + '"' + "window.top.homeAddTab('sta" + data.dataTable[i].stationID + "','" + data.dataTable[i].stationName + "','/Sws/Sws_Detail/Index/" + data.dataTable[i].stationID + "')" + '"' + "'>详情</a></span> </div>"
                    html += ' </div>'
                    var markericon;
                    //var marker;
                    if (data.dataTable[i].state == "故障") {
                        markericon = '' +
                            '<div>' +
                            '<div class="round">  ' +
                            '<div class="circle">' +
                            '<img src="../../images/bftb.png">' +
                            '</div> ' +
                            '<div class="circle_bottom animation "></div>' +
                            '<div class="circle_bottom2 animation2 "></div>' +
                            '</div>' +
                            '</div>';

                    } else if (data.dataTable[i].state == "正常") {
                        markericon = '' +
                            '<div>' +
                            '<div class="zhengchang">  ' +
                            '<div class="circle">' +
                            '<img src="../../images/bftb.png">' +
                            '</div> ' +
                            '<div class="circle_bottom animation "></div>' +
                            '<div class="circle_bottom2 animation2 "></div>' +
                            '</div>' +
                            '</div>';

                    } else {
                        markericon = '' +
                            '<div>' +
                            '<div class="xiaxian">  ' +
                            '<div class="circle">' +
                            '<img src="../../images/bftb.png">' +
                            '</div> ' +
                            '<div class="circle_bottom animation "></div>' +
                            '<div class="circle_bottom2 animation2 "></div>' +
                            '</div>' +
                            '</div>';

                    }
                    var icon = L.divIcon({
                        html: markericon,
                        iconSize: [80, 80],
                        className: 'map-circle'
                    });
                    var maker = L.marker([data.dataTable[i].lat, data.dataTable[i].lng], {
                        icon: icon
                    }).addTo(map)
                    var aa = data.dataTable[i].stationID;
                    Object.defineProperties(maker, {
                        id: {
                            value: aa
                        }
                    });
                    maker.on("mouseover", function (e) {
                        //var html = '<div class="makercon overflow clearfloat pad10px"><div class="maptitle"><i class="iconfont f24px icon-bengfang green"></i><p><span class="fb f16px" > 碧水绿洲（BTG）</span ></p ></div ><ul class="maplist"><li class="maplistnr1"><span>分区</span><span>进压力</span><span>出压力</span><span>出瞬时</span></li><li><span>低区</span><span>0</span><span>0.75</span><span>11</span></li><li><span>中区</span><span>0</span><span>1.1</span><span>8.8</span></li><li><span>高区</span><span>0</span><span>1.3</span><span>10.3</span></li></ul><div class="sj"></div></div >'
                        //maker.bindPopup(html).openPopup()
                        LoadStationJkData(e);
                    });
                    maker.on('mouseout', function (e) {
                        alert("aaa");
                    });
                    layers.push(maker);
                    myGroup = L.layerGroup(layers);
                    map.addLayer(myGroup);

                }
                $("#stationData").append(html);
            })
            /* LoadZPumState();*/
        }

        //根据不同的地图级别获取方法
        function LoadZoom(zoom) {
            //for (var i = 0; i < myGroup.length; i++) {

            //    map.removeLayer(myGroup[i]);
            //}
            myGroup.clearLayers();
            layers = [];
            console.log(layers);
            if (zoom > 5) {
                LoadZoomData(zoom);
            } else {
                $.post("/Sws/Map/QueryTableData", { typecheck: "正常,故障,离线", stationName: "" }, function (data) {
                    var markericon;
                    for (var i = 0; i < data.dataTable.length; i++) {
                        if (data.dataTable[i].state == "故障") {
                            markericon = '' +
                                '<div>' +
                                '<div class="round">  ' +
                                '<div class="circle">' +
                                '<img src="../../images/bftb.png">' +
                                '</div> ' +
                                '<div class="circle_bottom animation "></div>' +
                                '<div class="circle_bottom2 animation2 "></div>' +
                                '</div>' +
                                '</div>';
                        } else if (data.dataTable[i].state == "正常") {

                            markericon = '' +
                                '<div>' +
                                '<div class="zhengchang">  ' +
                                '<div class="circle">' +
                                '<img src="../../images/bftb.png">' +
                                '</div> ' +
                                '<div class="circle_bottom animation "></div>' +
                                '<div class="circle_bottom2 animation2 "></div>' +
                                '</div>' +
                                '</div>';
                        } else {

                            markericon = '' +
                                '<div>' +
                                '<div class="xiaxian">  ' +
                                '<div class="circle">' +
                                '<img src="../../images/bftb.png">' +
                                '</div> ' +
                                '<div class="circle_bottom animation "></div>' +
                                '<div class="circle_bottom2 animation2 "></div>' +
                                '</div>' +
                                '</div>';
                        }
                        var icon = L.divIcon({
                            html: markericon,
                            iconSize: [80, 80],
                            className: 'map-circle'
                        });
                        var maker = L.marker([data.dataTable[i].lat, data.dataTable[i].lng], {
                            icon: icon
                        }).addTo(map)
                        var aa = data.dataTable[i].stationID;
                        Object.defineProperties(maker, {
                            id: {
                                value: aa
                            }
                        });
                        maker.on("mouseover", function (e) {
                            LoadStationJkData(e);
                        })
                        layers.push(maker);
                        myGroup = L.layerGroup(layers);
                        map.addLayer(myGroup);
                    }

                })


            }
        }
        function LoadZoomData(zoomlevel) {
            $.post("/Sws/Map/QueryTableData", { typecheck: "正常,故障,离线", stationName: "" }, function (data) {

                if (isselect == 1) {
                    if (data.toLat != 0 && data.toLng != 0) {

                    }
                    isselect = 0;
                }
                myGroup.clearLayers();
                layers = [];
                var markericon;
                for (var i = 0; i < data.dataTable.length; i++) {
                    if (5 <= zoomlevel && zoomlevel <= 6) {
                        //var marker;
                        if (data.dataTable[i].state == "故障") {
                            markericon = '' +
                                '<div>' +
                                '<div class="round">  ' +
                                '<div class="circle">' +
                                '<img src="../../images/bftb.png">' +
                                '</div> ' +
                                '<div class="circle_bottom animation "></div>' +
                                '<div class="circle_bottom2 animation2 "></div>' +
                                '</div>' +
                                '</div>';
                        } else if (data.dataTable[i].state == "正常") {
                            markericon = '' +
                                '<div>' +
                                '<div class="zhengchang">  ' +
                                '<div class="circle">' +
                                '<img src="../../images/bftb.png">' +
                                '</div> ' +
                                '<div class="circle_bottom animation "></div>' +
                                '<div class="circle_bottom2 animation2 "></div>' +
                                '</div>' +
                                '</div>';
                        } else {
                            markericon = '' +
                                '<div>' +
                                '<div class="xiaxian">  ' +
                                '<div class="circle">' +
                                '<img src="../../images/bftb.png">' +
                                '</div> ' +
                                '<div class="circle_bottom animation "></div>' +
                                '<div class="circle_bottom2 animation2 "></div>' +
                                '</div>' +
                                '</div>';
                        }
                        var icon = L.divIcon({
                            html: markericon,
                            iconSize: [80, 80],
                            className: 'map-circle'
                        });
                        var maker = L.marker([data.dataTable[i].lat, data.dataTable[i].lng], {
                            icon: icon
                        }).addTo(map)
                        var aa = data.dataTable[i].stationID;
                        Object.defineProperties(maker, {
                            id: {
                                value: aa
                            }
                        });
                        maker.on("mouseover", function (e) {
                            //var html = '<div class="makercon overflow clearfloat pad10px"><div class="maptitle"><i class="iconfont f24px icon-bengfang green"></i><p><span class="fb f16px" > 碧水绿洲（BTG）</span ></p ></div ><ul class="maplist"><li class="maplistnr1"><span>分区</span><span>进压力</span><span>出压力</span><span>出瞬时</span></li><li><span>低区</span><span>0</span><span>0.75</span><span>11</span></li><li><span>中区</span><span>0</span><span>1.1</span><span>8.8</span></li><li><span>高区</span><span>0</span><span>1.3</span><span>10.3</span></li></ul><div class="sj"></div></div >'
                            //maker.bindPopup(html).openPopup()
                            LoadStationJkData(e);
                        })
                        layers.push(maker);
                        myGroup = L.layerGroup(layers);
                        map.addLayer(myGroup);
                    }
                    /*else if (zoomlevel == 13) {*/
                    else if (zoomlevel >= 7) {
                        //var marker;
                        markericon = '' +
                            //报警 替换下面bgGreen 为 bgRed
                            '<div class="mapiconbox overflow  clearfloat bgGreen zlwdb">' +
                            '<span class="left"><i class="iconfont f18px icon-bengfang white pl5px pr5px"></i></span><p class="left">出瞬流 0.70</p>' +
                            '</div>';

                        if (data.dataTable[i].state == "故障") {
                            markericon = '' +
                                //报警 替换下面bgGreen 为 bgRed
                                '<div class="mapiconbox overflow  clearfloat  bgRed zlwdb">' +
                                '<span class="left"><i class="iconfont f18px icon-bengfang white pl5px pr5px"></i></span><p>出瞬流 ' + data.dataTable[i].allInFlow + '</p>' +
                                '</div>';

                        } else if (data.dataTable[i].state == "正常") {
                            markericon = '' +
                                //报警 替换下面bgGreen 为 bgRed
                                '<div class="mapiconbox overflow clearfloat bgGreen zlwdb">' +
                                '<span class="left"><i class="iconfont f18px icon-bengfang white pl5px pr5px"></i></span><p>出瞬流 ' + data.dataTable[i].allInFlow + '</p>' +
                                '</div>';

                        } else {
                            markericon = '' +
                                //报警 替换下面bgGreen 为 bgRed
                                '<div class="mapiconbox overflow clearfloat bgGray zlwdb">' +
                                '<span class="left"><i class="iconfont f18px icon-bengfang white pl5px pr5px"></i></span><p>出瞬流 ' + data.dataTable[i].allInFlow + '</p>' +
                                '</div>';

                        }
                        var icon = L.divIcon({
                            html: markericon,
                            iconSize: [80, 80],
                            className: 'map-circle'
                        });
                        var maker = L.marker([data.dataTable[i].lat, data.dataTable[i].lng], {
                            icon: icon
                        }).addTo(map)
                        var aa = data.dataTable[i].stationID;
                        Object.defineProperties(maker, {
                            id: {
                                value: aa
                            }
                        });
                        maker.on("mouseover", function (e) {
                            //var html = '<div class="makercon overflow clearfloat pad10px"><div class="maptitle"><i class="iconfont f24px icon-bengfang green"></i><p><span class="fb f16px" > 碧水绿洲（BTG）</span ></p ></div ><ul class="maplist"><li class="maplistnr1"><span>分区</span><span>进压力</span><span>出压力</span><span>出瞬时</span></li><li><span>低区</span><span>0</span><span>0.75</span><span>11</span></li><li><span>中区</span><span>0</span><span>1.1</span><span>8.8</span></li><li><span>高区</span><span>0</span><span>1.3</span><span>10.3</span></li></ul><div class="sj"></div></div >'
                            //maker.bindPopup(html).openPopup()
                            LoadStationJkData(e);
                        })
                        layers.push(maker);
                        myGroup = L.layerGroup(layers);
                        map.addLayer(myGroup);
                    }
                    else if (zoomlevel > 18) {//设置18是为了不显示这一层
                        var markerContent = '';
                        if (data.dataTable[i].state == "故障") {
                            markerContent += '<div class="textCenter makercon-left"><i class="iconfont f24px icon-bengfang red"></i><p class="mt5px">二供泵房</p></div>';

                        } else if (data.dataTable[i].state == "正常") {
                            markerContent += '<div class="textCenter makercon-left"><i class="iconfont f24px icon-bengfang green"></i><p class="mt5px">二供泵房</p></div>';
                        } else {
                            markerContent += '<div class="textCenter makercon-left"><i class="iconfont f24px icon-bengfang gray"></i><p class="mt5px">二供泵房</p></div>';
                        }
                        markerContent += '<div class="makercon-right">';
                        markerContent += '<p class="f16px fb ellipsis1">' + data.dataTable[i].stationName + '</p>';
                        markerContent += '<div class="green f16px fb tb-f">';
                        var szstr = '';//各区数值
                        var fqstr = '<div class="tb-f f12px">';//各区名称
                        if (data.dataTable[i].deviceJKs.length > 0) {
                            for (var j = 0; j < data.dataTable[i].deviceJKs.length; j++) {
                                if (data.dataTable[i].deviceJKs[j].pressOut.Value == true) {
                                    szstr += '<span class="red">' + data.dataTable[i].deviceJKs[j].pressOut.Key + '</span>'
                                } else {
                                    szstr += '<span>' + data.dataTable[i].deviceJKs[j].pressOut.Key + '</span>'
                                }
                                if (data.dataTable[i].deviceJKs[j].partition == 1) {
                                    fqstr += '<span>低区</span>'
                                } else if (data.dataTable[i].deviceJKs[j].partition == 2) {
                                    fqstr += '<span>中区</span>'
                                }
                                else if (data.dataTable[i].deviceJKs[j].partition == 3) {
                                    fqstr += '<span>高区</span>'
                                }
                                else if (data.dataTable[i].deviceJKs[j].partition == 4) {
                                    fqstr += '<span>超高区</span>'
                                } else if (data.dataTable[i].deviceJKs[j].partition == 5) {
                                    fqstr += '<span>超超高区</span>';
                                } else if (data.dataTable[i].deviceJKs[j].partition == 6) {

                                    fqstr += '<span>智能泵房</span>';
                                }
                            }
                            fqstr += '</div>';
                            szstr += '</div>';
                            markerContent += szstr + fqstr;
                        }
                        markerContent += '</div></div><div class="sj">';
                        var icon = L.divIcon({
                            html: markerContent,
                            iconSize: [80, 80],
                            className: 'map-circle'
                        });
                        var maker = L.marker([data.dataTable[i].lat, data.dataTable[i].lng], {
                            icon: icon
                        }).addTo(map)
                        var aa = data.dataTable[i].stationID;
                        Object.defineProperties(maker, {
                            id: {
                                value: aa
                            }
                        });
                        maker.on("mouseover", function (e) {
                            //var html = '<div class="makercon overflow clearfloat pad10px"><div class="maptitle"><i class="iconfont f24px icon-bengfang green"></i><p><span class="fb f16px" > 碧水绿洲（BTG）</span ></p ></div ><ul class="maplist"><li class="maplistnr1"><span>分区</span><span>进压力</span><span>出压力</span><span>出瞬时</span></li><li><span>低区</span><span>0</span><span>0.75</span><span>11</span></li><li><span>中区</span><span>0</span><span>1.1</span><span>8.8</span></li><li><span>高区</span><span>0</span><span>1.3</span><span>10.3</span></li></ul><div class="sj"></div></div >'
                            //maker.bindPopup(html).openPopup()
                            LoadStationJkData(e);
                        })
                        layers.push(maker);
                        myGroup = L.layerGroup(layers);
                        map.addLayer(myGroup);
                    }
                    else if (zoomlevel < 10) {

                    }
                }
                /* LoadZZoomData(map.getZoom());*/
            })

        }
        function LoadStationJkData(e) {
            $.post("/Sws/Map/LoadDataByStationID", { id: e.target.id }, function (data) {
                if (data != null) {
                    var clore = '';
                    if (data.jk.state == "故障") {
                        clore = 'red';
                    } else if (data.jk.state == "正常") {
                        clore = 'green';
                    } else {
                        clore = 'gray';
                    }
                    var table = '<div class="makercon overflow clearfloat pad10px">';
                    //table += '<div class="maptitle"><i class="iconfont f24px icon-bengfang ' + clore + '"></i><p><span class="fb f16px">' + data.jk.stationName + '</span></p></div>';
                    //table += '<div class="maptitle"><i class="iconfont f24px icon-bengfang ' + clore + '"></i><p><span class="fb f16px">' + data.jk.stationName + '</span></p></div>';
                    table += "<div class='maptitle'><i class='iconfont f24px icon-bengfang " + clore + "'></i><p><span class='fb f16px' onClick=" + '"' + "window.top.homeAddTab('sta" + data.jk.stationID + "','" + data.jk.stationName + "','/Sws/Sws_Detail/Index/" + data.jk.stationID + "')" + '"' + "'>" + data.jk.stationName + "</span></p></div>";
                    table += '<ul class="maplist">';
                    table += '<li class="maplistnr1" ><span>分区</span><span>进水压力</span><span>出水压力</span><span>出水瞬时</span></li>';
                    if (data.jk.deviceJKs.length > 0) {
                        for (var i = 0; i < data.jk.deviceJKs.length; i++) {
                            var pin = data.jk.deviceJKs[i].pressIN;
                            var pout = data.jk.deviceJKs[i].pressOut;
                            if (data.jk.deviceJKs[i].partition == "1") {
                                table += '<li><span>低区</span>';
                            } else if (data.jk.deviceJKs[i].partition == "2") {
                                table += '<li><span>中区</span>';
                            }
                            else if (data.jk.deviceJKs[i].partition == "3") {
                                table += '<li><span>高区</span>';
                            }
                            else if (data.jk.deviceJKs[i].partition == "4") {
                                table += '<li><span>超高区</span>';
                            } else if (data.jk.deviceJKs[i].partition == "5") {
                                table += '<li><span>超超高区</span>';
                            } else if (data.jk.deviceJKs[i].partition == "6") {
                                table += '<li><span>智能泵房</span>';
                            }
                            if (pin.Value == true) {
                                table += '<span class="red">' + pin.Key + ' MPa' + '</span>'
                            } else {
                                table += '<span>' + pin.Key + ' MPa' + '</span>'
                            }
                            if (pout.Value == true) {
                                table += '<span class="red">' + pout.Key + ' MPa' + '</span>'
                            } else {
                                table += '<span>' + pout.Key + ' MPa' + '</span>'
                            }
                            table += '<span>' + data.jk.deviceJKs[i].inflow + ' m³/h' + '</span>'
                            table += '</li>'
                        }
                    }
                    table += '</ul><div class="sj"></div>';
                    //var popup =  L.Popup().setLatLng(e.latlng).setContent(table);
                    //map.openPopup(popup); 
                    var popup = L.popup({
                        offset: [-10, -20]
                    })
                        .setLatLng(e.latlng)
                        .setContent(table)
                        .openOn(map);
                }
            })
        }
    </script>
    <script>
        $(function () {

        })

    </script>
</body>
</html>