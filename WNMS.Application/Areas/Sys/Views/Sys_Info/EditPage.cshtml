
@{
    Layout = null;
}

<!DOCTYPE html>
@using WNMS.Model.CustomizedClass;
@model SystemInfo
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>_SetRtuInfo</title>
    <link rel="stylesheet" href="~/css/font-awesome.min.css">
    <link rel="stylesheet" href="~/css/bootstrap.min.css">
    <link href="~/lib/layer/layer.css" rel="stylesheet" />
    <link href="~/css/hyl.css" rel="stylesheet" />
    <link href="~/lib/jquery-validation/dist/validation.css" rel="stylesheet" />
    <link href="~/lib/webuploader/webuploader.css" rel="stylesheet" />
    <script src="~/js/jquery-1.12.4.min.js"></script>
    <script src="~/js/jquery.unobtrusive-ajax.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/layer/layer.js"></script>
    <style>
        .star {
            position: absolute;
            top: -4px;
            font-size: 25px;
            color: red
        }
    </style>
</head>
<body>
    <div style="padding:20px 30px" class="xiugai">
        <form id="MFForm">
            <div class="box-body">
                <div class="row">
                    <div class="col-sm-12 z-indx">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="form-group relative">
                                    <label for="SystemName">系统名称</label><span class="star">*</span>
                                    <div class="input-group">
                                        <div class="input-group-addon">
                                            <i class="fa fa-pencil-square-o"></i>
                                        </div>
                                        <input type="text" class="form-control" id="SystemName" name="SystemName" value="@Model.SystemName">
                                    </div>

                                </div>
                            </div>
                            <div class="col-sm-6 relative">
                                <div class="form-group relative">
                                    <label for="SystemEngName">英文名称</label><span class="star">*</span>
                                    <div class="input-group">
                                        <div class="input-group-addon">
                                            <i class="fa fa-address-book-o"></i>
                                        </div>
                                        <input type="text" class="form-control" id="SystemEngName" name="SystemEngName" value="@Model.SystemEngName">
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12  z-indx">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="form-group" style="position:relative;">
                                    <label for="MapLevel">地图缩放级别</label><span class="star">*</span>
                                    <div class="input-group">
                                        <div class="input-group-addon">
                                            <i class="fa fa-sitemap"></i>
                                        </div>
                                        <input type="text" class="form-control" id="MapLevel" name="MapLevel" value="@Model.MapLevel">
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group relative">
                                    <label for="btnGIS">配置坐标</label><span class="star">*</span>
                                    <div class="input-group">
                                        <div class="input-group-addon">
                                            <i class="fa fa-map"></i>
                                        </div>
                                        <input type="button" value="配置坐标" id="btnGIS" name="btnGIS" class="form-control" />
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="col-sm-12  z-indx">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="form-group relative">
                                    <label for="Lng">经度<span class="star">*</span></label>
                                    <div class="input-group">
                                        <div class="input-group-addon">
                                            <i class="fa fa-map-marker"></i>
                                        </div>
                                        <input type="text" class="form-control" name="Lng" id="Lng" value="@Model.Lng">
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group relative">
                                    <label for="Lat">纬度<span class="star">*</span></label>
                                    <div class="input-group">
                                        <div class="input-group-addon">
                                            <i class="fa fa-map-marker"></i>
                                        </div>
                                        <input type="text" class="form-control" name="Lat" id="Lat" value="@Model.Lat">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12  z-indx">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="form-group relative">
                                    <label for="AreaName">坐标城市<span class="star">*</span></label>
                                    <div class="input-group">
                                        <div class="input-group-addon">
                                            <i class="fa fa-map-marker"></i>
                                        </div>
                                        <input type="text" class="form-control" name="AreaName" id="AreaName" value="@Model.AreaName">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12  z-indx">
                        <div class="form-group" style="padding:1em">
                            <div class="mb10px">Logo图片：</div>
                            <div class="ml15px">
                                @if (string.IsNullOrEmpty(Model.Logo))
                                {
                                    <h3 class="gray" style="width:150px;height:150px;text-align:center;line-height:150px;background:#eee">暂无设备图片</h3>
                                }
                                else
                                {
                                    <img width="150" height="150" src="@Url.Content("/UploadImg/Logo/"+Model.Logo)" alt="images" />
                                }
                            </div>
                            <div style="margin-top:10px;margin-bottom:10px;">修改Logo图片：</div>
                            <div id="fileList" class="uploader-list"></div>
                            <div id="filePicker">选择图片</div>
                            <input type="button" class="uploadBtn" value="开始上传" id="btnUpload" style="margin-left:15px;padding:4px 12px;border-radius:3px;border:none;background:#0094ff;color:#fff" />
                        </div>
                        <input id="Logo" name="Logo" type="hidden" value="@Model.Logo" />
                    </div>

                    <div class="col-sm-12  z-indx">
                        <div class="form-group" style="padding:1em">
                            <div class="mb10px">Logo图片2：</div>
                            <div class="ml15px">
                                @if (string.IsNullOrEmpty(Model.Logo2))
                                {
                                    <h3 class="gray" style="width:150px;height:150px;text-align:center;line-height:150px;background:#eee">暂无设备图片</h3>
                                }
                                else
                                {
                                    <img width="150" height="150" src="@Url.Content("/UploadImg/Logo/"+Model.Logo2)" alt="images" />
                                }
                            </div>
                            <div style="margin-top:10px;margin-bottom:10px;">修改Logo图片2：</div>
                            <div id="fileList2" class="uploader-list"></div>
                            <div id="filePicker2">选择图片</div>
                            <input type="button" class="uploadBtn" value="开始上传" id="btnUpload2" style="margin-left:15px;padding:4px 12px;border-radius:3px;border:none;background:#0094ff;color:#fff" />
                        </div>
                        <input id="Logo2" name="Logo2" type="hidden" value="@Model.Logo2" />
                    </div>

                </div>
    </div>

    </form>
    </div>
    <script src="~/lib/webuploader/webuploader.min.js"></script>
    <script type="text/javascript">
        var index = parent.layer.getFrameIndex(window.name);
        $(function () {
            if (@Model.Lng== 0) {
                $("#Lng").val("");
                $("#Lat").val("");
            }
            validateForm();

            //图片上传
            var $list = $('#fileList'),
                $list2 = $('#fileList2'),
                ratio = window.devicePixelRatio || 1,

                // 缩略图大小
                thumbnailWidth = 100 * ratio,
                thumbnailHeight = 100 * ratio,

                // Web Uploader实例
                uploader, uploader2;

            // 初始化Web Uploader
            uploader = WebUploader.create({
                formData: {
                    //deviceid: idflag,
                },
                // 自动上传。
                auto: false,

                // swf文件路径
                swf: '~/Content/webuploader-0.1.5/Uploader.sw',

                // 文件接收服务端。
                server: '/Sys/Sys_Info/UpLoadImg/1111',

                // 选择文件的按钮。可选。
                // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                pick: {
                    id: '#filePicker',
                    multiple: false
                },
                fileNumLimit:1,
                // 只允许选择文件，可选。
                accept: {
                    title: 'Images',
                    extensions: 'gif,jpg,jpeg,bmp,png',
                    mimeTypes: 'image/*'
                }
            });

            // 当有文件添加进来的时候
            uploader.on('fileQueued', function (file) {
                var $li = $(
                    '<div id="' + file.id + '" class="file-item thumbnail">' +
                    '<img>' +
                    '<div class="info">删除</div>' +
                    '</div>'
                ),
                    $img = $li.find('img');

                $list.append($li);
                $li.on('click', '.info', function () {
                    $("#"+file.id).remove();
                    uploader.removeFile(file, true);
                    //uploader.reset();
                });
                // 创建缩略图
                uploader.makeThumb(file, function (error, src) {
                    if (error) {
                        $img.replaceWith('<span>不能预览</span>');
                        return;
                    }

                    $img.attr('src', src);
                }, thumbnailWidth, thumbnailHeight);
            });

            // 文件上传过程中创建进度条实时显示。
            uploader.on('uploadProgress', function (file, percentage) {
                var $li = $('#' + file.id),
                    $percent = $li.find('.progress span');

                // 避免重复创建
                if (!$percent.length) {
                    $percent = $('<p class="progress"><span></span></p>')
                        .appendTo($li)
                        .find('span');
                }

                $percent.css('width', percentage * 100 + '%');
            });

            // 文件上传成功，给item添加成功class, 用样式标记上传成功。
            uploader.on('uploadSuccess', function (file, response) {
                $('#' + file.id).addClass('upload-state-done');
                var name = response._raw;
                $("#Logo").val(file.name);
                layer.msg("上传成功", {
                    offset: 't',
                    anim: 6
                });
            });

            // 文件上传失败，现实上传出错。
            uploader.on('uploadError', function (file) {
                var $li = $('#' + file.id),
                    $error = $li.find('div.error');

                // 避免重复创建
                if (!$error.length) {
                    $error = $('<div class="error"></div>').appendTo($li);
                }

                $error.text('上传失败');
            });

            // 完成上传完了，成功或者失败，先删除进度条。
            uploader.on('uploadComplete', function (file) {
                $('#' + file.id).find('.progress').remove();
            });

            $("#btnUpload").click(function () {
                uploader.upload();
            });


            // 初始化Web Uploader2
            uploader2 = WebUploader.create({
                formData: {
                    //deviceid: idflag,
                },
                // 自动上传。
                auto: false,

                // swf文件路径
                swf: '~/Content/webuploader-0.1.5/Uploader.sw',

                // 文件接收服务端。
                server: '/Sys/Sys_Info/UpLoadImg/1111',

                // 选择文件的按钮。可选。
                // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                pick: {
                    id: '#filePicker2',
                    multiple: false
                },
                fileNumLimit: 1,
                // 只允许选择文件，可选。
                accept: {
                    title: 'Images',
                    extensions: 'gif,jpg,jpeg,bmp,png',
                    mimeTypes: 'image/*'
                }
            });

            // 当有文件添加进来的时候
            uploader2.on('fileQueued', function (file) {
                var $li = $(
                    '<div id="' + file.id + '" class="file-item thumbnail">' +
                    '<img>' +
                    '<div class="info">删除</div>' +
                    '</div>'
                ),
                    $img = $li.find('img');

                $list2.append($li);
                $li.on('click', '.info', function () {
                    $("#" + file.id).remove();
                    uploader2.removeFile(file, true);
                    //uploader2.reset();
                });
                // 创建缩略图
                uploader2.makeThumb(file, function (error, src) {
                    if (error) {
                        $img.replaceWith('<span>不能预览</span>');
                        return;
                    }

                    $img.attr('src', src);
                }, thumbnailWidth, thumbnailHeight);
            });

            // 文件上传过程中创建进度条实时显示。
            uploader2.on('uploadProgress', function (file, percentage) {
                var $li = $('#' + file.id),
                    $percent = $li.find('.progress span');

                // 避免重复创建
                if (!$percent.length) {
                    $percent = $('<p class="progress"><span></span></p>')
                        .appendTo($li)
                        .find('span');
                }

                $percent.css('width', percentage * 100 + '%');
            });

            // 文件上传成功，给item添加成功class, 用样式标记上传成功。
            uploader2.on('uploadSuccess', function (file, response) {
                $('#' + file.id).addClass('upload-state-done');
                var name = response._raw;
                $("#Logo2").val(file.name);
                layer.msg("上传成功", {
                    offset: 't',
                    anim: 6
                });
            });

            // 文件上传失败，现实上传出错。
            uploader2.on('uploadError', function (file) {
                var $li = $('#' + file.id),
                    $error = $li.find('div.error');

                // 避免重复创建
                if (!$error.length) {
                    $error = $('<div class="error"></div>').appendTo($li);
                }

                $error.text('上传失败');
            });

            // 完成上传完了，成功或者失败，先删除进度条。
            uploader2.on('uploadComplete', function (file) {
                $('#' + file.id).find('.progress').remove();
            });

            $("#btnUpload2").click(function () {
                uploader2.upload();
            });
        });

        //配置坐标
        $("#btnGIS").click(function () {
            getGIS();
        });
        function getGIS() {
            window.parent.layer.open({
                type: 2,
                title: "坐标配置",
                //title: false,
                shadeClose: true,
                shade: [0.1, '#000'],
                area: ["1200px", "800px"],
                offset: 'rt',
                anim: 2,
                content: "/Sws/Sws_Station/GetMap/"
            });
        }

        //表单验证
        function validateForm() {
            $("#MFForm").validate({
                ignore: "",
                rules: {
                    MapLevel: {
                        required: true,
                        digits: true,
                        min: 1,
                        max: 18
                    },
                    Lng: {
                        required: true,
                        number: true
                    },
                    Lat: {
                        required: true,
                        number: true
                    },
                    Logo: "required",
                    SystemName: "required",
                    SystemEngName: "required",
                     AreaName: "required",
                },
                messages: {
                    MapLevel: {
                        required: "请输入地级别",
                        digits: "请输入数字",
                        min: "请输入0到18之间的数字",
                        max: "请输入0到18之间的数字"
                    },
                    Lng: {
                        required: "请输入经度",
                        number: "请输入数字"
                    },
                    Lat: {
                        required: "请输入经度",
                        number: "请输入数字"
                    },
                    Logo: "请上传图片",
                    SystemName: "请输入系统名称",
                    SystemEngName: "请输入英文名称",
                     AreaName: "请输入坐标城市",
                }
            });
        }

        //表单提交
        function saveForm(func) {
            if ($("form").valid()) {
                $.ajax({
                    url: '/Sys/Sys_Info/SetSystemInfo',
                    type: 'post',
                    data: $("form").serializeArray(),
                    success: function (data) {
                        func(data);
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(errorThrown);
                    }
                });
            }
        }
    </script>
</body>
</html>
