/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../TimeInterval.js";import{i,b as s,e as n,l as o}from"../core/lang.js";import a from"../core/Collection.js";import{n as r}from"../chunks/compilerUtils.js";import{o as l}from"../core/promiseUtils.js";import{t as m}from"../chunks/throttle.js";import{t as u,o as c}from"../chunks/timeUtils.js";import{init as d}from"../core/watchUtils.js";import{aliasOf as p}from"../core/accessorSupport/decorators/aliasOf.js";import"../chunks/ensureType.js";import{property as h}from"../core/accessorSupport/decorators/property.js";import{subclass as v}from"../core/accessorSupport/decorators/subclass.js";import{a as w,c as y}from"../chunks/number.js";import f from"./Slider.js";import x from"./Widget.js";import{a as k}from"../chunks/accessibleHandler.js";import{m as j}from"../chunks/messageBundle.js";import"../chunks/Logger.js";import{v as b}from"../chunks/vmEvent.js";import{t as _}from"../chunks/jsxFactory.js";import{l as g}from"../chunks/widgetUtils.js";import T from"./TimeSlider/TimeSliderViewModel.js";import"../chunks/JSONSupport.js";import"../core/Accessor.js";import"../chunks/deprecate.js";import"../chunks/metadata.js";import"../chunks/handleUtils.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../core/Error.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";import"../chunks/jsonMap.js";import"../chunks/Evented.js";import"../chunks/shared.js";import"../chunks/locale.js";import"../intl.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/ResizeObserver.js";import"../chunks/_commonjsHelpers.js";import"./Slider/SliderViewModel.js";import"../chunks/domUtils.js";import"../core/Handles.js";import"../chunks/Promise.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../TimeExtent.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../core/HandleOwner.js";import"../chunks/reactiveUtils.js";import"../chunks/Widgets.js";import"../support/timeUtils.js";const E="esri-time-slider",S={widgetIcon:"esri-icon-time-clock",esriWidget:"esri-widget",esriWidgetButton:"esri-widget--button",esriButtonDisabled:"esri-button--disabled",esriDisabled:"esri-disabled",timeSlider:`${E}`,timeSliderOutOfBounds:`${E}--out-of-bounds`,timeSliderMode:`${E}__mode--`,timeSliderLayout:`${E}__layout--`,timeSliderRow:`${E}__row`,animation:`${E}__animation`,animationButton:`${E}__animation-button`,animationPlay:"esri-icon-play",animationPause:"esri-icon-pause",timeExtent:`${E}__time-extent`,timeExtentGroup:`${E}__time-extent-group`,timeExtentDate:`${E}__time-extent-date`,timeExtentTime:`${E}__time-extent-time`,timeExtentSeparator:`${E}__time-extent-separator`,playbackControls:`${E}__playback-controls`,min:`${E}__min`,minDate:`${E}__min-date`,minTime:`${E}__min-time`,slider:`${E}__slider`,sliderMajorTick:"majorTick",sliderMinorTick:"minorTick",max:`${E}__max`,maxDate:`${E}__max-date`,maxTime:`${E}__max-time`,previous:`${E}__previous`,previousButton:`${E}__previous-button`,previousIcon:"esri-icon-reverse",next:`${E}__next`,nextButton:`${E}__next-button`,nextIcon:"esri-icon-forward",warning:`${E}__warning`,warningIcon:"esri-icon-notice-triangle",warningText:`${E}__warning-text`,hasActions:`${E}--has-actions`,actions:`${E}__actions`,actionsButton:`${E}__actions-button`},M=new a([{minor:new t({value:100,unit:"milliseconds"}),major:new t({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new t({value:500,unit:"milliseconds"}),major:new t({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new t({value:1,unit:"seconds"}),major:new t({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new t({value:2,unit:"seconds"}),major:new t({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new t({value:10,unit:"seconds"}),major:new t({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new t({value:15,unit:"seconds"}),major:new t({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:1,unit:"minutes"}),major:new t({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:5,unit:"minutes"}),major:new t({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:15,unit:"minutes"}),major:new t({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new t({value:1,unit:"hours"}),major:new t({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new t({value:6,unit:"hours"}),major:new t({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new t({value:1,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"long"}},{minor:new t({value:2,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"short"}},{minor:new t({value:3,unit:"days"}),major:new t({value:1,unit:"months"}),format:{month:"short"}},{minor:new t({value:4,unit:"days"}),major:new t({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new t({value:1,unit:"weeks"}),major:new t({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:1,unit:"months"}),major:new t({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:2,unit:"months"}),major:new t({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new t({value:1,unit:"years"}),major:new t({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new t({value:2,unit:"years"}),major:new t({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new t({value:5,unit:"decades"}),major:new t({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:1,unit:"centuries"}),major:new t({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:2,unit:"centuries"}),major:new t({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:5,unit:"centuries"}),major:new t({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:10,unit:"centuries"}),major:new t({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:20,unit:"centuries"}),major:new t({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:50,unit:"centuries"}),major:new t({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:100,unit:"centuries"}),major:new t({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:200,unit:"centuries"}),major:new t({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:500,unit:"centuries"}),major:new t({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new t({value:1e3,unit:"centuries"}),major:new t({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let $=class extends x{constructor(e,t){super(e,t),this._ignoreNextSliderUpdate=!1,this._slider=new f({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1,thumbsConstrained:!1}),this._tickFormat=null,this.actions=null,this.disabled=!1,this.effectiveStops=null,this.fullTimeExtent=null,this.iconClass=S.widgetIcon,this.label=void 0,this.labelFormatFunction=null,this.loop=!1,this.messages=null,this.messagesCommon=null,this.mode="time-window",this.playRate=1e3,this.stops={count:10},this.tickConfigs=null,this.timeExtent=null,this.timeVisible=!1,this.values=null,this.view=null,this.viewModel=new T}initialize(){this.own([this._slider.watch("values",(e=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const t=this.viewModel.valuesToTimeExtent(e);i(this.timeExtent)?i(t)?this.timeExtent.equals(t)||(this.timeExtent=t):this.timeExtent=null:i(t)&&(this.timeExtent=t)})),l(window,"resize",m((()=>this.scheduleRender()),100)),d(this,"effectiveStops",(()=>this._updateSliderSteps()))])}loadDependencies(){return Promise.all([import("../chunks/calcite-action.js"),import("../chunks/calcite-action-menu.js")])}destroy(){this._slider.destroy(),this._tickFormat=null}get interactive(){return!this.disabled&&this.viewModel&&"disabled"!==this.viewModel.state}set layout(e){-1===["auto","compact","wide"].indexOf(e)&&(e="auto"),this._set("layout",e)}static async getPropertiesFromWebMap(e,t){return T.getPropertiesFromWebMap(e,t)}next(){}play(){}previous(){}stop(){return null}render(){const{_slider:e,actions:t,domNode:a,effectiveStops:r,fullTimeExtent:l,interactive:m,messagesCommon:u,mode:c,tickConfigs:d,timeExtent:p,timeVisible:h,viewModel:{state:v,timeExtentValues:y}}=this;if(i(l)){const{start:t,end:s}=l;if(i(t)&&i(s)){const n=t.getTime(),o=s.getTime(),a=e.min!==n||e.max!==o;if(a&&(e.min=n,e.max=o),i(d))e.tickConfigs!==d&&(e.tickConfigs=d);else{var f;const t=(o-n)/((null==(f=e.trackElement)?void 0:f.offsetWidth)||400),i=M.find((e=>e.minor.toMilliseconds()>3*t)),s=this._tickFormat!==i&&null!=i;if(s&&(this._tickFormat=i),a||s){const t={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(e,t)=>{t.classList.add(S.sliderMinorTick)}},s={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(e,t)=>{t.classList.add(S.sliderMajorTick)},labelFormatFunction:e=>w(e,i.format)};e.tickConfigs=[t,s]}}}}const x=s(this.fullTimeExtent)||s(this.timeExtent)||this.timeExtent.isAllTime||this.timeExtent.isEmpty||i(this.timeExtent.start)&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||i(this.timeExtent.end)&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(x)switch(this._ignoreNextSliderUpdate=!0,c){case"time-window":e.values=[e.min,e.max];break;case"instant":case"cumulative-from-end":e.values=[e.min];break;case"cumulative-from-start":e.values=[e.max]}else i(y)?n(e.values,y)||(e.values=y):e.values=null;e.disabled=!m;const k="ready"===v,j="playing"===v,b=x||!m||s(r)||0===r.length,T="auto"===this.layout?a.clientWidth<858?"compact":"wide":this.layout,E=_("div",{class:S.animation},_("button",{"aria-disabled":b?"true":"false","aria-label":j?u.control.stop:u.control.play,bind:this,class:this.classes(S.esriWidgetButton,S.animationButton,b&&S.esriButtonDisabled),disabled:b,title:j?u.control.stop:u.control.play,onclick:this._playOrStopClick,type:"button"},_("div",{class:this.classes((k||b)&&S.animationPlay,j&&S.animationPause)}))),$=i(this.labelFormatFunction)?_("div",{key:"extent",bind:this,class:S.timeExtentDate,"data-type":"extent","data-layout":T,"data-date":o(p,(e=>[e.start,e.end])),afterCreate:this._createLabel,afterUpdate:this._createLabel}):s(p)||i(p)&&p.isAllTime?[_("div",{class:this.classes(S.warning,S.warningIcon)}),_("div",{key:"warning-text",class:S.warningText},this.messages.noTimeExtent)]:p.isEmpty?[_("div",{class:this.classes(S.warning,S.warningIcon)}),_("div",{key:"warning-text",class:S.warningText},this.messages.emptyTimeExtent)]:[i(p.start)&&_("div",{key:"start-date-group",class:S.timeExtentGroup},_("div",{key:"start-date",class:S.timeExtentDate},this._formatDate(p.start)),h&&_("div",{key:"start-time",class:S.timeExtentTime},this._formatTime(p.start))),i(p.start)&&i(p.end)&&p.start.getTime()!==p.end.getTime()&&_("div",{key:"separator",class:S.timeExtentSeparator},"–"),i(p.end)&&(s(p.start)||p.start.getTime()!==p.end.getTime())&&_("div",{key:"end-date-group",class:S.timeExtentGroup},_("div",{key:"end-date",class:S.timeExtentDate},this._formatDate(p.end)),h&&_("div",{key:"end-time",class:S.timeExtentTime},this._formatTime(p.end)))],C=_("div",{class:this.classes(S.timeExtent,!m&&S.esriButtonDisabled)},[$]),D=i(this.labelFormatFunction)?_("div",{key:"min-date",bind:this,class:S.minDate,"data-date":o(l,(e=>e.start)),"data-type":"min","data-layout":T,afterCreate:this._createLabel,afterUpdate:this._createLabel}):i(l)&&i(l.start)&&[_("div",{key:"min-date",class:S.minDate},this._formatDate(l.start)),h&&_("div",{key:"min-time",class:S.minTime},this._formatTime(l.start))],F=_("div",{class:this.classes(S.min,!m&&S.esriButtonDisabled)},[D]),B=_("div",{class:S.slider},e.render()),U=i(this.labelFormatFunction)?_("div",{key:"max-date",bind:this,class:S.maxDate,"data-date":o(l,(e=>e.end)),"data-type":"max","data-layout":T,afterCreate:this._createLabel,afterUpdate:this._createLabel}):i(l)&&i(l.end)&&[_("div",{key:"max-date",class:S.maxDate},this._formatDate(l.end)),h&&_("div",{key:"max-time",class:S.maxTime},this._formatTime(l.end))],L=_("div",{class:this.classes(S.max,!m&&S.esriButtonDisabled)},[U]),W=_("div",{class:S.previous},_("button",{"aria-disabled":b?"true":"false","aria-label":u.pagination.previous,bind:this,class:this.classes(S.esriWidgetButton,S.previousButton,(j||b)&&S.esriButtonDisabled),disabled:b,title:u.pagination.previous,onclick:this._previousClick,type:"button"},_("div",{class:S.previousIcon}))),O=_("div",{class:S.next},_("button",{"aria-disabled":b?"true":"false","aria-label":u.pagination.next,bind:this,class:this.classes(S.esriWidgetButton,S.nextButton,(j||b)&&S.esriButtonDisabled),disabled:b,title:u.pagination.next,onclick:this._nextClick,type:"button"},_("div",{class:S.nextIcon}))),P=(null==t?void 0:t.length)>0,A=P&&_("div",{class:S.actions,title:u.options},_("calcite-action-menu",{label:u.options,class:S.actionsButton},t.toArray().map((e=>_("calcite-action",{bind:this,icon:e.icon,id:e.id,onCalciteActionClick:()=>this.viewModel.triggerAction(e),text:e.title,textEnabled:!0})))));return _("div",{class:this.classes(S.timeSlider,S.esriWidget,`${S.timeSliderMode}${c}`,`${S.timeSliderLayout}${T}`,!m&&S.esriDisabled,x&&S.timeSliderOutOfBounds,P&&S.hasActions,g())},"wide"===T&&_("div",{class:S.timeSliderRow},_("div",{class:S.playbackControls},[E,C,F,B,L,W,O]),A),"compact"===T&&[_("div",{key:"time-slider-row-1",class:S.timeSliderRow},[C,A]),_("div",{key:"time-slider-row-2",class:S.timeSliderRow},[B]),_("div",{key:"time-slider-row-3",class:S.timeSliderRow},[F,W,E,O,L])])}updateWebDocument(e){var t;null==(t=this.viewModel)||t.updateWebDocument(e)}_createLabel(e){if(s(this.labelFormatFunction))return;const t=e.getAttribute("data-type"),i=e.getAttribute("data-layout"),n=e["data-date"];this.labelFormatFunction(n,t,e,i)}_getTickPositions(e){const{fullTimeExtent:t}=this;if(s(t)||s(t.start)||s(t.end))return[];const{start:i,end:n}=t,o=[],{value:a,unit:r}=e;let l=u(i,r);for(;l.getTime()<=n.getTime();)l.getTime()>=i.getTime()&&o.push(l.getTime()),l=c(l,a,r);return o}_formatDate(e){return e?w(e,y("short-date")):null}_formatTime(e){return e?w(e,y("long-time")):null}_updateSliderSteps(){this._slider.steps=i(this.effectiveStops)&&this.effectiveStops.length>0?this.effectiveStops.map((e=>e.getTime())):null}_playOrStopClick(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:r(this.viewModel.state)}}_previousClick(){this.viewModel.previous()}_nextClick(){this.viewModel.next()}};e([p("viewModel.actions")],$.prototype,"actions",void 0),e([h()],$.prototype,"disabled",void 0),e([p("viewModel.effectiveStops")],$.prototype,"effectiveStops",void 0),e([p("viewModel.fullTimeExtent")],$.prototype,"fullTimeExtent",void 0),e([h()],$.prototype,"iconClass",void 0),e([h({readOnly:!0})],$.prototype,"interactive",null),e([h({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],$.prototype,"label",void 0),e([h()],$.prototype,"labelFormatFunction",void 0),e([h({value:"auto"})],$.prototype,"layout",null),e([p("viewModel.loop")],$.prototype,"loop",void 0),e([h(),j("esri/widgets/TimeSlider/t9n/TimeSlider")],$.prototype,"messages",void 0),e([h(),j("esri/t9n/common")],$.prototype,"messagesCommon",void 0),e([p("viewModel.mode")],$.prototype,"mode",void 0),e([p("viewModel.playRate")],$.prototype,"playRate",void 0),e([p("viewModel.stops")],$.prototype,"stops",void 0),e([h()],$.prototype,"tickConfigs",void 0),e([p("viewModel.timeExtent")],$.prototype,"timeExtent",void 0),e([h({nonNullable:!0})],$.prototype,"timeVisible",void 0),e([p("viewModel.values")],$.prototype,"values",void 0),e([p("viewModel.view")],$.prototype,"view",void 0),e([h({type:T}),b("trigger-action")],$.prototype,"viewModel",void 0),e([p("viewModel.next")],$.prototype,"next",null),e([p("viewModel.play")],$.prototype,"play",null),e([p("viewModel.previous")],$.prototype,"previous",null),e([p("viewModel.stop")],$.prototype,"stop",null),e([k()],$.prototype,"_playOrStopClick",null),e([k()],$.prototype,"_previousClick",null),e([k()],$.prototype,"_nextClick",null),$=e([v("esri.widgets.TimeSlider")],$);const C=$;export{C as default};
