/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import"../../intl.js";import{e}from"../../core/promiseUtils.js";import{aliasOf as s}from"../../core/accessorSupport/decorators/aliasOf.js";import"../../core/lang.js";import"../../chunks/ensureType.js";import{property as i}from"../../core/accessorSupport/decorators/property.js";import{subclass as r}from"../../core/accessorSupport/decorators/subclass.js";import{l as o}from"../../chunks/moment.js";import n from"../Widget.js";import a from"./TimePickerViewModel.js";import"../../chunks/widgetUtils.js";import{m as c}from"../../chunks/messageBundle.js";import"../../chunks/Logger.js";import{t as u}from"../../chunks/jsxFactory.js";import{a as h}from"../../chunks/number.js";import"../../chunks/object.js";import"../../chunks/string.js";import"../../chunks/locale.js";import"../../chunks/messages.js";import"../../core/Error.js";import"../../config.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/assets.js";import"../../chunks/jsonMap.js";import"../../chunks/metadata.js";import"../../chunks/handleUtils.js";import"../../chunks/deprecate.js";import"../../chunks/domUtils.js";import"../../chunks/Evented.js";import"../../core/Accessor.js";import"../../chunks/ArrayPool.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../core/Handles.js";import"../../core/Collection.js";import"../../chunks/shared.js";import"../../chunks/Promise.js";import"../../chunks/uuid.js";import"../../core/watchUtils.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/projector.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/MomentElementViewModel.js";const m="esri-time-picker esri-widget",p="esri-time-picker__input",l="esri-input",d={hour:"numeric",minute:"numeric"},_=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","Tab"];function v(t){return h(t.valueOf(),d).indexOf(" ")>-1}let f=class extends n{constructor(t,e){super(t,e),this._activeTime=null,this.label=void 0,this.messages=null,this.value=null,this.viewModel=new a}async loadLocale(){this._moment=await o()}render(){const t=this._activeTime||this.viewModel.value;return u("div",{class:m},u("input",{afterUpdate:this._handleInputUpdate,"aria-label":this.messages.inputTitle,bind:this,class:this.classes(p,l),onblur:this._handleInputBlur,onfocus:this._handleInputFocus,onkeydown:this._handleInputKeydown,oninput:this._handleInputKeydown,onclick:this._handleInputClick,onpaste:this._handleInputPaste,onwheel:this._handleInputWheel,value:h(t.valueOf(),d)}))}_handleInputBlur(){this._activeTime.isValid()&&(this.viewModel.value=this._activeTime.toDate()),this._activeTime=null,this._activePart=null}_handleInputUpdate(t){this._selectPart(t,this._activePart)}_selectPart(t,e){const s=this._activeTime;if(!s)return;const i=h(s.valueOf(),d),r=i.indexOf(":");if("hours"===e)return void t.setSelectionRange(0,r);const o=r+1,n=o+2;if("minutes"===e)return void t.setSelectionRange(o,n);const a=n+1,c=i.length;"meridiem"!==e||t.setSelectionRange(a,c)}_handleInputFocus(t){this._activePart="hours",this._activeTime=this._moment(this.viewModel.value).startOf("minute"),this._selectPart(t.target,"hours")}_caretIndexToPartName(t){const e=this._activeTime.format("LT"),s=e.indexOf(":"),i=e.indexOf(" ");return t<=s?"hours":t>s&&t<=i?"minutes":"meridiem"}_handleInputKeydown(t){const{ctrlKey:s,metaKey:i,shiftKey:r}=t,o=e(t),n=this._activeTime,a=this._activePart,c=/\d/.test(o),u=/^a|p$/i.test(o),h=i||s;if(_.indexOf(o)>-1||c||"meridiem"===a&&u&&!h){if("ArrowLeft"===o)this._activePart=this._prevPart();else if("ArrowRight"===o)this._activePart=this._nextPart();else if("Tab"===o){const t=r?this._prevPart():this._nextPart();if(t===this._activePart)return;this._activePart=t}else if("ArrowUp"===o)this._shift("up",n,a);else if("ArrowDown"===o)this._shift("down",n,a);else if(c)this._setTime(n,a,Number(o));else if(u){const t=o.toLowerCase(),e=n.hour();("a"===t&&e>=12||"p"===t&&e<12)&&this._shift("up",n,a)}t.preventDefault(),t.stopImmediatePropagation()}else h||(t.preventDefault(),t.stopImmediatePropagation())}_handleInputClick(t){const e=t.target;this._activePart=null,this.renderNow(),this._activePart=this._caretIndexToPartName(e.selectionStart)}_getOrderedParts(){return v(this._activeTime)?["hours","minutes","meridiem"]:["hours","minutes"]}_prevPart(){const t=this._getOrderedParts(),e=t.indexOf(this._activePart)-1;return t[Math.max(e,0)]}_nextPart(){const t=this._getOrderedParts(),e=t.indexOf(this._activePart)+1;return t[Math.min(e,t.length-1)]}_setTime(t,e,s){if("hours"===e){const e=v(t)?12:24,i=""+t.hour()%e,r=s,o=Number(`${i}${s}`);2===i.length||o>e?t.hour(r):o<=e&&t.hour(o)}else if("minutes"===e){const e=59,i=`${t.minute()}`,r=s,o=Number(`${i}${s}`);2===i.length||o>e?t.minute(r):o<e&&t.minute(o)}}_handleInputPaste(t){const e=t.clipboardData.getData("text/plain"),s=this._moment(e);s.isValid()&&(this._activeTime=s),t.preventDefault(),t.stopImmediatePropagation()}_handleInputWheel(t){const e=t.deltaY<0?"up":"down";this._shift(e,this._activeTime,this._activePart)}_shift(t,e,s){if(!t||!e||!s)return;const i="meridiem"===s?12:1,r="hours"===s?"hour":"minutes"===s?"minute":"hours";e["up"===t?"add":"subtract"](i,r)}};t([i({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],f.prototype,"label",void 0),t([i(),c("esri/widgets/support/t9n/TimePicker")],f.prototype,"messages",void 0),t([s("viewModel.value")],f.prototype,"value",void 0),t([i({type:a})],f.prototype,"viewModel",void 0),f=t([r("esri.widgets.support.TimePicker")],f);const j=f;export{j as default};
