/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as t}from"../intl.js";import{i as s}from"../core/lang.js";import{aliasOf as i}from"../core/accessorSupport/decorators/aliasOf.js";import"../chunks/ensureType.js";import{property as r}from"../core/accessorSupport/decorators/property.js";import{subclass as n}from"../core/accessorSupport/decorators/subclass.js";import{R as o}from"../chunks/ResizeObserver.js";import a from"./Widget.js";import l from"./Histogram/HistogramViewModel.js";import"../chunks/widgetUtils.js";import{m as d}from"../chunks/messageBundle.js";import"../chunks/Logger.js";import{t as h}from"../chunks/jsxFactory.js";import"../chunks/number.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../chunks/locale.js";import"../chunks/string.js";import"../chunks/messages.js";import"../core/Error.js";import"../config.js";import"../core/promiseUtils.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../chunks/metadata.js";import"../chunks/handleUtils.js";import"../chunks/_commonjsHelpers.js";import"../chunks/deprecate.js";import"../chunks/domUtils.js";import"../chunks/Evented.js";import"../core/Accessor.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../core/Handles.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/Promise.js";import"../chunks/uuid.js";import"../core/watchUtils.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";var c;const u="esri-histogram",p="esri-histogram--horizontal",m="esri-histogram--vertical",g="esri-histogram__content",_="esri-histogram__svg",b="esri-histogram__bar",f="esri-histogram__bars",v="esri-histogram__label",j="esri-histogram__data-lines",y="esri-histogram__data-lines-subgroup",L="esri-histogram__data-line",C="esri-histogram__average-label",x="esri-histogram__average-data-line",k="esri-histogram__average-symbol",w="esri-widget",F="esri-disabled";let N=c=class extends a{constructor(e,t){super(e,t),this._bgFillId=null,this._containerNode=null,this._containerOffsetHeight=0,this._containerOffsetWidth=0,this._defaultBarColor="#d8d8d8",this._observer=null,this.average=null,this.barCreatedFunction=null,this.bins=null,this.dataLines=null,this.dataLineCreatedFunction=null,this.dataLineUpdatedFunction=null,this.label=void 0,this.labelFormatFunction=null,this.max=null,this.messages=null,this.min=null,this.state=null,this.viewModel=new l,this._observer=new o((()=>{this._storeContainerDimensions(),this.scheduleRender()})),this._bgFillId=`${this.id}-bg-fill`}destroy(){this._containerNode&&this._observer.unobserve(this._containerNode)}set layout(e){"vertical"!==e&&(e="horizontal"),this._set("layout",e)}static fromHistogramResult(e){const{bins:t,maxValue:s,minValue:i}=e;return new c({bins:t,max:s,min:i})}render(){const{label:e,layout:t,state:s}=this,i=this.classes(u,w,"horizontal"===t?p:m,"disabled"===s?F:null);return h("div",{"aria-label":e,afterCreate:this._afterContainerNodeCreate,bind:this,class:i,"data-node-ref":"_containerNode"},"ready"===s?this.renderContent():null)}renderContent(){if(!this._containerNode)return;const e=this._bgFillId,t=`clip-path: url(#${e})`;return h("div",{class:g},h("svg",{class:_,xmlns:"http://www.w3.org/2000/svg"},h("defs",null,this.renderFillDefinition(e)),h("g",{style:t},this.renderBarsGroup()),this.renderLinesGroup()))}renderBarsGroup(){return h("g",{class:this.classes(f)},this.renderBars())}renderBars(){const{layout:e,viewModel:{binRange:t,range:s}}=this;if(!t||!s)return;const i=t/s,[r,n]=this._getContainerDimensions();if(0===r&&0===n)return;if(0===r&&0!==n)return void this.scheduleRender();const[o,a]="vertical"===e?[r*i,n]:[r,n*i];return this._getBarDimensions(o,a).map((([e,t],s)=>this.renderBar(s,e,t)))}renderBar(e,s,i){const{bins:r,layout:n,max:o,messages:a,viewModel:{range:l}}=this,[d,c]=this._getContainerDimensions(),u=r.slice()[e],{count:p,maxValue:m,minValue:g}=u,_=o-m,[f,v]="vertical"===n?[0,_*(d/l)]:[c-i-_*(c/l),d-s],j=t(a.barLabel,{count:p,maxValue:m,minValue:g});return h("rect",{"aria-label":j,afterCreate:this._afterBarCreate,bind:this,class:b,"data-index":e,fill:this._defaultBarColor,height:s,role:"img","shape-rendering":"crispEdges","stroke-width":"0",width:i,x:f,y:v})}renderLinesGroup(){return h("g",{class:this.classes(j)},this.renderAverageLine(),this.renderCustomLines())}renderAverageLine(){const{average:e}=this;if(!s(e))return;const t=[h("tspan",{class:this.classes(k)},"xÌ„ "),h("tspan",{class:this.classes(C)},this.labelFormatFunction?this.labelFormatFunction(e,"average"):e)];return h("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(y)},h("title",{key:"title"},e),this.renderLine(e,this.classes(x)),this.renderLabel(e,t))}renderCustomLines(){if(this.dataLines&&this.dataLines.length)return this.dataLines.map((({value:e,label:t},s)=>this.renderLineSubgroup(s,e,t)))}renderLineSubgroup(e,t,s){return h("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(y),"data-index":e},h("title",{key:"title"},t),this.renderLine(t),this.renderLabel(t,s))}renderLine(e,t){const[s,i,r,n]=this._getLinePosition(e);return h("line",{class:this.classes(L,t),x1:s,x2:i,y1:r,y2:n,"shape-rendering":"crispEdges"})}renderLabel(e,t,s){const[i,r]=this._getLabelPosition(e);return h("text",{class:this.classes(v,s),"text-anchor":"end",transform:"horizontal"===this.layout?"rotate(270)":null,x:i,y:r-2},t)}renderFillDefinition(e){const[t,s]=this._getContainerDimensions();return h("clipPath",{id:e},h("rect",{x:"0",y:"0",width:s,height:t}))}_afterContainerNodeCreate(e){this._containerNode&&this._observer.unobserve(this._containerNode),this._containerNode=e,this._observer.observe(this._containerNode),this._storeContainerDimensions()}_afterBarCreate(e){if(this.barCreatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null;this.barCreatedFunction(isNaN(t)?null:t,e)}}_afterLinesSubgroupCreate(e){if(this.dataLineCreatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null,s=e.childNodes[0],i=e.childNodes[1]?e.childNodes[1]:null;this.dataLineCreatedFunction(s,i,isNaN(t)?null:t)}}_afterLinesSubgroupUpdate(e){if(this.dataLineUpdatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null,s=e.childNodes[0],i=e.childNodes[1]?e.childNodes[1]:null;this.dataLineUpdatedFunction(s,i,isNaN(t)?null:t)}}_storeContainerDimensions(){const{_containerNode:e}=this;e&&(this._containerOffsetHeight=e.offsetHeight,this._containerOffsetWidth=e.offsetWidth)}_getContainerDimensions(){return[this._containerOffsetHeight,this._containerOffsetWidth]}_getBarDimensions(e,t){const{bins:s,layout:i}=this,r=s?s.map((e=>e.count)):[],n=Math.max.apply(Math,r);return r.map((s=>"vertical"===i?[e/r.length,0!==n?s/n*t:0]:[0!==n?s/n*e:0,t/r.length]))}_getLinePosition(e){const{layout:t,min:s,viewModel:{range:i}}=this,r=Math.round((e-s)/i*100)/100,[n,o]=this._getContainerDimensions(),[a,l]=[r*o||1,n-r*n||1];return"vertical"===t?[0,"100%",l,l]:[a,a,"100%",0]}_getLabelPosition(e){const{layout:t,min:s,viewModel:{range:i}}=this,r=Math.round((e-s)/i*100)/100,[n,o]=this._getContainerDimensions();return"vertical"===t?[o,n-r*n]:[0,r*o]}};e([r()],N.prototype,"_containerOffsetHeight",void 0),e([r()],N.prototype,"_containerOffsetWidth",void 0),e([i("viewModel.average")],N.prototype,"average",void 0),e([r()],N.prototype,"barCreatedFunction",void 0),e([i("viewModel.bins")],N.prototype,"bins",void 0),e([r()],N.prototype,"dataLines",void 0),e([r()],N.prototype,"dataLineCreatedFunction",void 0),e([r()],N.prototype,"dataLineUpdatedFunction",void 0),e([r({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],N.prototype,"label",void 0),e([i("viewModel.labelFormatFunction")],N.prototype,"labelFormatFunction",void 0),e([r({value:"horizontal"})],N.prototype,"layout",null),e([i("viewModel.max")],N.prototype,"max",void 0),e([r(),d("esri/widgets/Histogram/t9n/Histogram")],N.prototype,"messages",void 0),e([i("viewModel.min")],N.prototype,"min",void 0),e([i("viewModel.state")],N.prototype,"state",void 0),e([r()],N.prototype,"viewModel",void 0),N=c=e([n("esri.widgets.Histogram")],N);const M=N;export{M as default};
