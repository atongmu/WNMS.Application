/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import e from"../core/Collection.js";import{o as s,e as i}from"../core/promiseUtils.js";import{clone as o}from"../core/lang.js";import{L as a}from"../chunks/Logger.js";import{addProxy as l,hasSameOrigin as r}from"../core/urlUtils.js";import{init as n}from"../core/watchUtils.js";import{aliasOf as p}from"../core/accessorSupport/decorators/aliasOf.js";import"../chunks/ensureType.js";import{property as c}from"../core/accessorSupport/decorators/property.js";import{subclass as d}from"../core/accessorSupport/decorators/subclass.js";import m from"./Widget.js";import u from"../core/Accessor.js";import h from"../core/Handles.js";import b from"./Print/PrintViewModel.js";import y from"./Print/TemplateOptions.js";import{H as _}from"../chunks/Heading.js";import{P as j}from"../chunks/Popover.js";import{h as g,k as v}from"../chunks/widgetUtils.js";import{m as f}from"../chunks/messageBundle.js";import{t as T}from"../chunks/jsxFactory.js";import"../chunks/ArrayPool.js";import"../chunks/Evented.js";import"../chunks/handleUtils.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../core/Error.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";import"../chunks/shared.js";import"../chunks/metadata.js";import"../chunks/deprecate.js";import"../intl.js";import"../chunks/number.js";import"../chunks/jsonMap.js";import"../chunks/locale.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../chunks/assets.js";import"../chunks/domUtils.js";import"../chunks/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/Loadable.js";import"../portal/Portal.js";import"../chunks/JSONSupport.js";import"../chunks/reader.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../chunks/submitJob.js";import"../rest/geoprocessor/GPOptions.js";import"../rest/support/JobInfo.js";import"../chunks/utils3.js";import"../chunks/scaleUtils.js";import"../chunks/unitUtils.js";import"../chunks/projectionEllipsoid.js";import"../chunks/floorFilterUtils.js";import"../geometry/support/normalizeUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../chunks/zmUtils.js";import"../geometry/Polyline.js";import"../chunks/normalizeUtilsCommon.js";import"../geometry/support/jsonUtils.js";import"../geometry/Multipoint.js";import"../geometry.js";import"../chunks/typeUtils.js";import"../layers/support/Field.js";import"../chunks/enumeration.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../layers/support/MapImage.js";import"../rest/support/DataFile.js";import"../rest/support/FeatureSet.js";import"../Graphic.js";import"../PopupTemplate.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../chunks/chartMediaInfoUtils.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../support/actions/ActionBase.js";import"../chunks/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../chunks/common.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils2.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/aaBoundingRect.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../chunks/Thumbnail.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../rest/support/LinearUnit.js";import"../rest/support/ParameterValue.js";import"../rest/support/RasterData.js";import"../rest/support/GPMessage.js";import"../rest/print.js";import"../chunks/visualVariableUtils.js";import"../chunks/compilerUtils.js";import"../chunks/lengthUtils.js";import"../chunks/sizeVariableUtils.js";import"../chunks/layoutTemplate.js";import"../rest/support/PrintTemplate.js";import"../rest/support/PrintParameters.js";import"./Print/CustomTemplate.js";let k=class extends u{constructor(t){super(t),this._handles=new h,this.state="pending",this.url=""}initialize(){this._handles.add([n(this,["extension","name"],(()=>this._setFormattedFileName()))])}destroy(){this._handles.destroy()}_setFormattedFileName(){if(!this.name||!this.extension)return;let t=this.name+"."+this.extension;this.count&&(t=this.name+"("+this.count+")."+this.extension),this.formattedName=t}};t([c()],k.prototype,"count",void 0),t([c()],k.prototype,"error",void 0),t([c()],k.prototype,"extension",void 0),t([c()],k.prototype,"formattedName",void 0),t([c()],k.prototype,"name",void 0),t([c()],k.prototype,"state",void 0),t([c()],k.prototype,"url",void 0),k=t([d("esri.widgets.print.FileLink")],k);const w=k,x=e.ofType(w),O="esri-print",S="esri-print__header-title",L="esri-print__input-text",C="esri-print__layout-tab-list",I="esri-print__layout-tab",M="esri-print__layout-section",P="esri-print__map-only-section",D="esri-print__scale-input",F="esri-print__template-list",E="esri-print__template-list-scroller",U="esri-print__template-list-footer",V="esri-print__loader",N="esri-print__advanced-options-button",A="esri-print__advanced-options-button-container",$="esri-print__advanced-options-button-title",R="esri-print__advanced-options-button-icon--opened",B="esri-print__advanced-options-button-icon--closed",z="esri-print__advanced-options-button-icon--closed-rtl",H="esri-print__refresh-button",q="esri-print__swap-button",W="esri-print__export-button",G="esri-print__template-button",K="esri-print__form-section-container",J="esri-print__advanced-options-section",Q="esri-print__advanced-options-container",Y="esri-print__author-info-container",X="esri-print__copyright-info-container",Z="esri-print__export-panel-container",tt="esri-print__export-title",et="esri-print__exported-file",st="esri-widget__anchor esri-print__exported-file-link",it="esri-print__exported-file-link-title",ot="esri-print__height-container",at="esri-print__legend-info-container",lt="esri-print__container",rt="esri-print__panel-container",nt="esri-print__scale-info-container",pt="esri-print__scale-input-container",ct="esri-print__size-container",dt="esri-print__width-container",mt="esri-widget",ut="esri-widget--panel",ht="esri-widget--button",bt="esri-button",yt="esri-button--secondary",_t="esri-button--tertiary",jt="esri-select",gt="esri-input",vt="esri-widget__anchor--disabled",ft="esri-button--disabled",Tt="esri-print__panel--error",kt="esri-print__exported-file--error",wt="esri-rotating",xt="esri-menu__list",Ot="esri-menu__list-item",St="esri-menu__list-item--focus",Lt="esri-menu__header",Ct="esri-icon-download",It="esri-icon-launch-link-external",Mt="esri-icon-error",Pt="esri-icon-right-triangle-arrow",Dt="esri-icon-left-triangle-arrow",Ft="esri-icon-down-arrow",Et="esri-icon-refresh",Ut="esri-icon-loading-indicator",Vt="esri-icon-swap",Nt="esri-icon-printer",At=a.getLogger("esri.widgets.Print");function $t(t){return"MAP_ONLY"===(null==t?void 0:t.toUpperCase())}let Rt=class extends m{constructor(t,e){super(t,e),this._activeTabFocusRequested=!1,this._advancedOptionsVisibleForLayout=!1,this._advancedOptionsVisibleForMapOnly=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._focusedTemplateIndex=0,this._layoutTabSelected=!0,this._pendingExportScroll=!1,this._rootNode=null,this._selectTemplateNode=null,this._templateListPopover=new j({owner:this,placement:"top",offset:[0,-100],anchorElement:()=>this._selectTemplateNode,renderContentFunction:this.renderTemplateList}),this.allowedFormats=null,this.allowedLayouts=null,this.exportedLinks=new x,this.extraParameters=null,this.headingLevel=3,this.iconClass=Nt,this.includeDefaultTemplates=null,this.label=void 0,this.portal=null,this.printServiceUrl=null,this.templateCustomTextElements=null,this.templateOptions=new y,this.view=null,this.viewModel=new b,this.handleTemplateListCreation=t=>t.focus(),this.handleTemplateChildBlur=t=>{var e;(null==(e=t.relatedTarget)?void 0:e.closest(`.${F}`))||this.handleCloseTemplateSelection()},this.handleCloseTemplateSelection=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!1,this._selectTemplateNode.focus()},this.handleSelectTemplateClick=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!0},this.handleTemplateListClick=t=>{const e=t.target;this.applyTemplate(e["data-template"])},this.handleTemplateListKeyDown=t=>{if(g(t.key))return this.applyTemplate(this.viewModel.defaultTemplates.getItemAt(this._focusedTemplateIndex)),void t.preventDefault();if("ArrowDown"===t.key||"ArrowUp"===t.key){const{defaultTemplates:e}=this.viewModel,s="ArrowDown"===t.key?1:-1,i=(this._focusedTemplateIndex+s)%e.length;this._focusedTemplateIndex=i<0?e.length-1:i;const o=t.currentTarget;v(o.querySelectorAll(`.${Ot}`)[this._focusedTemplateIndex],o.parentElement),t.preventDefault()}"Escape"===t.key&&this.handleCloseTemplateSelection()},this._removeLink=t=>{const e=t.currentTarget["data-item"];e&&"error"===e.state&&this.exportedLinks.remove(e)},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.own([n(this,"viewModel.templatesInfo",(t=>{const{format:e,layout:s}=this.templateOptions;if(t){const i=s===t.layout.defaultValue||$t(s)||t.layout.choiceList&&t.layout.choiceList.indexOf(s)>-1,o=e===t.format.defaultValue||t.format.choiceList&&t.format.choiceList.indexOf(e)>-1;i||(s&&At.warn("User sets an invalid layout, resetting it to the default valid one..."),this.templateOptions.layout=t.layout.defaultValue),o||(e&&At.warn("User sets an invalid format, resetting it to the default valid one..."),this.templateOptions.format=t.format.defaultValue),$t(s)&&(this._layoutTabSelected=!1)}})),n(this,"templateOptions.format",(t=>{const{viewModel:{templatesInfo:e}}=this;if(e&&t){let s=!1;e.format.choiceList&&e.format.choiceList.forEach((e=>{e.toUpperCase()===t.toUpperCase()&&(this.templateOptions.format=e,s=!0)})),s||(this.templateOptions.format=e.format.defaultValue,At.warn("User sets an invalid format, resetting it to the default valid one...")),this.scheduleRender()}})),n(this,"templateOptions.layout",(t=>{const{viewModel:{templatesInfo:e}}=this;if(e&&t){this._layoutTabSelected=!$t(t);let s=!this._layoutTabSelected;s||e.layout.choiceList&&e.layout.choiceList.forEach((e=>{e.toUpperCase()===t.toUpperCase()&&(this.templateOptions.layout=e,s=!0)})),s||(this.templateOptions.layout=e.layout.defaultValue,At.warn("User sets an invalid layout, resetting it to the default valid one..."));const i=this.viewModel.effectiveTemplateCustomTextElements[this.templateOptions.layout];this.templateOptions.customTextElements=i?o(i):null,this.scheduleRender()}})),n(this,"templateOptions.dpi",(t=>{t<=0?this.templateOptions.dpi=1:this.scheduleRender()})),n(this,"viewModel.view.scale",(t=>{const{scale:e,scaleEnabled:s}=this.templateOptions;s&&e||(this.templateOptions.scale=t)}))]);const{height:t,width:e}=this.templateOptions;this.templateOptions.width=e||800,this.templateOptions.height=t||1100;const s=setTimeout((()=>{this._awaitingServerResponse=!0,this.scheduleRender()}),500);this.viewModel.load().then((()=>clearTimeout(s)))}render(){const{attributionEnabled:t,author:e,copyright:s,dpi:i,format:o,height:a,layout:l,legendEnabled:r,scaleEnabled:n,scale:p,width:c}=this.templateOptions,d="ready"!==this.get("viewModel.state"),m=this.renderTitleOrFileNameSection(),{includeDefaultTemplates:u,messages:h,viewModel:b}=this,y=this.get("viewModel.templatesInfo.format.choiceList")||[],j=y.length>0?y.map((t=>T("option",{key:t,selected:t===o,value:t},t.toUpperCase()))):T("option",{key:"format-default-option"},h.formatDefaultOption),g=T("div",{class:K},T("label",null,h.fileFormatTitle,T("select",{class:jt,onchange:this._updateFromOption,"data-target-property":"format",bind:this},j))),v=this.get("viewModel.templatesInfo.layout.choiceList")||[],f=v.length>0?v.map((t=>{const e=t===l,s=h[t]||t;return T("option",{key:t,selected:e,value:t},s)})):T("option",{key:"layout-default-option"},h.layoutDefaultOption),k=T("div",{class:K},T("label",null,h.layoutTitle,T("select",{class:jt,onchange:this._updateFromOption,"data-target-property":"layout",bind:this},f))),w=T("div",{class:K},T("label",null,h.dpi,T("input",{type:"number",class:this.classes(L,gt),"data-input-name":"dpi",onchange:this._handleDPIChange,value:`${i}`,min:"1",tabIndex:0,bind:this}))),x=T("div",{class:this.classes(nt,K)},T("label",null,T("input",{"data-option-name":"scaleEnabled",checked:n,type:"checkbox",tabIndex:0,onchange:this._toggleInputValue,bind:this}),h.scale),T("div",{class:pt},T("input",{"aria-label":h.scaleLabel,"aria-valuenow":`${p}`,role:"spinbutton",type:"number",class:this.classes(L,gt,D),tabIndex:0,"data-input-name":"scale",onchange:this._updateInputValue,disabled:!n,value:`${p}`,bind:this}),T("button",{type:"button","aria-label":h.reset,class:this.classes(ht,H,Et),tabIndex:0,onclick:this._resetToCurrentScale,bind:this}))),F=this._advancedOptionsVisibleForLayout?T("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:Q},x,T("div",{class:this.classes(Y,K)},T("label",null,h.author,T("input",{type:"text",value:e,class:this.classes(L,gt),tabIndex:0,"data-input-name":"author",onchange:this._updateInputValue,bind:this}))),T("div",{class:this.classes(X,K)},T("label",null,h.copyright,T("input",{type:"text",class:this.classes(L,gt),tabIndex:0,value:s,"data-input-name":"copyright",onchange:this._updateInputValue,bind:this}))),w,T("div",{class:this.classes(at,K)},T("label",null,T("input",{type:"checkbox","data-option-name":"legendEnabled",tabIndex:0,checked:r,onchange:this._toggleInputValue,bind:this}),h.legend)),this.renderCustomTextElementSection()):null,E=this._advancedOptionsVisibleForMapOnly?T("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:Q},x,w,T("div",{class:K},T("label",null,T("input",{"data-option-name":"attributionEnabled",type:"checkbox",onchange:this._toggleInputValue,tabIndex:0,checked:t,bind:this}),h.attribution)),this.renderCustomTextElementSection()):null,U=this._layoutTabSelected?T("section",{key:"esri-print__layoutContent",id:`${this.id}__layoutContent`,"aria-labelledby":`${this.id}__layoutTab`,class:M,role:"tabpanel","aria-selected":this._layoutTabSelected.toString()},T("div",{class:rt},m,k,this._layoutTabSelected?g:null),T("div",{class:this.classes(rt,J)},T("button",{"aria-label":h.advancedOptions,"aria-expanded":this._advancedOptionsVisibleForLayout?"true":"false",class:N,onclick:this._showAdvancedOptions,bind:this,type:"button"},T("div",{class:A},T("span",{"aria-hidden":"true",class:this.classes(Pt,B)}),T("span",{"aria-hidden":"true",class:this.classes(Dt,z)}),T("span",{"aria-hidden":"true",class:this.classes(Ft,R)}),T("span",{class:$},h.advancedOptions))),F)):T("section",{key:"esri-print__mapOnlyContent",id:`${this.id}__mapOnlyContent`,"aria-selected":(!this._layoutTabSelected).toString(),"aria-labelledby":`${this.id}__mapOnlyTab`,class:P,role:"tabpanel"},T("div",{class:rt},m,this._layoutTabSelected?null:g,T("div",{class:this.classes(ct,K)},T("div",{class:dt},T("label",null,h.width,T("input",{type:"number",class:this.classes(L,gt),"data-input-name":"width",onchange:this._updateInputValue,value:`${c}`,tabIndex:0,bind:this}))),T("div",{class:ot},T("label",null,h.height,T("input",{type:"number",class:this.classes(L,gt),"data-input-name":"height",onchange:this._updateInputValue,value:`${a}`,tabIndex:0,bind:this}))),T("button",{type:"button","aria-label":h.swap,class:this.classes(ht,q,Vt),onclick:this._switchInput,tabIndex:0,bind:this})),T("div",{class:this.classes(rt,J)},T("button",{"aria-label":h.advancedOptions,"aria-expanded":this._advancedOptionsVisibleForMapOnly?"true":"false",type:"button",class:N,onclick:this._showAdvancedOptions,bind:this},T("div",{class:A},T("span",{"aria-hidden":"true",class:this.classes(Pt,B)}),T("span",{"aria-hidden":"true",class:this.classes(Dt,z)}),T("span",{"aria-hidden":"true",class:this.classes(Ft,R)}),T("span",{class:$},h.advancedOptions))),E))),V=this.exportedLinks.toArray(),G=this._renderExportedLink(V),et={[ft]:d||!l&&!o},st=null!=this.get("view")&&"2d"!==this.get("view.type"),it=T("div",{class:Tt},st?h.sceneViewError:h.serviceError),yt=T("div",null,T("ul",{class:C,role:"tablist",onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,bind:this},T("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,id:`${this.id}__layoutTab`,"data-tab-id":"layoutTab",class:I,role:"tab",tabIndex:0,"aria-selected":`${this._layoutTabSelected}`},h.layoutTab),T("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,id:`${this.id}__mapOnlyTab`,"data-tab-id":"mapOnlyTab",class:I,role:"tab",tabIndex:0,"aria-selected":`${!this._layoutTabSelected}`},h.mapOnlyTab)),U,T("button",{"aria-label":h.exportDescription,type:"button",class:this.classes(W,bt,et),disabled:d,tabIndex:0,onclick:this._handlePrintMap,bind:this},h.export),u&&b.defaultTemplates.length>0?this.renderTemplateSectionTrigger():null,T("div",{class:Z,afterUpdate:this._scrollExportIntoView,bind:this},T(_,{class:tt,level:this.headingLevel},h.exportText),V.length>0?null:T("div",null,T("div",null,h.exportHint)),G)),_t=T("div",{class:lt},T("header",{class:S},h.export),this.error||st||!this.view?it:yt),vt="initializing"===this.get("viewModel.state")?this._renderLoader():_t;return T("div",{afterCreate:this._handleRootAfterCreate,bind:this,class:this.classes(O,mt,ut)},vt)}renderTemplateSectionTrigger(){const{messages:t,_templateListPopover:e}=this,s=e.open;return T("button",{afterCreate:t=>this._selectTemplateNode=t,"aria-controls":s?`${this.id}__template-selection`:"","aria-label":t.selectTemplateDescription,"aria-pressed":s.toString(),class:this.classes(bt,_t,G),onclick:this.handleSelectTemplateClick,title:t.selectTemplateDescription},t.selectTemplate)}renderCustomTextElementSection(){const{templateOptions:{customTextElements:t}}=this;return t?T("div",{class:K,key:"custom-text-elements"},t.map((t=>{const[e,s]=Object.entries(t)[0];return"date"===e?null:T("label",{key:e},e,T("input",{bind:this,class:this.classes(L,gt),"data-input-custom":!0,"data-input-name":e,onchange:this._updateInputValue,type:"text",value:s}))}))):null}renderTemplateList(){const{messages:t,messagesCommon:e,viewModel:s}=this,{defaultTemplates:i}=s,o=t.selectTemplateDescription,a=`${this.id}__template-selection`;return T("div",{class:this.classes(F,mt,ut),id:a},T(_,{class:Lt,level:this.headingLevel},t.selectTemplate),T("div",{class:E},T("ul",{afterCreate:this.handleTemplateListCreation,"aria-activedescendant":`${this.id}__template-item--${this._focusedTemplateIndex}`,"aria-label":o,class:xt,key:"templates",onblur:this.handleTemplateChildBlur,onclick:this.handleTemplateListClick,onkeydown:this.handleTemplateListKeyDown,role:"listbox",tabIndex:0,title:o},i.toArray().map(((e,s)=>{const{description:i}=e,o=s===this._focusedTemplateIndex,a=e.label;return T("li",{"aria-label":i,class:this.classes(Ot,{[St]:o}),"data-template":e,id:`${this.id}__template-item--${s}`,key:a,title:i},$t(a)?t.mapOnlyTab:a)})))),T("div",{class:U},T("button",{type:"button",class:this.classes(bt,yt),onblur:this.handleTemplateChildBlur,onclick:this.handleCloseTemplateSelection},e.done)))}applyTemplate(t){var e;const{format:s,layout:i,layoutOptions:o}=t,{templateOptions:a}=this;this._templateListPopover.open=!1,this._toggleTab("map-only"===i?"mapOnlyTab":"layoutTab",!1),s&&(a.format=s),i&&(a.layout=i),this._focusedTemplateIndex=null,a.legendEnabled=null!=(e=null==o?void 0:o.legend)?e:a.legendEnabled,this.handleCloseTemplateSelection()}renderTitleOrFileNameSection(){const{templateOptions:t,messages:e}=this;let s,i,o,a;return this._layoutTabSelected?(s=e.title,i=e.titlePlaceHolder,o=t.title,a="title"):(s=e.fileName,i=e.fileNamePlaceHolder,o=t.fileName,a="fileName"),T("div",{class:K,key:a},T("label",null,s,T("input",{type:"text",tabIndex:0,placeholder:i,class:this.classes(L,gt),value:o,"data-input-name":a,onchange:this._updateInputValue,bind:this})))}_handleRootAfterCreate(t){this._rootNode=t,this.own(s(t,"scroll",(()=>{this._templateListPopover.open&&this.handleCloseTemplateSelection()})))}_focusOnTabChange(t){if(!this._activeTabFocusRequested)return;const e=t.getAttribute("data-tab-id");("layoutTab"===e&&this._layoutTabSelected||"mapOnlyTab"===e&&!this._layoutTabSelected)&&(t.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const t={[V]:this._awaitingServerResponse};return T("div",{class:this.classes(t),key:"loader"})}_createFileLink(t,e){const s=e||this.messages.untitled,i=t.format.toLowerCase(),o=i.indexOf("png")>-1?"png":i,a=s+o;return void 0!==this._exportedFileNameMap[a]?this._exportedFileNameMap[a]++:this._exportedFileNameMap[a]=0,new w({name:s,extension:o,count:this._exportedFileNameMap[a]})}_resetToCurrentScale(){this.templateOptions.scale=this.viewModel.view.scale}_updateCustomTextElementValue(t,e,s){t.find((t=>{const[s]=Object.entries(t)[0];return s===e}))[e]=s}_updateInputValue(t){const e=t.target,s=e.getAttribute("data-input-name"),i=!!e["data-input-custom"],{templateOptions:o}=this;if(i)return void this._updateCustomTextElementValue(o.customTextElements,s,e.value);let a;if("number"===e.type){if(!function(t){return!isNaN(t)&&t>0}(e.valueAsNumber)){const t=o[s];return void(e.value=`${t}`)}a=e.valueAsNumber}else a=e.value;o[s]=a}_handleDPIChange(t){this._updateInputValue(t);const e=t.currentTarget.valueAsNumber,{height:s,width:i}=function(t){return{width:Math.round(8.3333*t),height:Math.round(11.4583*t)}}(e),{templateOptions:o}=this;o.height=s,o.width=i}_handlePrintMap(){this._pendingExportScroll=!0;const{templateOptions:t}=this,e=this.viewModel.toPrintTemplate(t),s=this._layoutTabSelected?e.layoutOptions.titleText:t.fileName,i=this._createFileLink(e,s);this.exportedLinks.add(i),this.emit("submit",{link:i}),this.viewModel.print(e).then((t=>{i.set({url:t&&t.url,state:"ready"})})).catch((t=>{i.set({error:t,state:"error"})})).then((()=>{this.emit("complete",{link:i}),this.scheduleRender()}))}_updateFromOption(t){const e=t.target,s=e.selectedOptions?e.selectedOptions.item(0).value:e.options[e.selectedIndex].value,i=e.getAttribute("data-target-property");this.templateOptions[i]=s}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_showAdvancedOptions(){this._layoutTabSelected?this._advancedOptionsVisibleForLayout=!this._advancedOptionsVisibleForLayout:this._advancedOptionsVisibleForMapOnly=!this._advancedOptionsVisibleForMapOnly}_scrollExportIntoView(){if(this._pendingExportScroll){this._pendingExportScroll=!1;const{_rootNode:t,_rootNode:{clientHeight:e,scrollHeight:s}}=this,i=s-e;i>0&&(t.scrollTop=i)}}_toggleInputValue(t){const e=t.target,s=e.getAttribute("data-option-name");this.templateOptions[s]=e.checked,"scaleEnabled"===s&&(this.templateOptions[s]||this._resetToCurrentScale())}_renderExportedLink(t){const e=this.messages;return t.map((t=>{const{error:s,url:i,formattedName:o,state:a}=t,n="error"===a,p="pending"===a,c="ready"===a,d={[vt]:p||n};let m=i||null;m&&(m=l(m));const u=r(i,location.href),h={[Ut]:p,[wt]:p,[Ct]:u&&c,[It]:!u&&c,[Mt]:n,[kt]:n},b={[kt]:n};let y;y=p?e.pending:c?e.ready:e.errorMessage;const _=n?"print-task:cim-symbol-unsupported"===s.name?e.exportWebMapCIMError:e.exportWebMapError:"";return T("div",{"aria-label":y,class:et,"data-item":t,key:o,onclick:this._removeLink,title:_},T("a",{"aria-label":`${o}. ${e.linkReady}`,download:o,href:m,rel:"noreferrer",tabIndex:0,target:"_blank",class:this.classes(st,d)},T("span",{class:this.classes(h)}),T("span",{class:this.classes(it,b)},o)))}))}_toggleLayoutPanel(t){const e=t.target;this._toggleTab(e.getAttribute("data-tab-id"))}_toggleTab(t,e=!0){if(this._layoutTabSelected="layoutTab"===t,this._layoutTabSelected){const t=this.get("viewModel.templatesInfo.layout.choiceList");this.templateOptions.layout=t&&t[0]}else this.templateOptions.layout="MAP_ONLY";e&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(t){const e=i(t),s=t.target.getAttribute("data-tab-id");if(g(e))return this._toggleTab(s),t.preventDefault(),void t.stopPropagation();"ArrowLeft"!==e&&"ArrowRight"!==e||(this._toggleTab("layoutTab"===s?"mapOnlyTab":"layoutTab"),t.preventDefault(),t.stopPropagation())}};t([p("viewModel.allowedFormats")],Rt.prototype,"allowedFormats",void 0),t([p("viewModel.allowedLayouts")],Rt.prototype,"allowedLayouts",void 0),t([p("viewModel.error")],Rt.prototype,"error",void 0),t([c({type:x})],Rt.prototype,"exportedLinks",void 0),t([p("viewModel.extraParameters")],Rt.prototype,"extraParameters",void 0),t([c()],Rt.prototype,"headingLevel",void 0),t([c()],Rt.prototype,"iconClass",void 0),t([p("viewModel.includeDefaultTemplates")],Rt.prototype,"includeDefaultTemplates",void 0),t([c({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Rt.prototype,"label",void 0),t([c(),f("esri/widgets/Print/t9n/Print")],Rt.prototype,"messages",void 0),t([c(),f("esri/t9n/common")],Rt.prototype,"messagesCommon",void 0),t([p("viewModel.portal")],Rt.prototype,"portal",void 0),t([p("viewModel.printServiceUrl")],Rt.prototype,"printServiceUrl",void 0),t([p("viewModel.templateCustomTextElements")],Rt.prototype,"templateCustomTextElements",void 0),t([c({type:y})],Rt.prototype,"templateOptions",void 0),t([p("viewModel.view")],Rt.prototype,"view",void 0),t([c({type:b})],Rt.prototype,"viewModel",void 0),Rt=t([d("esri.widgets.Print")],Rt);const Bt=Rt;export{Bt as default};
