/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import n from"../core/Error.js";import{m as e,g as t,s as r,n as s,l,c as u,o,r as a,b as i,y as c}from"../chunks/mathUtils.js";import{b as f,u as p,i as h}from"../core/lang.js";import{throwIfAborted as m}from"../core/promiseUtils.js";import{d}from"../chunks/unitUtils.js";import{i as j,t as M,c as R}from"../chunks/mat4.js";import k from"./Extent.js";import g from"./Multipoint.js";import{p as w,i as y,l as E}from"../chunks/pe.js";import x from"./Point.js";import I from"./Polygon.js";import P from"./Polyline.js";import{S as T,W as S,c as C,d as b}from"../chunks/projectionEllipsoid.js";import{c as z}from"../chunks/aaBoundingRect.js";import{e as F,a as U,m as q}from"../chunks/Ellipsoid.js";import{e as A}from"../chunks/geodesicConstants.js";import G from"./support/GeographicTransformation.js";import{e as v,j as W,a as Z,i as _,k as B,f as L,h as N}from"./SpatialReference.js";import{g as J}from"../chunks/zscale.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/object.js";import"../chunks/string.js";import"../chunks/common.js";import"../chunks/jsonMap.js";import"../chunks/tslib.es6.js";import"../core/accessorSupport/decorators/property.js";import"../chunks/ensureType.js";import"../chunks/metadata.js";import"../chunks/handleUtils.js";import"../core/accessorSupport/decorators/subclass.js";import"./Geometry.js";import"../chunks/JSONSupport.js";import"../core/Accessor.js";import"../chunks/deprecate.js";import"../chunks/ArrayPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/reader.js";import"../chunks/writer.js";import"./support/webMercatorUtils.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/zmUtils.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/extentUtils.js";import"./support/GeographicTransformationStep.js";let K=null,O=null,V=null,X={};function D(){return!!K&&y()}function H(n){return f(V)&&(V=Promise.all([E(),import("../chunks/geometryEngineBase.js").then((n=>n.g)),import("../chunks/hydrated.js")])),V.then((([,e,{hydratedAdapter:t}])=>{m(n),O=t,K=e.default,K._enableProjection(w)}))}function Q(n,e,t=null){return Array.isArray(n)?0===n.length?[]:Y(O,n,n[0].spatialReference,e,t):Y(O,[n],n.spatialReference,e,t)[0]}function Y(n,e,t,r,s=null){if(f(t)||f(r))return e;if(sn(t,r,s))return e.map((n=>p(on(n,t,r))));if(f(s)){const n=G.cacheKey(t,r);void 0!==X[n]?s=X[n]:(s=$(t,r,null),f(s)&&(s=new G),X[n]=s)}if(f(K))throw new en;return K._project(n,e,t,r,s)}function $(n,e,t=null){if(f(K))throw new en;if(f(n)||f(e))return null;const r=K._getTransformation(O,n,e,t,null==t?void 0:t.spatialReference);return null!==r?G.fromGE(r):null}function nn(n,e,t=null){if(f(K))throw new en;const r=K._getTransformationBySuitability(O,n,e,t,null==t?void 0:t.spatialReference);if(null!==r){const n=[];for(const e of r)n.push(G.fromGE(e));return n}return[]}class en extends n{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}function tn(){K=null,O=null,V=null,X={}}function rn(n,e){try{const t=Q(n,e);if(null==t)return null;"xmin"in n&&"xmin"in t&&(t.zmin=n.zmin,t.zmax=n.zmax);const r=J(t.type,n.spatialReference,e);return h(r)&&r(t),t}catch(n){if(!(n instanceof en))throw n;return null}}function sn(n,e,t){return!t&&(!!v(n,e)||W(n)&&W(e)&&!!pe(n,e,Me))}async function ln(n,e,t,r){if(!D())if(Array.isArray(n)){for(const{source:e,dest:t,geographicTransformation:s}of n)if(!sn(e,t,s))return H(r)}else if(!sn(n,e,t))return H(r)}function un(n,e){switch(pe(n,e,Me)){case Wn:return"copy3";case ne:return"wgs84ToSphericalECEF";case Nn:return"wgs84ToWebMercator";case On:return"wgs84ToPlateCarree";case oe:return"wgs84ToWGS84ECEF";case Zn:return"webMercatorToWGS84";case _n:return"webMercatorToSphericalECEF";case Bn:return"webMercatorToWGS84ECEF";case Xn:return"webMercatorToPlateCarree";case ae:return"wgs84ECEFToWGS84";case ie:return"wgs84ECEFToSphericalECEF";case ce:return"wgs84ECEFToWebMercator";case se:return"sphericalECEFToWGS84";case le:return"sphericalECEFToWebMercator";case re:return"sphericalMarsPCPFToMars2000";case te:return"sphericalMoonPCPFToMoon2000";case ue:return"sphericalECEFToWGS84ECEF";case $n:return"mars2000ToSphericalPCPF";case Yn:return"moon2000ToSphericalPCPF";default:return null}}function on(n,e,t){return n?"x"in n?cn(n,e,new x,t,0):"xmin"in n?Rn(n,e,new k,t,0):"rings"in n?jn(n,e,new I,t,0):"paths"in n?mn(n,e,new P,t,0):"points"in n?pn(n,e,new g,t,0):null:null}function an(n,e,t=e.spatialReference,r=0){return!f(t)&&h(cn(n,n.spatialReference,e,t,r))}function cn(n,e,t,r,s){xe[0]=n.x,xe[1]=n.y;const l=n.z;return xe[2]=void 0!==l?l:s,Pn(xe,e,0,xe,r,0,1)?(t.x=xe[0],t.y=xe[1],t.spatialReference=r,void 0===l?(t.z=void 0,t.hasZ=!1):(t.z=xe[2],t.hasZ=!0),void 0===n.m?(t.m=void 0,t.hasM=!1):(t.m=n.m,t.hasM=!0),t):null}function fn(n,e,t=e.spatialReference,r=0){return!f(t)&&h(pn(n,n.spatialReference,e,t,r))}function pn(n,e,t,r,s){const{points:l,hasZ:u,hasM:o}=n,a=[],i=l.length,c=[];for(const n of l)c.push(n[0],n[1],u?n[2]:s);if(!Pn(c,e,0,c,r,0,i))return null;for(let n=0;n<i;++n){const e=3*n,t=c[e],r=c[e+1];u&&o?a.push([t,r,c[e+2],l[n][3]]):u?a.push([t,r,c[e+2]]):o?a.push([t,r,l[n][2]]):a.push([t,r])}return t.points=a,t.spatialReference=r,t.hasZ=u,t.hasM=o,t}function hn(n,e,t=e.spatialReference,r=0){return h(t)&&h(mn(n,n.spatialReference,e,t,r))}function mn(n,e,t,r,s){const{paths:l,hasZ:u,hasM:o}=n,a=[];return Sn(l,u,o,e,a,r,s)?(t.paths=a,t.spatialReference=r,t.hasZ=u,t.hasM=o,t):null}function dn(n,e,t=e.spatialReference,r=0){return h(t)&&h(jn(n,n.spatialReference,e,t,r))}function jn(n,e,t,r,s){const{rings:l,hasZ:u,hasM:o}=n,a=[];return Sn(l,u,o,e,a,r,s)?(t.rings=a,t.spatialReference=r,t.hasZ=u,t.hasM=o,t):null}function Mn(n,e,t=e.spatialReference,r=0){return h(t)&&h(Rn(n,n.spatialReference,e,t,r))}function Rn(n,e,t,r,s){const{xmin:l,ymin:u,xmax:o,ymax:a,hasZ:i,hasM:c}=n;if(!yn(l,u,i?n.zmin:s,e,xe,r))return null;t.xmin=xe[0],t.ymin=xe[1],i&&(t.zmin=xe[2]);return yn(o,a,i?n.zmax:s,e,xe,r)?(t.xmax=xe[0],t.ymax=xe[1],i&&(t.zmax=xe[2]),c&&(t.mmin=n.mmin,t.mmax=n.mmax),t.spatialReference=r,t):null}function kn(n,e,t){if(f(e)||f(t))return null;const r=new x({spatialReference:t});return Pn(n,e,0,xe,t,0,1)?(r.x=xe[0],r.y=xe[1],r.z=xe[2],r):null}function gn(n,e,t){return Pn(n,e,0,xe,t.spatialReference,0,1)?(t.x=xe[0],t.y=xe[1],t.z=xe[2],t):null}function wn(n,e,t,r=0){xe[0]=n.x,xe[1]=n.y;const s=n.z;return xe[2]=void 0!==s?s:r,Pn(xe,n.spatialReference,0,e,t,0,1)}function yn(n,e,t,r,s,l){return we[0]=n,we[1]=e,we[2]=t,Pn(we,r,0,s,l,0,1)}function En(n,e,t,r){return!(f(e)||f(r)||n.length<2)&&(2===n.length&&(we[0]=n[0],we[1]=n[1],we[2]=0,n=we),Pn(n,e,0,t,r,0,1))}function xn(n,e){xe[0]=n.x,xe[1]=n.y;const t=n.z;return xe[2]=void 0!==t?t:0,In(xe,n.spatialReference,e)}function In(n,e,t){return function(n,e,t){if(f(e))return!1;const r=vn(e,de),s=fe[r][6];if(f(s))return!1;s(n,0,we,0),t!==we&&(t[0]=we[0],t[1]=we[1],t.length>2&&(t[2]=we[2]));return!0}(n,e,t)}function Pn(n,e,t,r,s,l,u=1){const o=pe(e,s,Me);if(f(o))return!1;if(o===Wn){if(n===r&&t===l)return!0;const e=t+3*u;for(let s=t,u=l;s<e;s++,u++)r[u]=n[s];return!0}const a=t+3*u;for(let e=t,s=l;e<a;e+=3,s+=3)o(n,e,r,s);return!0}function Tn(n,l,u,o,a){e(xe,n),t(Ie,n,l),En(xe,u,xe,a),En(Ie,u,Ie,a),r(o,Ie,xe),s(o,o)}function Sn(n,e,t,r,s,l,u=0){const o=new Array;for(const t of n)for(const n of t)o.push(n[0],n[1],e?n[2]:u);if(!Pn(o,r,0,o,l,0,o.length/3))return!1;let a=0;s.length=0;for(const r of n){const n=new Array;for(const s of r)e&&t?n.push([o[a++],o[a++],o[a++],s[3]]):e?n.push([o[a++],o[a++],o[a++]]):t?(n.push([o[a++],o[a++],s[2]]),a++):(n.push([o[a++],o[a++]]),a++);s.push(n)}return!0}function Cn(n,e,t,r){if(f(e)||f(r))return!1;const s=he(e,r,Re);if(s.projector===Wn)return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],!0;if(f(s.projector))return!1;const{source:l,dest:u}=s;if(3===u.spatialReferenceId){const e=fe[l.spatialReferenceId][2];return!f(e)&&(e(n,0,ye,0),Nn(ye,0,t,0),t[3]=bn(ye[1],n[2],n[3],F.radius),!0)}if(2!==l.spatialReferenceId&&5!==l.spatialReferenceId||12!==u.spatialReferenceId)s.projector(n,0,t,0),t[3]=n[3]*l.metersPerUnit/u.metersPerUnit;else{const e=fe[l.spatialReferenceId][1],r=fe[1][12];let u=n[3];h(e)&&h(r)&&(u=bn(n[1],n[2],n[3],F.radius)),s.projector(n,0,t,0),t[3]=u}return!0}function bn(n,e,t,r){const s=Math.abs(ke*n)+Math.asin(t/(r+e));return s>=Math.PI/2?Number.MAX_VALUE:t/Math.cos(s)}function zn(n,e,t,r){return null!=n&&(v(e,r)?(z(t,n),!0):(we[0]=n[0],we[1]=n[1],we[2]=0,!!Pn(we,e,0,we,r,0,1)&&(t[0]=we[0],t[1]=we[1],we[0]=n[2],we[1]=n[3],we[2]=0,!!Pn(we,e,0,we,r,0,1)&&(t[2]=we[0],t[3]=we[1],!0))))}function Fn(n,e,t,r){if(f(e)||f(r))return!1;const s=vn(e,de),u=vn(r,je);if(s===u&&0!==s||v(e,r))return t[0]=1,t[1]=1,t[2]=1,!0;if(1===s){const e=l(n),r=e/Math.sqrt(n[0]*n[0]+n[1]*n[1]),s=e/F.radius;if(3===u)return t[0]=r*s,t[1]=r*s,t[2]=1,!0;if(2===u||5===u){const n=180/(F.radius*Math.PI);return t[0]=n*r*s,t[1]=n*s,t[2]=1,!0}}else if(12===s&&(2===u||5===u))return t[0]=Kn,t[1]=Kn,t[2]=1,!0;return!1}function Un(n,e,t,r){if(f(n)||f(r))return!1;const s=vn(n,de),l=vn(r,je);if(s===l&&!qn(l)&&(0!==s||v(n,r)))return j(t),M(t,t,e),!0;if(qn(l)){const n=fe[s][11],r=fe[11][l];return!f(n)&&!f(r)&&(n(e,0,ye,0),r(ye,0,Ee,0),An(ke*ye[0],ke*ye[1],t),t[12]=Ee[0],t[13]=Ee[1],t[14]=Ee[2],!0)}if(!(3!==l&&12!==l||2!==s&&1!==s&&3!==s)){const n=fe[s][11],r=fe[11][l];return!f(n)&&!f(r)&&(n(e,0,ye,0),r(ye,0,Ee,0),1===s?Gn(ke*ye[0],ke*ye[1],t):j(t),t[12]=Ee[0],t[13]=Ee[1],t[14]=Ee[2],!0)}return!1}function qn(n){return 1===n||7===n||9===n}function An(n,e,t){const r=Math.sin(n),s=Math.cos(n),l=Math.sin(e),u=Math.cos(e),o=t;return o[0]=-r,o[4]=-l*s,o[8]=u*s,o[12]=0,o[1]=s,o[5]=-l*r,o[9]=u*r,o[13]=0,o[2]=0,o[6]=u,o[10]=l,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1,o}function Gn(n,e,t){return An(n,e,t),R(t,t),t}function vn(n,e){return e.spatialReference===n?e.spatialReferenceId:(e.spatialReference=n,"metersPerUnit"in e&&(e.metersPerUnit=d(n,1)),n.wkt===T.wkt?e.spatialReferenceId=1:Z(n)?e.spatialReferenceId=2:_(n)?e.spatialReferenceId=3:B(n)?e.spatialReferenceId=12:n.wkt===S.wkt?e.spatialReferenceId=4:4490===n.wkid?e.spatialReferenceId=5:n.wkt===C.wkt?e.spatialReferenceId=7:n.wkt===b.wkt?e.spatialReferenceId=9:L(n)?e.spatialReferenceId=8:N(n)?e.spatialReferenceId=10:e.spatialReferenceId=0)}function Wn(n,e,t,r){n!==t&&(t[r++]=n[e++],t[r++]=n[e++],t[r]=n[e])}function Zn(n,e,t,r){t[r++]=ge*(n[e++]/F.radius),t[r++]=ge*(Math.PI/2-2*Math.atan(Math.exp(-n[e++]/F.radius))),t[r]=n[e]}function _n(n,e,t,r){Zn(n,e,t,r),ne(t,r,t,r)}function Bn(n,e,t,r){Zn(n,e,t,r),oe(t,r,t,r)}function Ln(n,e,t,r,s){const l=.4999999*Math.PI,o=u(ke*n[e+1],-l,l),a=Math.sin(o);t[r++]=ke*n[e]*s.radius,t[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),t[r]=n[e+2]}function Nn(n,e,t,r){Ln(n,e,t,r,F)}const Jn=F.radius*Math.PI/180,Kn=180/(F.radius*Math.PI);function On(n,e,t,r){t[r]=n[e]*Jn,t[r+1]=n[e+1]*Jn,t[r+2]=n[e+2]}function Vn(n,e,t,r){t[r]=n[e]*Kn,t[r+1]=n[e+1]*Kn,t[r+2]=n[e+2]}function Xn(n,e,t,r){Zn(n,e,t,r),On(t,r,t,r)}function Dn(n){if(f(n))return!1;const e=vn(n,de);return!!fe[e][6]}function Hn(n,e,t,r,s=0){const l=r+s,u=Math.cos(t);n[0]=Math.cos(e)*u*l,n[1]=Math.sin(e)*u*l,n[2]=Math.sin(t)*l}function Qn(n,e,t,r,s){const l=s+n[e+2],u=ke*n[e+1],o=ke*n[e],a=Math.cos(u);t[r++]=Math.cos(o)*a*l,t[r++]=Math.sin(o)*a*l,t[r]=Math.sin(u)*l}function Yn(n,e,t,r){Qn(n,e,t,r,U.radius)}function $n(n,e,t,r){Qn(n,e,t,r,q.radius)}function ne(n,e,t,r){Qn(n,e,t,r,F.radius)}function ee(n,e,t,r,s){const l=n[e],u=n[e+1],o=n[e+2],a=Math.sqrt(l*l+u*u+o*o),i=c(o/(0===a?1:a)),f=Math.atan2(u,l);t[r++]=ge*f,t[r++]=ge*i,t[r]=a-s}function te(n,e,t,r){ee(n,e,t,r,U.radius)}function re(n,e,t,r){ee(n,e,t,r,q.radius)}function se(n,e,t,r){ee(n,e,t,r,F.radius)}function le(n,e,t,r){se(n,e,t,r),Nn(t,r,t,r)}function ue(n,e,t,r){se(n,e,t,r),oe(t,r,t,r)}function oe(n,e,t,r){!function(n,e,t,r,s){const l=ke*n[e],u=ke*n[e+1],o=n[e+2],a=Math.sin(u),i=Math.cos(u),c=s.radius/Math.sqrt(1-s.eccentricitySquared*a*a);t[r++]=(c+o)*i*Math.cos(l),t[r++]=(c+o)*i*Math.sin(l),t[r++]=(c*(1-s.eccentricitySquared)+o)*a}(n,e,t,r,F)}function ae(n,e,t,r){const s=A,l=n[e],u=n[e+1],o=n[e+2];let a,i,c,f,p,h,m,d,j,M,R,k,g,w,y,E,x,I,P,T,S;a=Math.abs(o),i=l*l+u*u,c=Math.sqrt(i),f=i+o*o,p=Math.sqrt(f),T=Math.atan2(u,l),h=o*o/f,m=i/f,w=s.a2/p,y=s.a3-s.a4/p,m>.3?(d=a/p*(1+m*(s.a1+w+h*y)/p),P=Math.asin(d),M=d*d,j=Math.sqrt(1-M)):(j=c/p*(1-h*(s.a5-w-m*y)/p),P=Math.acos(j),M=1-j*j,d=Math.sqrt(M)),R=1-F.eccentricitySquared*M,k=F.radius/Math.sqrt(R),g=s.a6*k,w=c-k*j,y=a-g*d,x=j*w+d*y,E=j*y-d*w,I=E/(g/R+x),P+=I,S=x+E*I/2,o<0&&(P=-P),t[r++]=ge*T,t[r++]=ge*P,t[r]=S}function ie(n,e,t,r){ae(n,e,t,r),ne(t,r,t,r)}function ce(n,e,t,r){ae(n,e,t,r),Nn(t,r,t,r)}const fe={2:{5:null,8:null,10:null,11:Wn,6:Wn,1:ne,7:null,9:null,0:null,3:Nn,12:On,2:Wn,4:oe},5:{5:Wn,8:null,10:null,11:Wn,6:Wn,1:ne,7:null,9:null,0:null,3:null,12:On,2:null,4:oe},8:{5:null,8:Wn,10:null,11:Wn,6:null,1:null,7:$n,9:null,0:null,3:null,12:null,2:null,4:null},10:{5:null,8:null,10:Wn,11:Wn,6:null,1:null,7:null,9:Yn,0:null,3:null,12:null,2:null,4:null},3:{5:null,8:null,10:null,11:Zn,6:Zn,1:_n,7:null,9:null,0:null,3:Wn,12:Xn,2:Zn,4:Bn},4:{5:ae,8:null,10:null,11:ae,6:ae,1:ie,7:null,9:null,0:null,3:ce,12:function(n,e,t,r){ae(n,e,t,r),On(t,r,t,r)},2:ae,4:Wn},1:{5:se,8:null,10:null,11:se,6:se,1:Wn,7:null,9:null,0:null,3:le,12:function(n,e,t,r){se(n,e,t,r),On(t,r,t,r)},2:se,4:ue},7:{5:null,8:re,10:null,11:re,6:null,1:null,7:Wn,9:null,0:null,3:null,12:null,2:null,4:null},9:{5:null,8:null,10:te,11:te,6:null,1:null,7:null,9:Wn,0:null,3:null,12:null,2:null,4:null},0:{5:null,8:null,10:null,11:null,6:null,1:null,7:null,9:null,0:Wn,3:null,12:null,2:null,4:null},11:{5:Wn,8:Wn,10:Wn,11:Wn,6:Wn,1:ne,7:$n,9:Yn,0:null,3:Nn,12:On,2:Wn,4:oe},6:{5:null,8:null,10:null,11:Wn,6:Wn,1:ne,7:null,9:null,0:null,3:null,12:On,2:Wn,4:oe},12:{5:Vn,8:null,10:null,11:Vn,6:Vn,1:function(n,e,t,r){Vn(n,e,t,r),ne(t,r,t,r)},7:null,9:null,0:null,3:function(n,e,t,r){Vn(n,e,t,r),Nn(t,r,t,r)},12:Wn,2:Vn,4:function(n,e,t,r){Vn(n,e,t,r),oe(t,r,t,r)}}};function pe(n,e,t=me()){return f(n)||f(e)?null:he(n,e,t).projector}function he(n,e,t){if(f(n)||f(e)||t.source.spatialReference===n&&t.dest.spatialReference===e)return t;const r=vn(n,t.source),s=vn(e,t.dest);return 0===r&&0===s?v(n,e)?t.projector=Wn:t.projector=null:t.projector=fe[r][s],t}function me(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:Wn}}const de={spatialReference:null,spatialReferenceId:0},je={spatialReference:null,spatialReferenceId:0},Me=me(),Re=me(),ke=o(1),ge=a(1),we=i(),ye=i(),Ee=i(),xe=i(),Ie=i();export{Dn as canProjectToWGS84ComparableLonLat,sn as canProjectWithoutEngine,An as computeENUToSphericalPCPFLocalRotation,Gn as computeSphericalPCPFToENULocalRotation,Un as computeTranslationToOriginAndRotation,un as getProjectorName,$ as getTransformation,nn as getTransformations,ln as initializeProjection,D as isLoaded,H as load,Fn as localLinearScaleFactors,Hn as lonLatToSphericalPCPF,Ln as lonLatToWebMercatorComparable,Q as project,zn as projectBoundingRect,Cn as projectBoundingSphere,Pn as projectBuffer,Tn as projectDirection,Mn as projectExtent,Y as projectMany,fn as projectMultipoint,an as projectPoint,wn as projectPointToVector,xn as projectPointToWGS84ComparableLonLat,dn as projectPolygon,hn as projectPolyline,gn as projectVectorToDehydratedPoint,kn as projectVectorToPoint,En as projectVectorToVector,In as projectVectorToWGS84ComparableLonLat,on as projectWithoutEngine,yn as projectXYZToVector,ee as sphericalPCPFtoLonLatElevation,rn as tryProjectWithZConversion,tn as unload};
