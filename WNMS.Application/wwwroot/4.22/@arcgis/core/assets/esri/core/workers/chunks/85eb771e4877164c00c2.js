"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[2870,2058],{73173:(e,t,r)=>{r.d(t,{g:()=>l});var n=r(31450),s=(r(82058),r(60991)),o=r(92143),i=r(32101);const a=o.L.getLogger("esri.assets");function l(e){if(!n.Z.assetsPath)throw a.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new s.Z("assets:path-not-set","config.assetsPath is not set");return(0,i.v_)(n.Z.assetsPath,e)}},46987:(e,t,r)=>{r.d(t,{Z:()=>l});var n=r(22723),s=r(92143),o=r(50406),i=r(37453);r(76506),r(31450),r(71552),r(40642),r(60991),r(88762),r(32101);const a=s.L.getLogger("esri.core.workers.Connection");class l{constructor(){this._clients=new Array,this._clientPromises=new Array,this._clientIdx=0}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,t){return new Promise(((r,n)=>{let s=!0;const a=e=>{(0,o.k_)(t.signal),s&&(s=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length;for(let s=0;s<e.length;++s){const l=e[s];(0,o.y8)(l)?this._clientPromises[s]=l.then((e=>(this._clients[s]=new i.default(e,t),a(r),this._clients[s])),(()=>(a(n),null))):(this._clients[s]=new i.default(l,t),this._clientPromises[s]=Promise.resolve(this._clients[s]),a(r))}}))}broadcast(e,t,r){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const o=this._clientPromises[s];n[s]=o.then((n=>n.invoke(e,t,r)))}return n}close(){for(const e of this._clientPromises)e.then((e=>e.close()));this._clients.length=0,this._clientPromises.length=0}getAvailableClient(){let e;for(let t=0;t<this._clients.length;++t){const r=this._clients[t];if(r){if(!r.isBusy())return Promise.resolve(r)}else e=e||[],e.push(this._clientPromises[t])}return e?Promise.race(e):(this._clientIdx=(this._clientIdx+1)%this._clients.length,Promise.resolve(this._clients[this._clientIdx]))}invoke(e,t,r){let n=null;return Array.isArray(r)?(a.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:r}):n=r,this.closed?Promise.reject(new Error("Connection closed")):this.getAvailableClient().then((r=>r.invoke(e,t,n)))}on(e,t){return Promise.all(this._clientPromises).then((()=>(0,n.h)(this._clients.map((r=>r.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let r=t.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then((s=>{t[n]=s.openPort(),0==--r&&e(t)}))}))}get test(){return{numClients:this._clients.length}}}},37453:(e,t,r)=>{r.r(t),r.d(t,{M:()=>l,default:()=>O,n:()=>h,p:()=>p,r:()=>f,t:()=>d});var n=r(88762),s=r(60991),o=r(50406),i=r(76506);r(32101),r(31450),r(71552),r(92143),r(40642);const a={statsWorker:()=>Promise.all([r.e(6229),r.e(1801),r.e(243),r.e(776),r.e(9461)]).then(r.bind(r,99461)).then((e=>e.f)),geometryEngineWorker:()=>Promise.all([r.e(3361),r.e(8258)]).then(r.bind(r,68258)),CSVSourceWorker:()=>Promise.all([r.e(6229),r.e(1801),r.e(243),r.e(776),r.e(1623),r.e(2274),r.e(873),r.e(673),r.e(7711),r.e(9884)]).then(r.bind(r,59884)),EdgeProcessingWorker:()=>r.e(8936).then(r.bind(r,8936)).then((e=>e.b)),ElevationSamplerWorker:()=>Promise.all([r.e(6229),r.e(1801),r.e(243),r.e(1623),r.e(4047),r.e(2795)]).then(r.bind(r,2795)),FeatureServiceSnappingSourceWorker:()=>Promise.all([r.e(6229),r.e(1801),r.e(243),r.e(776),r.e(8081),r.e(1623),r.e(2274),r.e(6971),r.e(873),r.e(673),r.e(7711),r.e(1151)]).then(r.bind(r,31151)),GeoJSONSourceWorker:()=>Promise.all([r.e(6229),r.e(1801),r.e(243),r.e(776),r.e(1623),r.e(2274),r.e(873),r.e(673),r.e(7711),r.e(3866),r.e(5181)]).then(r.bind(r,65181)),LercWorker:()=>r.e(8281).then(r.bind(r,38281)),MemorySourceWorker:()=>Promise.all([r.e(6229),r.e(1801),r.e(243),r.e(776),r.e(1623),r.e(2274),r.e(873),r.e(673),r.e(7711),r.e(3866),r.e(3900)]).then(r.bind(r,3900)),PBFDecoderWorker:()=>Promise.all([r.e(6229),r.e(1801),r.e(243),r.e(629)]).then(r.bind(r,629)),Pipeline:()=>Promise.all([r.e(6229),r.e(1801),r.e(243),r.e(776),r.e(123),r.e(8081),r.e(1623),r.e(2274),r.e(6971),r.e(873),r.e(673),r.e(7663),r.e(7065)]).then(r.bind(r,47065)),PointCloudWorker:()=>Promise.all([r.e(6229),r.e(1801),r.e(243),r.e(1623),r.e(9151),r.e(5107)]).then(r.bind(r,5107)),RasterWorker:()=>Promise.all([r.e(6229),r.e(1801),r.e(243),r.e(1623),r.e(7195),r.e(9275)]).then(r.bind(r,59275)),SceneLayerWorker:()=>r.e(8931).then(r.bind(r,88931)),WFSSourceWorker:()=>Promise.all([r.e(6229),r.e(1801),r.e(243),r.e(776),r.e(1623),r.e(2274),r.e(873),r.e(673),r.e(7711),r.e(3866),r.e(1856),r.e(3018)]).then(r.bind(r,3018)),WorkerTileHandler:()=>Promise.all([r.e(5917),r.e(7497),r.e(3315)]).then(r.bind(r,53315))};var l,c;(c=l||(l={}))[c.HANDSHAKE=0]="HANDSHAKE",c[c.OPEN=1]="OPEN",c[c.OPENED=2]="OPENED",c[c.RESPONSE=3]="RESPONSE",c[c.INVOKE=4]="INVOKE",c[c.ABORT=5]="ABORT",c[c.CLOSE=6]="CLOSE",c[c.OPEN_PORT=7]="OPEN_PORT",c[c.ON=8]="ON";let u=0;function h(){return u++}function d(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function p(e,t,r,n){if(t.type===l.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==l.INVOKE&&t.type!==l.RESPONSE)return void e.postMessage(t);let s;var o;(o=r)&&"object"==typeof o&&("result"in o||"transferList"in o)?(s=m(r.transferList),t.data=r.result):(s=m(n),t.data=r),s?e.postMessage(t,s):e.postMessage(t)}function f(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function m(e){if(!e||!e.length)return null;if((0,i.h)("esri-workers-arraybuffer-transfer"))return e;const t=e.filter((e=>{return!((t=e)instanceof ArrayBuffer||t&&t.constructor&&"ArrayBuffer"===t.constructor.name);var t}));return t.length?t:null}const{CLOSE:g,ABORT:y,INVOKE:b,RESPONSE:_,OPEN_PORT:w,ON:v}=l;class k{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===l.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class O{constructor(e,t){this._port=e,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new k((e=>this._onInvokeMessage(e))),this._client=t.client,this._onMessage=this._onMessage.bind(this),this._channel=t.channel,this._schedule=t.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(e){const t=new MessageChannel;let r;r="function"==typeof e?new e:"default"in e&&"function"==typeof e.default?new e.default:e;const n=new O(t.port1,{channel:t,client:r});return"object"==typeof r&&"remoteClient"in r&&(r.remoteClient=n),O.clients.set(n,r),t.port2}static loadWorker(e){const t=a[e];return t?t():Promise.resolve(null)}close(){this._post({type:g}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,t,r){const n=r&&r.signal,i=r&&r.transferList;if(!this._port)return Promise.reject(new s.Z("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:t}));const a=h();return new Promise(((r,s)=>{const l=(0,o.$F)(n,(()=>{var e;const t=this._outJobs.get(a);t&&(this._outJobs.delete(a),null==(e=t.abortHandle)||e.remove(),this._post({type:y,jobId:a}),s((0,o.zE)()))})),c={resolve:r,reject:s,abortHandle:l,debugInfo:e};this._outJobs.set(a,c),this._post({type:b,jobId:a,methodName:e,abortable:null!=n},t,i)}))}on(e,t){const r=new MessageChannel;function n(e){t(e.data)}return this._port.postMessage({type:l.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",n),r.port1.start(),{remove(){r.port1.postMessage({type:l.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",n)}}}openPort(){const e=new MessageChannel;return this._post({type:w,port:e.port2}),e.port1}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((e=>{var t;null==(t=e.abortHandle)||t.remove(),e.reject((0,o.zE)(`Worker closing, aborting job calling '${e.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(e){(0,i.i)(this._schedule)?this._schedule((()=>this._processMessage(e))):this._processMessage(e)}_processMessage(e){const t=f(e);if(t)switch(t.type){case _:this._onResponseMessage(t);break;case b:this._invokeQueue.push(t);break;case y:this._onAbortMessage(t);break;case g:this._onCloseMessage();break;case w:this._onOpenPortMessage(t);break;case v:this._onOnMessage(t)}}_onAbortMessage(e){const t=this._inJobs,r=e.jobId,n=t.get(r);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),t.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&O.clients.get(this)===e&&e.destroy(),O.clients.delete(this),e&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:t,jobId:r,data:n,abortable:s}=e,i=s?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[t];try{if(!u&&t&&-1!==t.indexOf(".")){const e=t.split(".");for(let t=0;t<e.length-1;t++)c=c[e[t]],u=c[e[t+1]]}if("function"!=typeof u)throw new TypeError(`${t} is not a function`);l=u.call(c,n,{client:this,signal:i?i.signal:null})}catch(e){return void this._post({type:_,jobId:r,error:d(e)})}(0,o.y8)(l)?(a.set(r,{controller:i,promise:l}),l.then((e=>{a.has(r)&&(a.delete(r),this._post({type:_,jobId:r},e))}),(e=>{a.has(r)&&(a.delete(r),(0,o.D_)(e)||this._post({type:_,jobId:r,error:d(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:_,jobId:r},l)}_onOpenPortMessage(e){new O(e.port,{client:this._client})}_onOnMessage(e){const{port:t}=e,r=this._client.on(e.eventType,(e=>{t.postMessage(e)})),n=(0,o.o)(e.port,"message",(e=>{f(e).type===l.CLOSE&&(n.remove(),r.remove(),t.close())}))}_onResponseMessage(e){var t;const{jobId:r,error:n,data:o}=e,i=this._outJobs;if(!i.has(r))return;const a=i.get(r);i.delete(r),null==(t=a.abortHandle)||t.remove(),n?a.reject(s.Z.fromJSON(JSON.parse(n))):a.resolve(o)}_post(e,t,r){return p(this._port,e,t,r)}}O.kernelInfo={revision:n.LB,version:n.i8,buildDate:n.rh},O.clients=new Map},42870:(e,t,r)=>{r.d(t,{f3:()=>L,oq:()=>u,r3:()=>d,jU:()=>p,z7:()=>h,Cz:()=>N,e5:()=>P,ED:()=>_,TE:()=>f,fS:()=>m,D$:()=>x,Y4:()=>R,rd:()=>q,j2:()=>A,kQ:()=>J,wf:()=>S,kK:()=>g,Gg:()=>k,cv:()=>C,Nm:()=>w,CJ:()=>I,sz:()=>j,LV:()=>v,U1:()=>M,og:()=>O,Sp:()=>E,W4:()=>y,G0:()=>T,uh:()=>b}),r(74569);var n=r(65514),s=(r(91597),r(32422));function o(e){var t;return Array.isArray(e)?null==(t=e[0])?void 0:t.spatialReference:null==e?void 0:e.spatialReference}function i(e){return e?Array.isArray(e)?e.map(i):e.toJSON?e.toJSON():e:e}function a(e){return Array.isArray(e)?e.map((e=>(0,s.im)(e))):(0,s.im)(e)}let l;async function c(e,t){return(await async function(){return l||(l=(0,n.bA)("geometryEngineWorker",{strategy:"distributed"})),l}()).invoke("executeGEOperation",{operation:e,parameters:i(t)})}async function u(e,t){return a(await c("clip",[o(e),e,t]))}async function h(e,t){return a(await c("cut",[o(e),e,t]))}function d(e,t){return c("contains",[o(e),e,t])}function p(e,t){return c("crosses",[o(e),e,t])}function f(e,t,r){return c("distance",[o(e),e,t,r])}function m(e,t){return c("equals",[o(e),e,t])}function g(e,t){return c("intersects",[o(e),e,t])}function y(e,t){return c("touches",[o(e),e,t])}function b(e,t){return c("within",[o(e),e,t])}function _(e,t){return c("disjoint",[o(e),e,t])}function w(e,t){return c("overlaps",[o(e),e,t])}function v(e,t,r){return c("relate",[o(e),e,t,r])}function k(e){return c("isSimple",[o(e),e])}async function O(e){return a(await c("simplify",[o(e),e]))}async function P(e,t){return a(await c("difference",[o(e),e,t]))}async function E(e,t){return a(await c("symmetricDifference",[o(e),e,t]))}async function S(e,t){return a(await c("intersect",[o(e),e,t]))}async function T(e,t=null){const r=function(e,t){let r;return Array.isArray(e)?r=e:(r=[],r.push(e),null!=t&&r.push(t)),r}(e,t);return a(await c("union",[o(r),r]))}async function C(e,t,r,n,s,i){return a(await c("offset",[o(e),e,t,r,n,s,i]))}async function L(e,t,r,n=!1){const s=[o(e),e,t,r,n];return a(await c("buffer",s))}async function q(e,t,r,n,s,i){const l=[o(e),e,t,r,n,s,i];return a(await c("geodesicBuffer",l))}async function M(e,t,r){var n;if(null==e)throw new Error("Illegal Argument Exception");const s=e.spatialReference;r=null!=(n=r)?n:function(e){return"xmin"in e?e.center:"x"in e?e:e.extent.center}(e);const o=e.constructor.fromJSON(await c("rotate",[s,e,t,r]));return o.spatialReference=s,o}async function x(e,t,r,n){return a(await c("generalize",[o(e),e,t,r,n]))}async function N(e,t,r){return a(await c("densify",[o(e),e,t,r]))}async function A(e,t,r,n=0){return a(await c("geodesicDensify",[o(e),e,t,r,n]))}function I(e,t){return c("planarArea",[o(e),e,t])}function j(e,t){return c("planarLength",[o(e),e,t])}function R(e,t,r){return c("geodesicArea",[o(e),e,t,r])}function J(e,t,r){return c("geodesicLength",[o(e),e,t,r])}r(91306),r(76506),r(92143),r(31450),r(71552),r(40642),r(21801),r(34250),r(86656),r(22723),r(17533),r(60991),r(73796),r(74673),r(21972),r(23639),r(91055),r(6906),r(50406),r(97714),r(60947),r(2906),r(35132),r(89623),r(86787),r(84069),r(44567),r(98380),r(92896),r(22781),r(57251),r(46987),r(37453),r(88762),r(32101),r(73173),r(82058),r(66284),r(33921),r(3482),r(87239)},82058:(e,t,r)=>{r.r(t),r.d(t,{default:()=>p,l:()=>h,r:()=>q,s:()=>u});var n=r(31450),s=r(88762),o=r(60991),i=r(76506),a=r(50406),l=r(32101);r(71552),r(92143),r(40642);const c=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function u(e){const t=(0,l.P$)(e,!0);return t&&t.endsWith(".arcgis.com")&&!c.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function h(e,t,r=!1,n){return new Promise(((s,o)=>{if((0,a.Hc)(n))return void o(d());let l=()=>{h(),o(new Error(`Unable to load ${t}`))},c=()=>{const t=e;h(),s(t)},u=()=>{if(!e)return;const t=e;h(),t.src="",o(d())};const h=()=>{(0,i.h)("esri-image-decode")||(e.removeEventListener("error",l),e.removeEventListener("load",c)),l=null,c=null,e=null,(0,i.i)(n)&&n.removeEventListener("abort",u),u=null,r&&URL.revokeObjectURL(t)};(0,i.i)(n)&&n.addEventListener("abort",u),(0,i.h)("esri-image-decode")?e.decode().then(c,l):(e.addEventListener("error",l),e.addEventListener("load",c))}))}function d(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}async function p(e,t){var c;const h=(0,l.HK)(e),d=(0,l.jc)(e);d||h||(e=(0,l.Fv)(e));const y={url:e,requestOptions:{...(0,i.u)(t)}};let b=(0,l.oh)(e);if(b){const e=await async function(e,t){if(null!=e.responseData)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let r,n;try{n=await e.before(t)}catch(e){r=O("request:interceptor",e,t)}if((n instanceof Error||n instanceof o.Z)&&(r=O("request:interceptor",n,t)),r)throw e.error&&e.error(r),r;return n}}(b,y);if(null!=e)return{data:e,getHeader:w,requestOptions:y.requestOptions,url:y.url};b.after||b.error||(b=null)}if(e=y.url,"image"===(t=y.requestOptions).responseType){if((0,i.h)("host-webworker")||(0,i.h)("host-node"))throw O("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),y)}else if(h)throw O("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),y);if("head"===t.method){if(t.body)throw O("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),y);if(h||d)throw O("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),y)}if(await async function(){(0,i.h)("host-webworker")?f||(f=await r.e(9768).then(r.bind(r,89768))):p._abortableFetch||(p._abortableFetch=globalThis.fetch.bind(globalThis))}(),f)return f.execute(e,t);const _=new AbortController;(0,a.fu)(t,(()=>_.abort()));const v={controller:_,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:b,params:y,redoRequest:!1,useIdentity:m.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},k=await async function(e){var t,r;let o,i;await async function(e){const t=e.params.url,r=e.params.requestOptions,o=e.controller.signal,i=r.body;let l=null,c=null,h=null;if(g&&"HTMLFormElement"in globalThis&&(i instanceof FormData?l=i:i instanceof HTMLFormElement&&(c=i,l=new FormData(c))),"string"==typeof i&&(h=i),e.fetchOptions={cache:r.cacheBust&&!p._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:"head"===r.method?"HEAD":"GET",mode:"cors",redirect:"follow",signal:o},(l||h)&&(e.fetchOptions.body=l||h),"anonymous"===r.authMode&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||r.query&&r.query.token||l&&l.get&&l.get("token")||c&&c.elements.token),!e.hasToken&&n.Z.apiKey&&u(t)&&(r.query||(r.query={}),r.query.token=n.Z.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!E(t)&&!(0,a.Hc)(o)){let n;"immediate"===r.authMode?(await P(),n=await s.id.getCredential(t,{signal:o}),e.credential=n):"no-prompt"===r.authMode?(await P(),n=await s.id.getCredential(t,{prompt:!1,signal:o}).catch((()=>{})),e.credential=n):s.id&&(n=s.id.findCredential(t)),n&&(e.credentialToken=n.token,e.useSSL=!!n.ssl)}}(e);try{do{[o,i]=await S(e)}while(!await C(e,o,i))}catch(t){const r=O("request:server",t,e.params,o);throw r.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(r),r}const c=e.params.url;if(/\/sharing\/rest\/(accounts|portals)\/self/i.test(c)&&!e.hasToken&&!e.credentialToken&&null!=(t=i)&&null!=(r=t.user)&&r.username&&!(0,l.kl)(c)){const e=(0,l.P$)(c,!0);e&&m.trustedServers.push(e)}const h=e.credential;if(h&&s.id){const e=s.id.findServerInfo(h.server);let t=e&&e.owningSystemUrl;if(t){t=t.replace(/\/?$/,"/sharing");const e=s.id.findCredential(t,h.userId);e&&-1===s.id._getIdenticalSvcIdx(t,e)&&e.resources.unshift(t)}}return{data:i,getHeader:o?e=>o.headers.get(e):w,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}(v);return null==(c=b)||null==c.after||c.after(k),k}let f;const m=n.Z.request,g="FormData"in globalThis,y=[499,498,403,401],b=["COM_0056","COM_0057","SB_0008"],_=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],w=()=>null,v=Symbol();function k(e){const t=(0,l.P$)(e);return!t||t.endsWith(".arcgis.com")||p._corsServers.includes(t)||(0,l.kl)(t)}function O(e,t,r,n){let s="Error";const l={url:r.url,requestOptions:r.requestOptions,getHeader:w,ssl:!1};if(t instanceof o.Z)return t.details?(t.details=(0,i.d9)(t.details),t.details.url=r.url,t.details.requestOptions=r.requestOptions):t.details=l,t;if(t){const e=n&&(e=>n.headers.get(e)),r=n&&n.status,o=t.message;o&&(s=o),e&&(l.getHeader=e),l.httpStatus=(null!=t.httpCode?t.httpCode:t.code)||r||0,l.subCode=t.subcode,l.messageCode=t.messageCode,"string"==typeof t.details?l.messages=[t.details]:l.messages=t.details,l.raw=v in t?t[v]:t}return(0,a.D_)(t)?(0,a.zE)():new o.Z(e,s,l)}async function P(){s.id||await Promise.all([r.e(6229),r.e(406),r.e(2303),r.e(9798)]).then(r.bind(r,89798))}function E(e){return _.some((t=>t.test(e)))}async function S(e){let t=e.params.url;const r=e.params.requestOptions,n=e.fetchOptions,o=(0,l.jc)(t)||(0,l.HK)(t),c=r.responseType||"json",u=o?0:null!=r.timeout?r.timeout:m.timeout;let h=!1;if(!o){e.useSSL&&(t=(0,l.hO)(t)),r.cacheBust&&"default"===n.cache&&(t=(0,l.ZN)(t,"request.preventCache",Date.now()));let o={...r.query};e.credentialToken&&(o.token=e.credentialToken);let a=(0,l.B7)(o);(0,i.h)("esri-url-encodes-apostrophe")&&(a=a.replace(/'/g,"%27"));const c=t.length+1+a.length;let u;h="delete"===r.method||"post"===r.method||"put"===r.method||!!r.body||c>m.maxUrlLength;const d=r.useProxy||!!(0,l.ed)(t);if(d){const e=(0,l.b7)(t);u=e.path,!h&&u.length+1+c>m.maxUrlLength&&(h=!0),e.query&&(o={...e.query,...o})}if("HEAD"===n.method&&(h||d)){if(h){if(c>m.maxUrlLength)throw O("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params);throw O("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params)}if(d)throw O("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(h?(n.method="delete"===r.method?"DELETE":"put"===r.method?"PUT":"POST",r.body?t=(0,l.fl)(t,o):(n.body=(0,l.B7)(o),n.headers["Content-Type"]="application/x-www-form-urlencoded")):t=(0,l.fl)(t,o),d&&(e.useProxy=!0,t=`${u}?${t}`),o.token&&g&&n.body instanceof FormData){const e=n.body;e.set?e.set("token",o.token):e.append("token",o.token)}if(r.hasOwnProperty("withCredentials"))e.withCredentials=r.withCredentials;else if(!(0,l.D6)(t,l.Gd))if((0,l.kl)(t))e.withCredentials=!0;else if(s.id){const r=s.id.findServerInfo(t);r&&r.webTierAuth&&(e.withCredentials=!0)}e.withCredentials&&(n.credentials="include")}let d,f,y=0,b=!1;u>0&&(y=setTimeout((()=>{b=!0,e.controller.abort()}),u));try{if("native-request-init"===r.responseType)f=n,f.url=t;else if("image"!==r.responseType||"default"!==n.cache||"GET"!==n.method||h||function(e){if(e)for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0;return!1}(r.headers)||!o&&!e.useProxy&&m.proxyUrl&&!k(t)){if(d=await p._abortableFetch(t,n),e.useProxy||function(e){const t=(0,l.P$)(e);t&&!p._corsServers.includes(t)&&p._corsServers.push(t)}(t),"native"===r.responseType)f=d;else if("HEAD"!==n.method)if(d.ok){switch(c){case"array-buffer":f=await d.arrayBuffer();break;case"blob":case"image":f=await d.blob();break;default:f=await d.text()}if(y&&(clearTimeout(y),y=0),"json"===c||"xml"===c||"document"===c)if(f)switch(c){case"json":f=JSON.parse(f);break;case"xml":f=T(f,"application/xml");break;case"document":f=T(f,"text/html")}else f=null;if(f){if("array-buffer"===c||"blob"===c){const e=d.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(e)&&f["blob"===c?"size":"byteLength"]<=750)try{const e=await new Response(f).json();e.error&&(f=e)}catch{}}"image"===c&&f instanceof Blob&&(f=await L(URL.createObjectURL(f),e,!0))}}else f=await d.text()}else f=await L(t,e)}catch(n){if("AbortError"===n.name){if(b)throw new Error("Timeout exceeded");throw(0,a.zE)("Request canceled")}if(!(!d&&n instanceof TypeError&&m.proxyUrl)||r.body||"delete"===r.method||"head"===r.method||"post"===r.method||"put"===r.method||e.useProxy||k(t))throw n;e.redoRequest=!0,(0,l.tD)({proxyUrl:m.proxyUrl,urlPrefix:(0,l.P$)(t)})}finally{y&&clearTimeout(y)}return[d,f]}function T(e,t){let r;try{r=(new DOMParser).parseFromString(e,t)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function C(e,t,r){if(e.redoRequest)return e.redoRequest=!1,!1;const n=e.params.requestOptions;if(!t||"native"===n.responseType||"native-request-init"===n.responseType)return!0;let o,i,a,l;if(!t.ok)throw o=new Error(`Unable to load ${t.url} status: ${t.status}`),o[v]=r,o;null!=r&&r.error&&(o=r.error),o&&(i=Number(o.code),a=o.hasOwnProperty("subcode")?Number(o.subcode):null,l=o.messageCode,l=l&&l.toUpperCase());const c=n.authMode;if(403===i&&(4===a||o.message&&o.message.toLowerCase().indexOf("ssl")>-1&&-1===o.message.toLowerCase().indexOf("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&("no-prompt"!==c||498===i)&&-1!==y.indexOf(i)&&!E(e.params.url)&&(403!==i||-1===b.indexOf(l)&&(null==a||2===a&&e.credentialToken))){await P();try{const t=await s.id.getCredential(e.params.url,{error:O("request:server",o,e.params),prompt:"no-prompt"!==c,signal:e.controller.signal,token:e.credentialToken});return e.credential=t,e.credentialToken=t.token,e.useSSL=e.useSSL||t.ssl,!1}catch(t){if("no-prompt"===c)return e.credential=null,e.credentialToken=null,!1;o=t}}if(o)throw o;return!0}function L(e,t,r=!1){const n=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.src=e,h(s,e,r,n)}p._abortableFetch=null,p._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const q=Object.freeze({__proto__:null,default:p})}}]);