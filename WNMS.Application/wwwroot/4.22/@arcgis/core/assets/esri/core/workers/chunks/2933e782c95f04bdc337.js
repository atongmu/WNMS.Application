"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[3018],{3018:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var r=s(60991),a=s(92143),n=s(76506),i=s(50406),u=s(60947),o=s(40267),h=s(56761),y=s(24251),p=s(50815),l=s(90995),c=s(77358),_=s(1856),g=s(1709);s(71552),s(31450),s(40642),s(74673),s(21972),s(23639),s(34250),s(91306),s(86656),s(22723),s(91055),s(17533),s(6906),s(2906),s(32422),s(21801),s(73796),s(97714),s(91597),s(86787),s(35132),s(89623),s(84069),s(44567),s(98380),s(92896),s(85674),s(76996),s(53326),s(92482),s(82426),s(29794),s(88994),s(98576),s(44722),s(71331),s(1623),s(53785),s(57251),s(95587),s(65775),s(12381),s(73173),s(82058),s(88762),s(32101),s(92624),s(92847),s(77314),s(91700),s(95533),s(94751),s(74569),s(22781),s(30831),s(72274),s(5777),s(89219),s(71435),s(22572),s(66774),s(63683),s(94479),s(48027),s(54174),s(59465),s(45702),s(51127),s(30776),s(7176),s(14249),s(60217),s(85056),s(82933),s(15324),s(39597),s(617),s(55585),s(97546),s(9801),s(53523),s(42911),s(46826),s(45433),s(54732);class d{constructor(){this._queryEngine=null,this._customParameters=null,this._snapshotFeatures=async e=>{const{objectIdField:t}=this._queryEngine,s=await(0,_.Bm)(this._getFeatureUrl,this._featureType.typeName,this._getFeatureOutputFormat,{customParameters:this._customParameters,dateFields:this._queryEngine.fieldsIndex.dateFields.map((e=>e.name)),signal:e});await(0,l.v)(s),(0,i.k_)(e);const r=(0,l.c)(s,{geometryType:this._queryEngine.geometryType,hasZ:!1,objectIdField:t});if(!(0,u.e)(this._queryEngine.spatialReference,u.W))for(const e of r)(0,n.i)(e.geometry)&&(e.geometry=(0,o.b)((0,y.p)((0,o.a)(e.geometry,this._queryEngine.geometryType,!1,!1),u.W,this._queryEngine.spatialReference)));let a=1;for(const e of r){const s={};(0,c.m)(this._fieldsIndex,s,e.attributes,!0),e.attributes=s,null==e.attributes[t]&&(e.objectId=e.attributes[t]=a++)}return r}}destroy(){var e;null==(e=this._queryEngine)||e.destroy(),this._queryEngine=null}async load(e,t){const{getFeatureUrl:s,getFeatureOutputFormat:r,spatialReference:a,fields:u,geometryType:o,featureType:y,objectIdField:l,customParameters:c}=e;this._featureType=y,this._customParameters=c,this._getFeatureUrl=s,this._getFeatureOutputFormat=r,this._fieldsIndex=new g.Z(u),await this._checkProjection(a),(0,i.k_)(t),this._queryEngine=new p.Q({fields:u,geometryType:o,hasM:!1,hasZ:!1,objectIdField:l,spatialReference:a,timeInfo:null,featureStore:new h.F({geometryType:o,hasM:!1,hasZ:!1})});const _=await this._snapshotFeatures((0,n.u)(t.signal));return this._queryEngine.featureStore.addMany(_),{extent:this._queryEngine.fullExtent}}async applyEdits(){throw new r.Z("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(e){var t;return this._customParameters=e,null==(t=this._snapshotTask)||t.abort(),this._snapshotTask=(0,i.vr)(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(e=>{this._queryEngine.featureStore.clear(),(0,i.D_)(e)||a.L.getLogger("esri.layers.WFSLayer").error(new r.Z("wfs-layer:getfeature-error","An error occurred during the GetFeature request",{error:e}))})),await this._waitSnapshotComplete(),{extent:this._queryEngine.fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _checkProjection(e){try{await(0,y.c)(u.W,e)}catch{throw new r.Z("unsupported-projection","Projection not supported",{spatialReference:e})}}}}}]);