"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[1348],{21348:(e,t,r)=>{r.r(t),r.d(t,{default:()=>T});var s=r(29768),n=(r(74569),r(23761)),o=r(82058),a=r(93314),i=r(60991),u=r(76506),l=r(57251),c=r(22739),d=r(71552),h=r(50406),p=r(32101),y=r(34250),f=(r(91306),r(17533)),m=r(21801),g=r(32422),b=r(4571),F=r(47628),I=r(91171),R=r(15528),w=r(60947);r(73796),r(74673),r(21972),r(23639),r(92143),r(31450),r(40642),r(86656),r(22723),r(91055),r(6906),r(97714),r(2906),r(84069),r(91597),r(86787),r(35132),r(89623),r(44567),r(98380),r(92896),r(22781),r(86748),r(15324),r(76996),r(14249),r(60217),r(29107),r(30574),r(2157),r(25977),r(58076),r(98242),r(7471),r(54414),r(59465),r(1648),r(8925),r(33921),r(3482),r(45154),r(16769),r(55531),r(30582),r(593),r(85699),r(96055),r(47776),r(18033),r(6331),r(62048),r(4292),r(75626),r(72652),r(29641),r(30493),r(70821),r(82673),r(34229),r(37029),r(96467),r(63571),r(30776),r(48027),r(54174),r(82426),r(29794),r(63130),r(25696),r(66396),r(42775),r(95834),r(34394),r(57150),r(76726),r(20444),r(76393),r(78548),r(2497),r(49906),r(46527),r(11799),r(48649),r(98402),r(9960),r(30823),r(53326),r(92482),r(5853),r(39141),r(38742),r(48243),r(34635),r(10401),r(49900),r(88762),r(67477),r(78533),r(74653),r(91091),r(58943),r(20543),r(70737),r(8487),r(17817),r(90814),r(15459),r(61847),r(16796),r(16955),r(22401),r(77894),r(55187),r(8586),r(44509),r(69814),r(11305),r(62259),r(44790),r(5909),r(60669),r(48208),r(51589),r(35197),r(89219),r(6941),r(95873),r(82933),r(39597),r(617),r(65514),r(46987),r(37453),r(73173),r(66284),r(87239),r(53785),r(95587),r(55823),r(92847),r(87258),r(97546),r(9801),r(53523),r(42911),r(46826),r(45433),r(54732),r(59877),r(69997),r(53426),r(49214),r(95533),r(94751),r(21132),r(76733),r(11385),r(85674),r(34446),r(31292),r(69218),r(27207),r(48190),r(40267),r(46646),r(39210),r(90549),r(2845),r(658);const q=new l.J({originalAndCurrentFeatures:"original-and-current-features",none:"none"}),O=new Set(["Feature Layer","Table"]);let _=class extends c.L{constructor(){super(...arguments),this.type="feature-layer",this.refresh=(0,h.Ds)((async()=>{var e,t;await this.load();const r=null==(e=this.sourceJSON.editingInfo)?void 0:e.lastEditDate;if(null==r)return{dataChanged:!0,updates:{}};try{await this._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const s=r!==(null==(t=this.sourceJSON.editingInfo)?void 0:t.lastEditDate);return{dataChanged:s,updates:s?{editingInfo:this.sourceJSON.editingInfo,extent:this.sourceJSON.extent}:null}}))}load(e){const t=(0,u.i)(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON,t)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:t,dynamicDataSource:r,infoFor3D:s,gdbVersion:n,spatialReference:o,fieldsIndex:a}=this.layer,i=(0,u.h)("featurelayer-pbf")&&e&&(0,u.b)(s)?"pbf":"json";return new R.Z({url:t.path,format:i,fieldsIndex:a,infoFor3D:s,dynamicDataSource:r,gdbVersion:n,sourceSpatialReference:o})}async addAttachment(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+"/"+r+"/addAttachment",n=this._getLayerRequestOptions(),a=this._getFormDataForAttachment(t,n.query);try{const e=await(0,o.default)(s,{body:a});return this._createFeatureEditResult(e.data.addAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(r,e)}}async updateAttachment(e,t,r){await this.load();const s=e.attributes[this.layer.objectIdField],n=this.layer.parsedUrl.path+"/"+s+"/updateAttachment",a=this._getLayerRequestOptions({query:{attachmentId:t}}),i=this._getFormDataForAttachment(r,a.query);try{const e=await(0,o.default)(n,{body:i});return this._createFeatureEditResult(e.data.updateAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(s,e)}}async applyEdits(e,t){await this.load();const r=e.addFeatures.map(this._serializeFeature,this),s=e.updateFeatures.map(this._serializeFeature,this),n=this._getFeatureIds(e.deleteFeatures,null==t?void 0:t.globalIdUsed);(0,F.u)(r,s,this.layer.spatialReference);const a=[],i=[],u=[...e.deleteAttachments];for(const t of e.addAttachments)a.push(await this._serializeAttachment(t));for(const t of e.updateAttachments)i.push(await this._serializeAttachment(t));const l=a.length||i.length||u.length?{adds:a,updates:i,deletes:u}:null,c={gdbVersion:(null==t?void 0:t.gdbVersion)||this.layer.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,returnEditMoment:null==t?void 0:t.returnEditMoment,usePreviousEditMoment:null==t?void 0:t.usePreviousEditMoment,sessionId:null==t?void 0:t.sessionId};null!=t&&t.returnServiceEditsOption?(c.edits=JSON.stringify([{id:this.layer.layerId,adds:r,updates:s,deletes:n,attachments:l}]),c.returnServiceEditsOption=q.toJSON(null==t?void 0:t.returnServiceEditsOption),c.returnServiceEditsInSourceSR=null==t?void 0:t.returnServiceEditsInSourceSR):(c.adds=r.length?JSON.stringify(r):null,c.updates=s.length?JSON.stringify(s):null,c.deletes=n.length?null!=t&&t.globalIdUsed?JSON.stringify(n):n.join(","):null,c.attachments=l&&JSON.stringify(l));const d=this._getLayerRequestOptions({method:"post",query:c}),h=null!=t&&t.returnServiceEditsOption?this.layer.url:this.layer.parsedUrl.path,p=await(0,o.default)(h+"/applyEdits",d);return this._createEditsResult(p)}async deleteAttachments(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+"/"+r+"/deleteAttachments";try{return(await(0,o.default)(s,this._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(this._createFeatureEditResult)}catch(e){throw this._createAttachmentErrorResult(r,e)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then((async()=>{const t=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:r,url:s}=this.layer,{data:n}=await(0,o.default)(`${s}/${r}`,t),{id:i,extent:u,fullExtent:l,timeExtent:c}=n,d=u||l;return{id:i,fullExtent:d&&m.Z.fromJSON(d),timeExtent:c&&a.Z.fromJSON({start:c[0],end:c[1]})}}))}async queryAttachments(e,t={}){const{parsedUrl:r}=this.layer,s=r.path;await this.load();const n=this._getLayerRequestOptions(t);if(!this.layer.get("capabilities.operations.supportsQueryAttachments")){const{objectIds:t}=e,r=[];for(const e of t){const t=s+"/"+e+"/attachments";r.push((0,o.default)(t,n))}return Promise.all(r).then((e=>t.map(((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))))).then((e=>(0,I.p)(e,s)))}return this.queryTask.executeAttachmentQuery(e,n)}async queryFeatures(e,t){return await this.load(),this.queryTask.execute(e,{...t,query:this._createRequestQueryOptions(t)})}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:this._createRequestQueryOptions(t)})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopFeatures(e,t){return await this.load(),this.queryTask.executeTopFeaturesQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopObjectIds(e,t){return await this.load(),this.queryTask.executeForTopIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopExtents(e,t){return await this.load(),this.queryTask.executeForTopExtents(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopCount(e,t){return await this.load(),this.queryTask.executeForTopCount(e,{...t,query:this._createRequestQueryOptions(t)})}_createRequestQueryOptions(e){const t={...this.layer.customParameters,token:this.layer.apiKey,...null==e?void 0:e.query};return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}async _fetchService(e,t){if(!e){const{data:r}=await(0,o.default)(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:(0,u.h)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:t}));e=r}this.sourceJSON=this._patchServiceJSON(e);const r=e.type;if(!O.has(r))throw new i.Z("feature-layer-source:unsupported-type",`Source type "${r}" is not supported`)}_patchServiceJSON(e){var t;if("Table"!==e.type&&e.geometryType&&(null==e||null==(t=e.drawingInfo)||!t.renderer)&&!e.defaultSymbol){const t=(0,b.a)(e.geometryType).renderer;(0,d.s)("drawingInfo.renderer",t,e)}return"esriGeometryMultiPatch"===e.geometryType&&e.infoFor3D&&(e.geometryType="mesh"),e}_serializeFeature(e){const{geometry:t,attributes:r}=e;return(0,u.b)(t)?{attributes:r}:"mesh"===t.type||"extent"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:s,name:n,contentType:o,data:a,uploadId:i}=r,u={globalId:s,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(u.parentGlobalId="attributes"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),i)u.uploadId=i;else if(a){const e=await async function(e){return"string"==typeof e?(0,p.sJ)(e)||{data:e}:new Promise(((t,r)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>t((0,p.sJ)(s.result)),s.onerror=e=>r(e)}))}(a);u.contentType=e.mediaType,u.data=e.data,a instanceof File&&(u.name=a.name)}return n&&(u.name=n),o&&(u.contentType=o),u}_getFeatureIds(e,t){const r=e[0];return r?this._canUseGlobalIds(t,e)?this._getGlobalIdsFromFeatureIdentifier(e):"objectId"in r?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map((e=>e.attributes&&e.attributes[t]))}_canUseGlobalIds(e,t){return e&&"globalId"in t[0]}_getObjectIdsFromFeatureIdentifier(e){return e.map((e=>e.objectId))}_getGlobalIdsFromFeatureIdentifier(e){return e.map((e=>e.globalId))}_createEditsResult(e){var t;const r=e.data,{layerId:s}=this.layer,n=[];let o=null;if(Array.isArray(r))for(const e of r)n.push({id:e.id,editedFeatures:e.editedFeatures}),e.id===s&&(o={addResults:e.addResults,updateResults:e.updateResults,deleteResults:e.deleteResults,attachments:e.attachments,editMoment:e.editMoment});else o=r;const a=null==(t=o)?void 0:t.attachments,i={addFeatureResults:o.addResults?o.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:o.updateResults?o.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:o.deleteResults?o.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:a&&a.addResults?a.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:a&&a.updateResults?a.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:a&&a.deleteResults?a.deleteResults.map(this._createFeatureEditResult,this):[]};if(o.editMoment&&(i.editMoment=o.editMoment),n.length>0){i.editedFeatureResults=[];for(const e of n){const{adds:t,updates:r,deletes:s,spatialReference:n}=e.editedFeatures,o=n?new w.Z(n):null;i.editedFeatureResults.push({layerId:e.id,editedFeatures:{adds:(null==t?void 0:t.map((e=>this._createEditedFeature(e,o))))||[],updates:(null==r?void 0:r.map((e=>({original:this._createEditedFeature(e[0],o),current:this._createEditedFeature(e[1],o)}))))||[],deletes:(null==s?void 0:s.map((e=>this._createEditedFeature(e,o))))||[],spatialReference:o}})}}return i}_createEditedFeature(e,t){return new n.Z({attributes:e.attributes,geometry:(0,g.im)({...e.geometry,spatialReference:t})})}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new i.Z("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,s=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new i.Z("feature-layer-source:attachment-failure",r,{code:s})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const e in t){const s=t[e];null!=s&&(r.set?r.set(e,s):r.append(e,s))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:r,dynamicDataSource:s}=this.layer;return{...e,query:{gdbVersion:r,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:"json",...this._createRequestQueryOptions(e)},responseType:"json"}}};(0,s._)([(0,y.Cb)()],_.prototype,"type",void 0),(0,s._)([(0,y.Cb)({constructOnly:!0})],_.prototype,"layer",void 0),(0,s._)([(0,y.Cb)({readOnly:!0})],_.prototype,"queryTask",null),_=(0,s._)([(0,f.j)("esri.layers.graphics.sources.FeatureLayerSource")],_);const T=_},85674:(e,t,r)=>{r.d(t,{O:()=>n,a:()=>o,b:()=>i,h:()=>a});var s=r(76506);class n{constructor(e=[],t=[],r=!1){this.lengths=null!=e?e:[],this.coords=null!=t?t:[],this.hasIndeterminateRingOrder=r}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let r=0;r<s;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=s}}clone(e){return e?(e.set(this.coords),new n(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new n(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class o{constructor(e=null,t={},r,s){this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new o(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}}function a(e){return!((0,s.b)(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class i extends o{}},9006:(e,t,r)=>{r.d(t,{O:()=>s});class s{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new s;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},89219:(e,t,r)=>{r.d(t,{q:()=>s});const s={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},4571:(e,t,r)=>{r.d(t,{a:()=>a,b:()=>i,c:()=>l,d:()=>u});var s=r(76506),n=r(89219),o=r(6941);function a(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?o.d:"esriGeometryPolyline"===e?o.a:o.b}}}function i(e,t){if((0,s.h)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this.${t} = null;`;for(const t in e)r+=`this${t.includes(".")?`["${t}"]`:`.${t}`} = ${JSON.stringify(e[t])};`;const s=new Function(r);return()=>new s}catch(r){return()=>({[t]:null,...e})}}function u(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,s.d9)(e)}}]}function l(e,t){return{attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0},query:n.q,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}},40267:(e,t,r)=>{r.d(t,{a:()=>L,b:()=>J,c:()=>z,e:()=>j,f:()=>R,g:()=>K,h:()=>H,i:()=>G,j:()=>k,k:()=>N,l:()=>$,m:()=>V,n:()=>U,o:()=>Q,p:()=>C,q:()=>Y,r:()=>te,s:()=>B,t:()=>g,u:()=>ee,v:()=>b,w:()=>se,z:()=>ne});var s=r(60991),n=r(92143),o=r(76506),a=r(32422),i=r(85674),u=r(9006);function l(e,t){return e?t?4:3:t?3:2}const c=n.L.getLogger("esri.tasks.support.optimizedFeatureSet"),d={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},h=(e,t,r,s,n,o)=>{e[r]=n,e[r+1]=o},p=(e,t,r,s,n,o)=>{e[r]=n,e[r+1]=o,e[r+2]=t[s+2]},y=(e,t,r,s,n,o)=>{e[r]=n,e[r+1]=o,e[r+2]=t[s+3]},f=(e,t,r,s,n,o)=>{e[r]=n,e[r+1]=o,e[r+2]=t[s+2],e[r+3]=t[s+3]};function m(e,t,r,s){if(e){if(r)return t&&s?f:p;if(t&&s)return y}else if(t&&s)return p;return h}function g({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function b({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function F({scale:e,translate:t},r){return r*e[0]+t[0]}function I({scale:e,translate:t},r){return t[1]-r*e[1]}function R(e,t,r){return e?t?r?v(e):O(e):r?T(e):w(e):null}function w(e){const t=e.coords;return{x:t[0],y:t[1]}}function q(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function O(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function _(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function T(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function S(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function v(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function E(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function x(e,t){return e&&t?E:e?_:t?S:q}function N(e,t,r){if((0,o.b)(e))return null;const s=l(t,r),n=[];for(let t=0;t<e.coords.length;t+=s){const r=[];for(let n=0;n<s;n++)r.push(e.coords[t+n]);n.push(r)}return t?r?{points:n,hasZ:t,hasM:r}:{points:n,hasZ:t}:r?{points:n,hasM:r}:{points:n}}function M(e,t,r=l(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const s=e.coords;let n=0;for(const e of t.points)for(let t=0;t<r;t++)s[n++]=e[t];return e}function G(e,t,r){if(!e)return null;const s=l(t,r),{coords:n,lengths:o}=e,a=[];let i=0;for(const e of o){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<s;t++)e.push(n[i++]);t.push(e)}a.push(t)}return t?r?{paths:a,hasZ:t,hasM:r}:{paths:a,hasZ:t}:r?{paths:a,hasM:r}:{paths:a}}function A(e,t,r=l(t.hasZ,t.hasM)){const{lengths:s,coords:n}=e;let o=0;for(const e of t.paths){for(const t of e)for(let e=0;e<r;e++)n[o++]=t[e];s.push(e.length)}return e}function k(e,t,r){if(!e)return null;const s=l(t,r),{coords:n,lengths:o}=e,a=[];let i=0;for(const e of o){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<s;t++)e.push(n[i++]);t.push(e)}a.push(t)}return t?r?{rings:a,hasZ:t,hasM:r}:{rings:a,hasZ:t}:r?{rings:a,hasM:r}:{rings:a}}function j(e,t,r=t.hasZ,s=t.hasM){return function(e,t,r,s){const n=l(r,s),{lengths:o,coords:a}=e;let i=0;o.length=a.length=0;for(const e of t){for(const t of e)for(let e=0;e<n;e++)a[i++]=t[e];o.push(e.length)}}(e,t.rings,r,s),e}const P=[],Z=[];function C(e,t,r,s,n){P[0]=e;const[o]=U(Z,P,t,r,s,n);return P.length=Z.length=0,o}function U(e,t,r,n,a,u){if(e.length=0,!r){for(const r of t){const t=r.attributes[u];e.push(new i.a(null,r.attributes,null,t))}return e}switch(r){case"esriGeometryPoint":return function(e,t,r,s,n){const o=x(r,s);for(const r of t){const{geometry:t,attributes:s}=r;let a;t&&(a=o(new i.O,t)),e.push(new i.a(a,s,null,s[n]))}return e}(e,t,n,a,u);case"esriGeometryMultipoint":return function(e,t,r,s,n){const o=l(r,s);for(const r of t){const t=r.geometry,s=r.attributes;let a;t&&(a=M(new i.O,t,o)),e.push(new i.a(a,s,null,s[n]))}return e}(e,t,n,a,u);case"esriGeometryPolyline":return function(e,t,r,s,n){const o=l(r,s);for(const r of t){const t=r.geometry,s=r.attributes;let a;t&&(a=A(new i.O,t,o)),e.push(new i.a(a,s,null,s[n]))}return e}(e,t,n,a,u);case"esriGeometryPolygon":return function(e,t,r,s,n){for(const a of t){const t=a.geometry,u=a.centroid,l=a.attributes;let c;t&&(c=j(new i.O,t,r,s)),(0,o.i)(u)?e.push(new i.a(c,l,q(new i.O,u),l[n])):e.push(new i.a(c,l,null,l[n]))}return e}(e,t,n,a,u);default:c.error("convertToFeatureSet:unknown-geometry",new s.Z(`Unable to parse unknown geometry type '${r}'`)),e.length=0}return e}function Q(e,t,r,s){Z[0]=e,D(P,Z,t,r,s);const n=P[0];return P.length=Z.length=0,n}function J(e,t,r){if((0,o.b)(e))return null;const n=new i.O;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),(0,a.wp)(e)?x(null!=t?t:null!=e.z,null!=r?r:null!=e.m)(n,e):(0,a.oU)(e)?j(n,e,t,r):(0,a.l9)(e)?A(n,e,l(t,r)):(0,a.aW)(e)?M(n,e,l(t,r)):void c.error("convertFromGeometry:unknown-geometry",new s.Z(`Unable to parse unknown geometry type '${e}'`))}function L(e,t,r,n){const a=e&&("coords"in e?e:e.geometry);if((0,o.b)(a))return null;switch(t){case"esriGeometryPoint":{let e=w;return r&&n?e=v:r?e=O:n&&(e=T),e(a)}case"esriGeometryMultipoint":return N(a,r,n);case"esriGeometryPolyline":return G(a,r,n);case"esriGeometryPolygon":return k(a,r,n);default:return void c.error("convertToGeometry:unknown-geometry",new s.Z(`Unable to parse unknown geometry type '${t}'`))}}function D(e,t,r,n,a){if(e.length=0,(0,o.b)(r))return function(e,t){for(const r of t)e.push({attributes:r.attributes});return e}(e,t);switch(r){case"esriGeometryPoint":return function(e,t,r,s){let n=w;r&&s?n=v:r?n=O:s&&(n=T);for(const r of t){const{geometry:t,attributes:s}=r,a=(0,o.i)(t)?n(t):null;e.push({attributes:s,geometry:a})}return e}(e,t,n,a);case"esriGeometryMultipoint":return function(e,t,r,s){for(const n of t){const{geometry:t,attributes:o}=n;let a;t&&(a=N(t,r,s)),e.push({attributes:o,geometry:a})}return e}(e,t,n,a);case"esriGeometryPolyline":return function(e,t,r,s){for(const n of t){const{geometry:t,attributes:a}=n;let i;(0,o.i)(t)&&(i=G(t,r,s)),e.push({attributes:a,geometry:i})}return e}(e,t,n,a);case"esriGeometryPolygon":return function(e,t,r,s){for(const n of t){const{geometry:t,attributes:a,centroid:i}=n;let u;if((0,o.i)(t)&&(u=k(t,r,s)),i){const t=w(i);e.push({attributes:a,centroid:t,geometry:u})}else e.push({attributes:a,geometry:u})}return e}(e,t,n,a);default:c.error("convertToFeatureSet:unknown-geometry",new s.Z(`Unable to parse unknown geometry type '${r}'`))}return e}function z(e){const{objectIdFieldName:t,spatialReference:r,transform:s,fields:n,hasM:o,hasZ:a,features:i,geometryType:u,exceededTransferLimit:l,uniqueIdField:c,queryGeometry:d,queryGeometryType:h}=e,p={features:D([],i,u,a,o),fields:n,geometryType:u,objectIdFieldName:t,spatialReference:r,uniqueIdField:c,queryGeometry:L(d,h,!1,!1)};return s&&(p.transform=s),l&&(p.exceededTransferLimit=l),o&&(p.hasM=o),a&&(p.hasZ=a),p}function V(e,t){const r=new u.O,{hasM:n,hasZ:o,features:a,objectIdFieldName:i,spatialReference:l,geometryType:d,exceededTransferLimit:h,transform:p,fields:y}=e;return y&&(r.fields=y),r.geometryType=d,r.objectIdFieldName=i||t,r.spatialReference=l,r.objectIdFieldName?(a&&U(r.features,a,d,o,n,r.objectIdFieldName),h&&(r.exceededTransferLimit=h),n&&(r.hasM=n),o&&(r.hasZ=o),p&&(r.transform=p),r):(c.error(new s.Z("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function $(e){const{transform:t,features:r,hasM:s,hasZ:n}=e;if(!t)return e;for(const e of r)(0,o.i)(e.geometry)&&ee(e.geometry,e.geometry,s,n,t),e.centroid&&ee(e.centroid,e.centroid,s,n,t);return e.transform=null,e}function B(e,t){const{geometryType:r,features:s,hasM:n,hasZ:o}=t;if(!e)return t;for(let t=0;t<s.length;t++){const a=s[t],u=a.weakClone();u.geometry=new i.O,Y(u.geometry,a.geometry,n,o,r,e),a.centroid&&(u.centroid=new i.O,Y(u.centroid,a.centroid,n,o,"esriGeometryPoint",e)),s[t]=u}return t.transform=e,t}function Y(e,t,r,s,n,a,i=r,u=s){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),(0,o.b)(t)||!t.coords.length)return null;const c=d[n],{coords:h,lengths:p}=t,y=l(r,s),f=l(r&&i,s&&u),F=m(r,s,i,u);if(!p.length)return F(e.coords,h,0,0,g(a,h[0]),b(a,h[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=y,e;let I,R,w,q,O=0,_=0,T=_;for(const t of p){if(t<c)continue;let r=0;_=T,w=I=g(a,h[O]),q=R=b(a,h[O+1]),F(e.coords,h,_,O,w,q),r++,O+=y,_+=f;for(let s=1;s<t;s++,O+=y)w=g(a,h[O]),q=b(a,h[O+1]),w===I&&q===R||(F(e.coords,h,_,O,w-I,q-R),_+=f,r++,I=w,R=q);r>=c&&(e.lengths.push(r),T=_)}return e.coords.length=T,e.coords.length?e:null}function H(e,t,r,s,n,o,a=r,i=s){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const u=d[n],{coords:c,lengths:h}=t,p=l(r,s),y=l(r&&a,s&&i),f=m(r,s,a,i);if(!h.length)return f(e.coords,c,0,0,c[0],c[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let g=0;const b=o*o;for(const t of h){if(t<u){g+=t*p;continue}const r=e.coords.length/y,s=g,n=g+(t-1)*p;f(e.coords,c,e.coords.length,s,c[s],c[s+1]),X(e.coords,c,p,b,f,s,n),f(e.coords,c,e.coords.length,n,c[n],c[n+1]);const o=e.coords.length/y-r;o>=u?e.lengths.push(o):e.coords.length=r*y,g+=t*p}return e.coords.length?e:null}function W(e,t,r,s){const n=e[t],o=e[t+1],a=e[r],i=e[r+1],u=e[s],l=e[s+1];let c=a,d=i,h=u-c,p=l-d;if(0!==h||0!==p){const e=((n-c)*h+(o-d)*p)/(h*h+p*p);e>1?(c=u,d=l):e>0&&(c+=h*e,d+=p*e)}return h=n-c,p=o-d,h*h+p*p}function X(e,t,r,s,n,o,a){let i,u=s,l=0;for(let e=o+r;e<a;e+=r)i=W(t,e,o,a),i>u&&(l=e,u=i);u>s&&(l-o>r&&X(e,t,r,s,n,o,l),n(e,t,e.length,l,t[l],t[l+1]),a-l>r&&X(e,t,r,s,n,l,a))}function K(e,t,r,s){if((0,o.b)(t)||!t.coords||!t.coords.length)return null;const n=l(r,s);let a=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=n){const r=e[t],s=e[t+1];a=Math.min(a,r),u=Math.max(u,r),i=Math.min(i,s),c=Math.max(c,s)}}return e[0]=a,e[1]=i,e[2]=u,e[3]=c,e}function ee(e,t,r,s,n){const{coords:o,lengths:a}=t,i=r?s?f:p:s?p:h,u=l(r,s);if(!o.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!a.length)return i(e.coords,o,0,0,F(n,o[0]),I(n,o[1])),e!==t&&(e.lengths.length=0,e.coords.length=u),e;const[c,d]=n.scale;let y=0;for(let t=0;t<a.length;t++){const r=a[t];e.lengths[t]=r;let s=F(n,o[y]),l=I(n,o[y+1]);i(e.coords,o,y,y,s,l),y+=u;for(let t=1;t<r;t++,y+=u)s+=o[y]*c,l-=o[y+1]*d,i(e.coords,o,y,y,s,l)}return e!==t&&(e.lengths.length=a.length,e.coords.length=o.length),e}function te(e,t,r,s,n,o){const a=l(r,s),i=m(r,s,n,o),u=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let t=0;t<u.length;t+=a)i(e.coords,u,e.coords.length,t,u[t],u[t+1]);return e}function re(e,t,r,s){let n=0,o=e[s*t],a=e[s*(t+1)];for(let i=1;i<r;i++){const r=o+e[s*(t+i)],u=a+e[s*(t+i)+1],l=(r-o)*(u+a);o=r,a=u,n+=l}return.5*n}function se(e,t){const{coords:r,lengths:s}=e;let n=0,o=0;for(let e=0;e<s.length;e++)o+=re(r,n,s[e],t),n+=e;return Math.abs(o)}function ne(e,t){if((0,o.b)(e))return null;const r=e.clone(),s=e.coords,n=e.lengths;let a=0;for(let e=0;e<n.length;e++){const o=n[e];let i=s[t*a],u=s[t*a+1];for(let e=1;e<o;e++){const n=i+s[t*(a+e)],o=u+s[t*(a+e)+1];r.coords[t*(a+e)]=n,r.coords[t*(a+e)+1]=o,i=n,u=o}a+=o}return r}}}]);