/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import e from"../core/Error.js";import{L as t}from"./Logger.js";import"./mathUtils.js";import"./number2.js";import{a as r,V as n}from"./enums.js";import{O as s}from"./ArrayPool.js";import"./Texture.js";class i{constructor(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}acquire(e,t,r,n,s,i,a,o,c){this.color=e,this.haloColor=t,this.haloSize=r,this.size=n,this.angle=s,this.offsetX=i,this.offsetY=a,this.hAnchor=o,this.vAnchor=c}release(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}}i.pool=new s(i);const a=t.getLogger("esri.views.2d.engine.webgl.Utils"),o=[{name:"geometry",strideInBytes:32,divisor:0}],c=[{name:"geometry",strideInBytes:20,divisor:0}],u=[{name:"geometry",strideInBytes:12,divisor:0}],l=[{name:"geometry",strideInBytes:40,divisor:0}],h=[{name:"geometry",strideInBytes:36,divisor:0}],f=[{name:"geometry",strideInBytes:36,divisor:0}];function m(e){const t={};for(const r of e)t[r.name]=r.strideInBytes;return t}const d=m([{name:"geometry",strideInBytes:36,divisor:0}]),y=m(o),g=m(c),p=m(u),w=m(l),v=m(h),S=m(f);function L(e,{fill:t}){switch(e){case r.MARKER:return d;case r.FILL:return"dot-density"===t?p:"simple"===t?g:y;case r.LINE:return w;case r.TEXT:return v;case r.LABEL:return S}}const A=["geometry"],I=["geometry"],C=["geometry"],T=["geometry"],z=["geometry"];function M(e){switch(e){case r.MARKER:return A;case r.FILL:return I;case r.LINE:return C;case r.TEXT:return T;case r.LABEL:return z}}function b(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function E(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}}function x(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function B(e){return null!=e}function D(e){return"number"==typeof e}function F(t){switch(t){case"butt":return 0;case"round":return 1;case"square":return 2;default:return a.error(new e("mapview-invalid-type",`Cap type ${t} is not a valid option. Defaulting to round`)),1}}function U(t){switch(t){case"miter":return 2;case"bevel":return 0;case"round":return 1;default:return a.error(new e("mapview-invalid-type",`Join type ${t} is not a valid option. Defaulting to round`)),1}}function j(e){switch(e){case"opacity":return n.OPACITY;case"color":return n.COLOR;case"rotation":return n.ROTATION;case"size":return n.SIZE;default:return a.error(`Cannot interpret unknown vv: ${e}`),null}}function R(e,t,r,n,s,i,a){for(const t in i){const n=i[t].stride,a=b(n),o=i[t].data,c=r[t].data,u=n*s.vertexCount/a,l=n*e/a,h=n*s.vertexFrom/a;for(let e=0;e<u;++e)c[e+l]=o[e+h]}const o=s.indexCount;for(let r=0;r<o;++r)n[r+t]=a[r+s.indexFrom]-s.vertexFrom+e}const $={geometry:35044};function O(e,t){const r=[];for(let n=0;n<5;++n){const s=M(n),i={};for(const e of s)i[e]={data:t(n,e)};r.push({data:e(n),buffers:i})}return r}function k(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function N(t){switch(t){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:return void a.error(new e("webgl-utils",`Unable to handle type ${t}`))}}function V(t){switch(t){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:return void a.error(new e("webgl-utils",`Unable to handle type ${t}`))}}const X=new Map,q=(e,t)=>{if(!X.has(e)){const r=function(e){const t={};for(const r in e){const n=e[r];let s=0;t[r]=n.map((e=>{const t={...e,normalized:e.normalized||!1,divisor:e.divisor||0,offset:s,stride:0};return s+=e.count*k(e.type),t})),t[r].forEach((e=>e.stride=s))}return t}(t),n=(e=>{const t={};for(const r in e){const n=e[r];t[r]=n.length?n[0].stride:0}return t})(r),s=(e=>{const t=new Map;for(const r in e)for(const n of e[r])t.set(n.name,n.location);return t})(t),i={strides:n,bufferLayouts:r,attributes:s};X.set(e,i)}return X.get(e)};function P(e){e(r.FILL),e(r.LINE),e(r.MARKER),e(r.TEXT),e(r.LABEL)}const Y=e=>"path"in e&&re(e.path),K=e=>"url"in e&&e.url||"imageData"in e&&e.imageData,J=e=>"imageData"in e&&e.imageData&&"contentType"in e&&e.contentType?`data:${e.contentType};base64,${e.imageData}`:"url"in e?e.url:null,Z=e=>"url"in e&&e.url&&e.url.includes(".gif")||"contentType"in e&&"image/gif"===e.contentType||"imageData"in e&&e.imageData.includes("data:image/gif"),G=e=>"url"in e&&e.url&&e.url.includes(".png")||"contentType"in e&&"image/png"===e.contentType||"imageData"in e&&e.imageData.includes("data:image/png"),H=e=>e.type&&-1!==e.type.toLowerCase().indexOf("3d");function Q(e){switch(e.type){case"line":{const t=e;return"CIMSolidStroke"===t.cim.type&&!t.dashTemplate}case"fill":return"CIMSolidFill"===e.cim.type;case"esriSFS":return"esriSFSSolid"===e.style||"esriSFSNull"===e.style;case"esriSLS":return"esriSLSSolid"===e.style||"esriSLSNull"===e.style;default:return!1}}const W=e=>e.includes("data:image/svg+xml");function _(e){switch("cim"in e?e.cim.type:e.type){case"esriSMS":case"esriPMS":case"CIMPointSymbol":case"CIMVectorMarker":case"CIMPictureMarker":case"CIMCharacterMarker":return!1;default:return!0}}function ee(e){const t="maxVVSize"in e&&e.maxVVSize,r="width"in e&&e.width||"size"in e&&e.size||0;return t||r}function te(e){const t=[];for(let r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t}const re=e=>!!e&&(e=e.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(e)&&/[\dz]$/i.test(e)&&e.length>4));export{$ as C,H as a,te as b,q as c,Q as d,Y as e,K as f,V as g,ee as h,D as i,Z as j,G as k,J as l,W as m,E as n,b as o,R as p,O as q,x as r,_ as s,L as t,P as u,F as v,U as w,j as x,N as y,B as z};
