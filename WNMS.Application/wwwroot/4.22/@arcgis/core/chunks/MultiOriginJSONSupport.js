/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{_ as t}from"./tslib.es6.js";import r,{b as e,c as s,n as i}from"../core/Accessor.js";import{clone as o,a as n}from"../core/lang.js";import{r as a,w as c}from"./JSONSupport.js";import{g as h}from"./metadata.js";import{subclass as u}from"../core/accessorSupport/decorators/subclass.js";class g{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(e),this._values=new Map}clone(t){const r=new g,s=this._originStores[0];s&&s.forEach(((t,e)=>{r.set(e,o(t),0)}));for(let s=2;s<e;s++){const e=this._originStores[s];e&&e.forEach(((e,i)=>{t&&t.has(i)||r.set(i,o(e),s)}))}return r}get(t,r){const e=void 0===r?this._values:this._originStores[r];return e?e.get(t):void 0}keys(t){const r=null==t?this._values:this._originStores[t];return r?[...r.keys()]:[]}set(t,r,e=6){let s=this._originStores[e];if(s||(s=new Map,this._originStores[e]=s),s.set(t,r),!this._values.has(t)||n(this._propertyOriginMap.get(t))<=e){const s=this._values.get(t);return this._values.set(t,r),this._propertyOriginMap.set(t,e),s!==r}return!1}delete(t,r=6){const e=this._originStores[r];if(!e)return;const s=e.get(t);if(e.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===r){this._values.delete(t);for(let e=r-1;e>=0;e--){const r=this._originStores[e];if(r&&r.has(t)){this._values.set(t,r.get(t)),this._propertyOriginMap.set(t,e);break}}}return s}has(t,r){const e=void 0===r?this._values:this._originStores[r];return!!e&&e.has(t)}revert(t,r){for(;r>0&&!this.has(t,r);)--r;const e=this._originStores[r],s=e&&e.get(t),i=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,r),i!==s}originOf(t){return this._propertyOriginMap.get(t)||0}forEach(t){this._values.forEach(t)}}const l=r=>{let e=class extends r{constructor(...t){super(...t);const r=n(h(this)),e=r.metadatas,s=r.store,i=new g;r.store=i,s.keys().forEach((t=>{i.set(t,s.get(t),0)})),Object.keys(e).forEach((t=>{r.internalGet(t)&&i.set(t,r.internalGet(t),0)}))}read(t,r){a(this,t,r)}getAtOrigin(t,r){const e=p(this),s=i(r);if("string"==typeof t)return e.get(t,s);const o={};return t.forEach((t=>{o[t]=e.get(t,s)})),o}originOf(t){return s(this.originIdOf(t))}originIdOf(t){return p(this).originOf(t)}revert(t,r){const e=p(this),s=i(r),o=h(this);let n;n="string"==typeof t?"*"===t?e.keys(s):[t]:t,n.forEach((t=>{o.invalidate(t),e.revert(t,s),o.commit(t)}))}};return e=t([u("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function p(t){return h(t).store}let f=class extends(l(r)){};f=t([u("esri.core.ReadOnlyMultiOriginJSONSupport")],f);const O=r=>{let s=class extends r{constructor(...t){super(...t)}clear(t,r="user"){return _(this).delete(t,i(r))}write(t={},r){return c(this,t=t||{},r),t}setAtOrigin(t,r,e){h(this).setAtOrigin(t,r,i(e))}removeOrigin(t){const r=_(this),e=i(t),s=r.keys(e);for(const t of s)r.originOf(t)===e&&r.set(t,r.get(t,e),6)}updateOrigin(t,r){const s=_(this),o=i(r),n=this.get(t);for(let r=o+1;r<e;++r)s.delete(t,r);s.set(t,n,o)}toJSON(t){return this.write({},t)}};return s=t([u("esri.core.WriteableMultiOriginJSONSupport")],s),s.prototype.toJSON.isDefaultToJSON=!0,s};function _(t){return h(t).store}const S=r=>{let e=class extends(O(l(r))){constructor(...t){super(...t)}};return e=t([u("esri.core.MultiOriginJSONSupport")],e),e};let d=class extends(S(r)){};d=t([u("esri.core.MultiOriginJSONSupport")],d);export{S as M,d as a};
