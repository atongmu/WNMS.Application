/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import"../renderers/ClassBreaksRenderer.js";import"../renderers/DictionaryRenderer.js";import"../renderers/DotDensityRenderer.js";import"../renderers/HeatmapRenderer.js";import"../renderers/Renderer.js";import e from"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../renderers/support/jsonUtils.js";import t from"../core/Error.js";import{u as r,i,h as n,b as s,o as l,clone as a}from"../core/lang.js";import{L as o}from"./Logger.js";import{a as u,t as c}from"./screenUtils.js";import{fromJSON as f}from"../symbols/support/jsonUtils.js";import{b as d,a as p}from"./enums.js";import{x as m}from"./Utils13.js";import{c as y,h as g}from"./MaterialKey.js";import{g as b}from"./visualVariablesUtils2.js";import{R as h,a as x}from"./CIMSymbolHelper.js";import{G as v,M as w,C as V}from"./definitions.js";import{b as S,s as z,g as E,a as I}from"./shapingUtils.js";import M from"../geometry/Polygon.js";import{a as F}from"./aaBoundingRect.js";import{a as O}from"./normalizeUtilsCommon.js";import{e as T}from"./cimSymbolUtils.js";import{c as R}from"./clusterUtils2.js";import{t as j}from"./util.js";const N=512,k=50;function C(e,t){if(!t.isWrappable)return null;const[r,i]=O(t);return e[2]>i?[F([e[0],e[1],i,e[3]]),F([r,e[1],r+e[2]-i,e[3]])]:e[0]<r?[F([r,e[1],e[2],e[3]]),F([i-(r-e[0]),e[1],i,e[3]])]:null}function P(e){return"text"===e||"esriTS"===e}function K(e){return"simple-marker"===e||"picture-marker"===e||"esriSMS"===e||"esriPMS"===e}function L(e){switch(r(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}function B(e){if(!e)return null;const{xmin:t,ymin:r,xmax:i,ymax:n,spatialReference:s}=e;return new M({rings:[[[t,r],[t,n],[i,n],[i,r],[t,r]]],spatialReference:s})}const A={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1};function J(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;const t=e.getVisualVariablesForType("size");if(!t[0])return 0;const r=t[0];if("outline"===r.target)return 0;if("stops"===r.transformationType)return r.stops.map((e=>e.size)).reduce(_,0);if("clamped-linear"===r.transformationType){let e=-1/0,t=-1/0;return e="number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((e=>e.size)).reduce(_,0),t="number"==typeof r.minSize?r.minSize:r.minSize.stops.map((e=>e.size)).reduce(_,0),Math.max(e,t)}return"real-world-size"===r.transformationType?30:void 0}async function U(e,t,r,i,n,s){if(!e||s&&"cluster"===s.type)return 0;if("heatmap"===e.type)return Math.round(3*e.blurRadius);if("dot-density"===e.type)return 0;if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?100:200;const l=e.getSymbols(),a=J(e),o=[];for(const e of l)o.push(H(e,a,r,t,i,n));const c=await Promise.all(o);return u(c.reduce(_,0))}const D=[0,0,0,0];function q(e,t){return null==e?t:e}const $={sdf:!0,code:99,metrics:V.metrics,rect:new h(0,0,24,24),page:0,textureBinding:2};async function G(e,t,r,i,n,s){if("simple-marker"===e.type){const r=Math.max(q(e.size,12),t);return W(e)+.707*r}if("picture-marker"===e.type){const r=Math.max(q(e.height,12),t),i=q(e.width,12)*(r/q(e.height,12))/2,n=r/2;return W(e)+Math.sqrt(i*i+n*n)}if("text"===e.type){const t=function(e){const t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[$]};const r=[];for(let i=0;i<t;i++)r.push({...$,code:e.text.charCodeAt(i)});return{glyphMosaicItems:r}}(e);!function(e,t,r){var i,n,s;if(!r||0===r.glyphMosaicItems.length)return e;const l=S(t.text)[1],a=r.glyphMosaicItems,o=z(a,l,{scale:u(t.font.size)/v,angle:null!=(i=t.angle)?i:0,xOffset:null!=(n=t.xoffset)?n:0,yOffset:null!=(s=t.yoffset)?s:0,hAlign:E(t.horizontalAlignment||"center"),vAlign:I(t.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(t.lineWidth||512,512)),lineHeight:w*Math.max(.25,Math.min(t.lineHeight||1,4)),decoration:t.font.decoration||"none",isCIM:!1}).bounds;e[0]=u(o.x-o.halfWidth),e[1]=u(o.y-o.halfHeight),e[2]=u(o.width),e[3]=u(o.height)}(D,e.toJSON(),t);const r=Math.abs(D[0]),i=Math.abs(D[1]),n=D[2],s=D[3];return Math.max(r,i)+Math.max(n,s)}if("simple-line"===e.type){const r=e,i=Math.max(q(r.width,.75),t)/2;return r.marker?Math.max(6*r.width,2*t):i}if("simple-fill"===e.type||"picture-fill"===e.type)return Math.max(function(e,t){return null==e.outline?t:q(e.outline.width,t)}(e,0),t)/2;if("cim"===e.type){const l={geometryType:i,fields:n,spatialReference:s},a={type:"cim",rendererKey:0,data:e.data,maxVVSize:t};await T(a,l,r);const o=x.getEnvelope(e.data,r);return o?Math.sqrt(o.width*o.width+o.height*o.height):0}return"web-style"===e.type?G(await e.fetchCIMSymbol(),t,r,i,n,s):0}async function H(e,t,r,i,n,s){return function(e){return e.type in A}(e)?Math.min(await G(e,t,r,i,n,s),75):0}function W(e){const t=q(e.xoffset,0),r=q(e.yoffset,0);return Math.sqrt(t*t+r*r)}function _(e,t){return Math.max(e,t)}const X=o.getLogger("esri.renderers.visualVariables.support.utils"),Y=e=>{if(!("visualVariables"in e)||!e.visualVariables||!e.visualVariables.length)return e;const t=e.clone(),r=t.visualVariables.map((e=>Z(e)?ee(e):e));return t.visualVariables=r,t};function Q(e){return e.map((e=>Z(e)?ee(e.clone()):e))}function Z(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}function ee(e){return e.stops=function(e,t){if(t.length<=8)return t;if(X.warn(`Found ${t.length} Visual Variable stops, but MapView only supports 8. Displayed stops will be simplified.`),t.length>16)return function(e,t){const[r,...i]=t,n=i.pop(),s=i[0].value,l=i[i.length-1].value,a=(l-s)/6,o=[];for(let r=s;r<l;r+=a){let n=0;for(;r>=i[n].value;)n++;const s=i[n],l=t[n-1],a=r-l.value,u=s.value===l.value?1:a/(s.value-l.value);if("color"===e){const e=i[n],s=t[n-1],l=e.color.clone();l.r=te(s.color.r,l.r,u),l.g=te(s.color.g,l.g,u),l.b=te(s.color.b,l.b,u),l.a=te(s.color.a,l.a,u),o.push({value:r,color:l,label:e.label})}else if("size"===e){const e=i[n],s=t[n-1],l=c(e.size),a=te(c(s.size),l,u);o.push({value:r,size:a,label:e.label})}else{const e=i[n],s=te(t[n-1].opacity,e.opacity,u);o.push({value:r,opacity:s,label:e.label})}}return[r,...o,n]}(e,t);return function(e){const[t,...r]=e,i=r.pop();for(;r.length>6;){let e=0,t=0;for(let i=1;i<r.length;i++){const n=r[i-1],s=r[i],l=Math.abs(s.value-n.value);l>t&&(t=l,e=i)}r.splice(e,1)}return[t,...r,i]}(t)}(e.type,e.stops),e}function te(e,t,r){return(1-r)*e+r*t}const re=o.getLogger("esri.views.2d.layers.features.schemaUtils"),ie={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function ne(e){return g(e)}function se(e){if("line-marker"===e.type){var t;return{type:"line-marker",color:null==(t=e.color)?void 0:t.toJSON(),placement:e.placement,style:e.style}}return f(e.toJSON()).toJSON()}function le(e){let t=0,r=0,n=!1,s=!0,l=!0;if(i(e)&&(r=J(e),"visualVariables"in e&&(t=function(e){if(!e)return d.NONE;let t=0;for(const r of e)if("size"===r.type){const e=b(r);t|=e,"outline"===r.target&&(t|=e<<4)}else"color"===r.type?t|=d.COLOR:"opacity"===r.type?t|=d.OPACITY:"rotation"===r.type&&(t|=d.ROTATION);return t}(e.visualVariables||[]),n="dot-density"===e.type),!n)){const t=e.getSymbols();"backgroundFillSymbol"in e&&e.backgroundFillSymbol&&t.push(e.backgroundFillSymbol);for(const e of t)if("cim"===e.type&&(s=!1),"simple-fill"===e.type||"picture-fill"===e.type){const t=e.outline;t&&"none"!==t.style&&"solid"!==t.style&&(l=!1);const r=t&&"none"!==t.style&&"solid"!==t.style,i="simple-fill"===e.type&&"none"!==e.style&&"solid"!==e.style;("picture-fill"===e.type||i||r)&&(s=!1)}}return n&&(l=!1),{vvFlags:t,maxVVSize:r,supportsOutlineFills:l,stride:{fill:n?"dot-density":s?"simple":"default"}}}function ae(e,t,r){return oe(e,le(t),r)}function oe(e,t,r){if(!e)return null;switch(e.type){case"simple-fill":case"picture-fill":return function(e,t,r){const i=t.supportsOutlineFills,n=y(p.FILL,{...t,isOutlinedFill:i}),s=r?ne(n):n,l=e.clone(),a=l.outline;t.supportsOutlineFills||(l.outline=null);const o={materialKey:s,hash:l.hash(),isOutlinedFill:!!t.supportsOutlineFills,...se(l)};if(t.supportsOutlineFills)return o;const u=[];if(u.push(o),a){const e=y(p.LINE,{...t,isOutline:!0}),i={materialKey:r?ne(e):e,hash:a.hash(),...se(a)};u.push(i)}return{type:"composite-symbol",layers:u,hash:u.reduce(((e,t)=>t.hash+e),"")}}(e,t,r);case"simple-marker":case"picture-marker":return function(e,t,r){const i=y(p.MARKER,t),n=r?ne(i):i,s=se(e);return{materialKey:n,hash:e.hash(),...s,angle:e.angle,maxVVSize:t.maxVVSize}}(e,t,r);case"simple-line":return function(e,t,r){const i=y(p.LINE,t),n=r?ne(i):i,s=e.clone(),l=s.marker;s.marker=null;const a=[];if(a.push({materialKey:n,hash:s.hash(),...se(s)}),l){var o;const e=y(p.MARKER,t),i=r?ne(e):e;l.color=null!=(o=l.color)?o:s.color,a.push({materialKey:i,hash:l.hash(),lineWidth:s.width,...se(l)})}return{type:"composite-symbol",layers:a,hash:a.reduce(((e,t)=>t.hash+e),"")}}(e,t,r);case"text":return function(e,t,r){const i=y(p.TEXT,t),n=r?ne(i):i,s=se(e);return{materialKey:n,hash:e.hash(),...s,angle:e.angle,maxVVSize:t.maxVVSize}}(e,t,r);case"label":return function(e,t,r){const i=e.toJSON(),n=y(p.LABEL,{...t,placement:i.labelPlacement});return{materialKey:r?ne(n):n,hash:e.hash(),...i,labelPlacement:i.labelPlacement}}(e,t,r);case"cim":return{type:"cim",rendererKey:t.vvFlags,data:e.data,maxVVSize:t.maxVVSize};case"CIMSymbolReference":return{type:"cim",rendererKey:t.vvFlags,data:e,maxVVSize:t.maxVVSize};case"web-style":return{...se(e),type:"web-style",hash:e.hash(),rendererKey:t.vvFlags,maxVVSize:t.maxVVSize};default:throw new Error(`symbol not supported ${e.type}`)}}function ue(e,r){const i=a(e),n=i.some((e=>function(e,r){const i=e.labelPlacement,n=ie[r];if(!e.symbol)return re.warn("No ILabelClass symbol specified."),!0;if(!n)return re.error(new t("mapview-labeling:unsupported-geometry-type",`Unable to create labels for Feature Layer, ${r} is not supported`)),!0;if(!n.some((e=>e===i))){const t=n[0];i&&re.warn(`Found invalid label placement type ${i} for ${r}. Defaulting to ${t}`),e.labelPlacement=t}return!1}(e,r)));return n?[]:i}function ce(e){return n("esri-2d-update-debug")&&console.debug("Created new schema",fe(e,!0)),fe(e)}function fe(r,n=!1){try{var l,a;const o=function(r,n=!1){const l=new Array;return l.push(function(r,n,l=!1){const a={indexCount:0,fields:{}},o="featureReduction"in r&&r.featureReduction,u=o?"aggregate":"feature";if("sublayers"in r){const e={type:"subtype",subtypeField:r.subtypeField,renderers:{},stride:{fill:"default"}},n={type:"subtype",mapping:{},target:"feature"},s={type:"subtype",classes:{}},o={type:"symbol",target:"feature",aggregateFields:[],attributes:a,storage:n,mesh:{matcher:e,aggregateMatcher:null,labels:s,sortKey:null}},c=new Set;let f=0;for(const{renderer:o,subtypeCode:d,labelingInfo:p,labelsVisible:m}of r.sublayers){const r=ve(a,u,o,l),y=xe(a,u,o),g=m&&p;if("visualVariables"in o&&o.visualVariables&&o.visualVariables.length)throw new t("ValidationError","Visual variables are currently not supported for subtype layers");if("dictionary"===r.type)throw new t("ValidationError","Dictionary renderer is not supported in subtype layers");if("subtype"===r.type)throw new t("ValidationError","Nested subtype renderers is not supported");if(i(y)&&"subtype"===y.type)throw new t("ValidationError","Nested subtype storage is not supported");if(i(y)&&"dot-density"===y.type)throw new t("ValidationError","Dot density attributes are not supported in subtype layers");if(c.has(d))throw new t("ValidationError","Subtype codes for sublayers must be unique");c.add(d),e.renderers[d]=r,n.mapping[d]=y,g&&(s.classes[d]=g.map((e=>be(o,a,e,"feature",f++,l))))}return o}if("heatmap"===r.renderer.type){const{blurRadius:e,fieldOffset:t,field:i}=r.renderer;return{type:"heatmap",aggregateFields:[],attributes:a,target:u,storage:null,mesh:{blurRadius:e,fieldOffset:t,field:ye(a,{target:u,field:i,resultType:"numeric"}).field}}}{const i=[],n="aggregate"===u?R(i,r.renderer,o,null):r.renderer;he(a,i);const c=ve(a,u,n,l);let f=null;const d=xe(a,u,n),p=j(r.geometryType);let m=r.labelsVisible&&r.labelingInfo||[],y=[];if(o){if("selection"===o.type)throw new t("ValidationError","Mapview does not support `selection` reduction type",o);if(o.symbol){const t=new e({symbol:o.symbol,visualVariables:"visualVariables"in n?n.visualVariables:null});f=ve(a,u,t,l)}y=o&&o.labelsVisible&&o.labelingInfo||[]}m=ue(m,p),y=ue(y,p);let g=0;const b=[...m.map((e=>be(n,a,e,"feature",g++,l))),...y.map((e=>be(n,a,e,"aggregate",g++,l)))],h=function(e,r){if(s(r)||!r.length)return null;r.length>1&&re.warn(`Layer rendering currently only supports ordering by 1 orderByInfo, but found ${r.length}. All but the first will be discarded`);const i=r[0],n="ascending"===i.order?"asc":"desc";if(i.field)return{field:i.field,order:n};if(i.valueExpression){return{fieldIndex:ge(e,{type:"expression",target:"feature",valueExpression:i.valueExpression,resultType:"numeric"}).fieldIndex,order:n}}return re.error(new t("ValidationError","Expected to find a field or valueExpression for OrderByInfo",i)),null}(a,r.orderBy);return{type:"symbol",target:u,attributes:a,aggregateFields:i,storage:d,mesh:{matcher:c,labels:{type:"simple",classes:b},aggregateMatcher:f,sortKey:h}}}}(r,n)),l}(r,n),c={};o.map((e=>function(e,r,i){switch(i.target){case"feature":return void me(e,pe(r),i);case"aggregate":{if(!("featureReduction"in r))return;const n=r.featureReduction;if("selection"===n.type)throw new t("ValidationError","Mapview does not support `selection` reduction type",n);return me(e,pe(r),i),void function(e,t,r){e.aggregate||(e.aggregate={name:"aggregate",input:"feature",filters:null,attributes:{},params:{clusterRadius:u(t.clusterRadius/2),clusterPixelBuffer:64*Math.ceil(u(t.clusterMaxSize)/64),fields:r.aggregateFields}});de(e.aggregate,r.attributes.fields)}(e,n,i)}}}(c,r,e)));return{source:{definitionExpression:r.definitionExpression,fields:r.fields.map((e=>e.toJSON())),gdbVersion:r.gdbVersion,historicMoment:null==(l=r.historicMoment)?void 0:l.getTime(),outFields:r.availableFields,pixelBuffer:r.pixelBuffer,spatialReference:r.spatialReference.toJSON(),timeExtent:null==(a=r.timeExtent)?void 0:a.toJSON(),customParameters:r.customParameters},attributes:{fields:{},indexCount:0},processors:o,targets:c}}catch(e){if("ValidationError"===e.fieldName)return re.error(e),null;throw e}}function de(e,t){for(const r in t){const i=t[r];if(i.target!==e.name)continue;const n=e.attributes[r];n?(n.context.mesh=n.context.mesh||i.context.mesh,n.context.storage=n.context.storage||i.context.storage):e.attributes[r]=i}return e}function pe(e){var t,i,n,s,l;return[null!=(t=null==(i=r(e.filter))?void 0:i.toJSON())?t:null,null!=(n=null==(s=r(null==(l=r(e.featureEffect))?void 0:l.filter))?void 0:s.toJSON())?n:null]}function me(e,t,r){return e.feature||(e.feature={name:"feature",input:"source",filters:t,attributes:{}}),de(e.feature,r.attributes.fields),e}function ye(e,t){return t.field?ge(e,{...t,type:"field",field:t.field}):t.valueExpression?ge(e,{...t,type:"expression",valueExpression:t.valueExpression}):{field:null,fieldIndex:null}}function ge(e,t){switch(t.type){case"expression":{const r=t.valueExpression;if(!e.fields[r]){const i=e.indexCount++;e.fields[r]={...t,name:r,fieldIndex:i}}return{fieldIndex:e.fields[r].fieldIndex}}case"label-expression":{const r=JSON.stringify(t.label);if(!e.fields[r]){const i=e.indexCount++;e.fields[r]={...t,name:r,fieldIndex:i}}return{fieldIndex:e.fields[r].fieldIndex}}case"field":{const r=t.field;return"aggregate"===t.target&&e.fields[r]||(e.fields[r]={...t,name:r}),{field:r}}case"statistic":return e.fields[t.name]={...t},{field:t.name}}}function be(e,t,r,i,n,s=!1){const l=ge(t,{type:"label-expression",target:i,context:{mesh:!0},resultType:"string",label:{labelExpression:r.labelExpression,labelExpressionInfo:r.labelExpressionInfo?{expression:r.labelExpressionInfo.expression}:null,symbol:!!r.symbol,where:r.where}}),{fieldIndex:a}=l;return{...ae(r,e,s),fieldIndex:a,target:i,index:n}}function he(e,t){const r={mesh:!0,storage:!0};for(const i of t){const{name:t,outStatistic:n}=i,{statisticType:s,onStatisticField:l}=n;let a=null,o=null,u=null;const c="numeric",f="feature";if("onStatisticValueExpression"in n){o=ge(e,{type:"expression",target:f,valueExpression:n.onStatisticValueExpression,resultType:c}).fieldIndex}else if("onStatisticNormalizationField"in n){a=ge(e,{type:"field",target:f,field:l,resultType:c}).field,u=n.onStatisticNormalizationField}else{a=ge(e,{type:"field",target:f,field:l,resultType:c}).field}ge(e,{type:"statistic",target:"aggregate",name:t,context:r,inField:a,inNormalizationField:u,inFieldIndex:o,statisticType:s})}}function xe(e,t,r){switch(r.type){case"dot-density":return function(e,t,r){if(!r||!r.length)return{type:"dot-density",mapping:[],target:t};return{type:"dot-density",mapping:r.map(((r,i)=>{const{field:n,fieldIndex:s}=ye(e,{valueExpression:r.valueExpression,field:r.field,resultType:"numeric",target:t});return{binding:i,field:n,fieldIndex:s}})),target:t}}(e,t,r.attributes);case"simple":case"class-breaks":case"unique-value":case"dictionary":return function(e,t,r){if(!r||!r.length)return{type:"visual-variable",mapping:[],target:t};const i={storage:!0},n="numeric";return{type:"visual-variable",mapping:Q(r).map((r=>{var s;const l=m(r.type),{field:a,fieldIndex:o}=ye(e,{target:t,valueExpression:r.valueExpression,field:r.field,context:i,resultType:n});switch(r.type){case"size":return"$view.scale"===r.valueExpression?null:{type:"size",binding:l,field:a,fieldIndex:o,normalizationField:ye(e,{target:t,field:r.normalizationField,context:i,resultType:n}).field,valueRepresentation:null!=(s=r.valueRepresentation)?s:null};case"color":return{type:"color",binding:l,field:a,fieldIndex:o,normalizationField:ye(e,{target:t,field:r.normalizationField,context:i,resultType:n}).field};case"opacity":return{type:"opacity",binding:l,field:a,fieldIndex:o,normalizationField:ye(e,{target:t,field:r.normalizationField,context:i,resultType:n}).field};case"rotation":return{type:"rotation",binding:l,field:a,fieldIndex:o}}})).filter((e=>e)),target:t}}(e,t,r.visualVariables);case"heatmap":return null}}function ve(e,r,i,n=!1){const s=l(e,{indexCount:0,fields:{}});switch(i.type){case"simple":case"dot-density":return function(e,t,r=!1){const i=t.getSymbols(),n=i.length?i[0]:null,{stride:s}=le(t);return{type:"simple",symbol:ae(n,t,r),stride:s}}(0,i,n);case"class-breaks":return function(e,t,r,i=!1){const n={mesh:!0,use:"renderer.field"},s=r.backgroundFillSymbol,{field:l,fieldIndex:a}=ye(e,{target:t,field:r.field,valueExpression:r.valueExpression,resultType:"numeric",context:n}),o=r.normalizationType,u="log"===o?"esriNormalizeByLog":"percent-of-total"===o?"esriNormalizeByPercentOfTotal":"field"===o?"esriNormalizeByField":null,c=le(r),f=r.classBreakInfos.map((e=>({symbol:oe(e.symbol,c,i),min:e.minValue,max:e.maxValue}))).sort(((e,t)=>e.min-t.min));return{type:"interval",attributes:e.fields,field:l,fieldIndex:a,backgroundFillSymbol:oe(s,c,i),defaultSymbol:oe(r.defaultSymbol,c,i),intervals:f,normalizationField:r.normalizationField,normalizationTotal:r.normalizationTotal,normalizationType:u,isMaxInclusive:r.isMaxInclusive,stride:c.stride}}(s,r,i,n);case"unique-value":return function(e,r,i,n=!1){const s=[],l=i.backgroundFillSymbol,a={target:r,context:{mesh:!0},resultType:"string"};if(i.field&&"string"!=typeof i.field)throw new t("ValidationError","Expected renderer.field to be a string",i);const{field:o,fieldIndex:u}=ye(e,{...a,field:i.field,valueExpression:i.valueExpression}),c=le(i);for(const e of i.uniqueValueInfos)s.push({value:""+e.value,symbol:oe(e.symbol,c,n)});return{type:"map",attributes:e.fields,field:o,fieldIndex:u,field2:ye(e,{...a,field:i.field2}).field,field3:ye(e,{...a,field:i.field3}).field,fieldDelimiter:i.fieldDelimiter,backgroundFillSymbol:oe(l,c),defaultSymbol:oe(i.defaultSymbol,c),map:s,stride:c.stride}}(s,r,i,n);case"dictionary":return function(e,t,r=!1){return{type:"dictionary",renderer:t.toJSON(),stride:{fill:"default"}}}(0,i,n)}}const we=Object.freeze({__proto__:null,createSymbolSchemaOptions:le,createSymbolSchema:ae,createSchema:ce,addAggregateFields:he,createMatcherSchema:ve});export{k as P,N as T,P as a,C as b,ve as c,ae as d,U as e,ce as f,L as g,we as h,K as i,B as p,Y as s};
