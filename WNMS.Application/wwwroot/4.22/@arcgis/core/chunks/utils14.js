/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{i as t,b as s}from"../core/lang.js";import{j as i}from"./mat3.js";import{c as r,a as e}from"./quatf64.js";import{a as o,c as a,f as n,m as h}from"./mat4.js";import{c as f}from"./mat4f64.js";import{c as l}from"./quat.js";import{b as m,T as c,g as b,s as p}from"./mathUtils.js";import{b as u}from"./vec3f32.js";import{c as g}from"./vec4f64.js";import{d as v}from"./sphere.js";import{s as z}from"./Util2.js";import{e as T}from"./doublePrecisionUtils.js";class S{constructor(){this._transform=f(),this._transformInverse=new q({value:this._transform},o,f),this._transformInverseTranspose=new q(this._transformInverse,a,f),this._transformTranspose=new q({value:this._transform},a,f),this._transformInverseRotation=new q({value:this._transform},i,r)}invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){n(this._transform,t)}multiplyTransform(t){h(this._transform,this._transform,t)}set(t){n(this._transform,t),this.invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,s){this.setTransformMatrix(t),this.multiplyTransform(s),this.invalidateLazyTransforms()}}class q{constructor(t,s,i){this.original=t,this.update=s,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}const x=new class{constructor(t=0){this.offset=t,this.sphere=v(),this.tmpVertex=m()}applyToVertex(t,s,i){const r=this.objectTransform.transform;let e=r[0]*t+r[4]*s+r[8]*i+r[12],o=r[1]*t+r[5]*s+r[9]*i+r[13],a=r[2]*t+r[6]*s+r[10]*i+r[14];const n=this.offset/Math.sqrt(e*e+o*o+a*a);e+=e*n,o+=o*n,a+=a*n;const h=this.objectTransform.inverse;return this.tmpVertex[0]=h[0]*e+h[4]*o+h[8]*a+h[12],this.tmpVertex[1]=h[1]*e+h[5]*o+h[9]*a+h[13],this.tmpVertex[2]=h[2]*e+h[6]*o+h[10]*a+h[14],this.tmpVertex}applyToMinMax(t,s){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const r=this.offset/Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);s[0]+=s[0]*r,s[1]+=s[1]*r,s[2]+=s[2]*r}applyToAabb(t){const s=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*s,t[1]+=t[1]*s,t[2]+=t[2]*s;const i=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*i,t[4]+=t[4]*i,t[5]+=t[5]*i,t}applyToBoundingSphere(t){const s=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this.offset/s;return this.sphere[0]=t[0]+t[0]*i,this.sphere[1]=t[1]+t[1]*i,this.sphere[2]=t[2]+t[2]*i,this.sphere[3]=t[3]+t[3]*this.offset/s,this.sphere}};function y(s){return t(s)?(x.offset=s,x):null}const _=new class{constructor(t=0){this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=m(),this.mbs=g(),this.obb={center:m(),halfSize:u(),quaternion:null}}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,s,i){const r=t,e=s,o=i+this.componentLocalOriginLength,a=this.offset/Math.sqrt(r*r+e*e+o*o);return this.tmpVertex[0]=t+r*a,this.tmpVertex[1]=s+e*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(t){const s=t[0],i=t[1],r=t[2]+this.componentLocalOriginLength,e=t[3],o=t[4],a=t[5]+this.componentLocalOriginLength,n=this.offset/Math.sqrt(s*s+i*i+r*r);t[0]+=s*n,t[1]+=i*n,t[2]+=r*n;const h=this.offset/Math.sqrt(e*e+o*o+a*a);return t[3]+=e*h,t[4]+=o*h,t[5]+=a*h,t}applyToMbs(t){const s=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this.offset/s;return this.mbs[0]=t[0]+t[0]*i,this.mbs[1]=t[1]+t[1]*i,this.mbs[2]=t[2]+t[2]*i,this.mbs[3]=t[3]+t[3]*this.offset/s,this.mbs}applyToObb(t){const s=t.center,i=this.offset/Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]);this.obb.center[0]=s[0]+s[0]*i,this.obb.center[1]=s[1]+s[1]*i,this.obb.center[2]=s[2]+s[2]*i,c(this.obb.halfSize,t.halfSize,t.quaternion),b(this.obb.halfSize,this.obb.halfSize,t.center);const r=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*r,this.obb.halfSize[1]+=this.obb.halfSize[1]*r,this.obb.halfSize[2]+=this.obb.halfSize[2]*r,p(this.obb.halfSize,this.obb.halfSize,t.center),l(j,t.quaternion),c(this.obb.halfSize,this.obb.halfSize,j),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=t.quaternion,this.obb}};function M(s){return t(s)?(_.offset=s,_):null}const d=new class{constructor(t=0){this.offset=t,this.tmpVertex=m()}applyToVertex(t,s,i){const r=t+this.localOrigin[0],e=s+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(r*r+e*e+o*o);return this.tmpVertex[0]=t+r*a,this.tmpVertex[1]=s+e*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(t){const s=t[0]+this.localOrigin[0],i=t[1]+this.localOrigin[1],r=t[2]+this.localOrigin[2],e=t[3]+this.localOrigin[0],o=t[4]+this.localOrigin[1],a=t[5]+this.localOrigin[2],n=this.offset/Math.sqrt(s*s+i*i+r*r);t[0]+=s*n,t[1]+=i*n,t[2]+=r*n;const h=this.offset/Math.sqrt(e*e+o*o+a*a);return t[3]+=e*h,t[4]+=o*h,t[5]+=a*h,t}};function V(s){return t(s)?(d.offset=s,d):null}const O="terrain",j=e();function L(t,i){return s(t)&&(t=[]),t.push(i),t}function I(t,i){if(s(t))return null;const r=t.filter((t=>t!==i));return 0===r.length?null:r}function w(s){return!!t(s)&&!s.visible}function A(s,i,r){const e=s.origin.vec3;z(B,-e[0],-e[1],-e[2]),t(s.transformation)?h(i,B,s.transformation):n(i,B),r&&(o(r,i),a(r,r))}function R(t,s,i,r,e){U[0]=t.get(s,0),U[1]=t.get(s,1),U[2]=t.get(s,2),T(U,F,3),i.set(e,0,F[0]),r.set(e,0,F[1]),i.set(e,1,F[2]),r.set(e,1,F[3]),i.set(e,2,F[4]),r.set(e,2,F[5])}const U=new Float64Array(3),F=new Float32Array(6),B=f();export{S as I,O as T,y as a,L as b,A as c,M as d,R as e,V as g,w as i,I as r};
