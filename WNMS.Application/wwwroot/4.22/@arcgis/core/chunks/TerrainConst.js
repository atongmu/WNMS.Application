/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{o as e,Q as A,R as t,B as i,S as s}from"./mathUtils.js";import{a as r}from"./aaBoundingRect.js";import n from"../core/Error.js";import{i as o,b as l,u as a}from"../core/lang.js";import{d as g}from"./unitUtils.js";import c from"../geometry/Extent.js";import{canProjectToWGS84ComparableLonLat as h}from"../geometry/projection.js";import u,{f as p,h as m}from"../geometry/SpatialReference.js";import{x2lon as f,y2lat as x}from"../geometry/support/webMercatorUtils.js";import v from"../layers/support/TileInfo.js";class B{constructor(e){const A=B.checkUnsupported(e);if(o(A))throw A;const t=a(e);this.spatialReference=t.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=h(this.spatialReference)||p(this.spatialReference)||m(this.spatialReference),this.origin=[t.origin.x,t.origin.y],this.pixelSize=t.size[0],this.dpi=t.dpi;const i=t.lods.reduce((function(e,A,t){return A.level<e.min&&(e.min=A.level,e.minIndex=t),e.max=Math.max(e.max,A.level),e}),{min:1/0,minIndex:0,max:-1/0}),s=t.lods[i.minIndex],r=2**s.level;let n=s.resolution*r,l=s.scale*r;this.levels=new Array(i.max+1);for(let e=0;e<this.levels.length;e++)this.levels[e]={resolution:n,scale:l,tileSize:[n*t.size[0],n*t.size[1]]},n/=2,l/=2}clone(){return new B(this.toTileInfo())}toTileInfo(){return new v({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(((e,A)=>({level:A,scale:e.scale,resolution:e.resolution})))})}getExtent(e,A,t,i){const s=this.levels[e],r=s.tileSize[0],n=s.tileSize[1];i[0]=this.origin[0]+t*r,i[2]=i[0]+r,i[3]=this.origin[1]-A*n,i[1]=i[3]-n}convertExtentToRadians(A,t){this._isWebMercator?(t[0]=f(A[0]),t[1]=x(A[1]),t[2]=f(A[2]),t[3]=x(A[3])):this._isGCS&&(t[0]=e(A[0]),t[1]=e(A[1]),t[2]=e(A[2]),t[3]=e(A[3]))}getExtentGeometry(e,A,t,i=new c){return this.getExtent(e,A,t,d),i.spatialReference=this.spatialReference,i.xmin=d[0],i.ymin=d[1],i.xmax=d[2],i.ymax=d[3],i.zmin=void 0,i.zmax=void 0,i}ensureMaxLod(e){if(null==e)return!1;let A=!1;for(;this.levels.length<=e;){const e=this.levels[this.levels.length-1],t=e.resolution/2;this.levels.push({resolution:t,scale:e.scale/2,tileSize:[t*this.pixelSize,t*this.pixelSize]}),A=!0}return A}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const A=this.levels[0].scale;return e>=A?0:Math.log(A/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof B)){if(B.checkUnsupported(e))return!1;e=new B(e)}if(!e.spatialReference.equals(this.spatialReference))return!1;if(e.pixelSize!==this.pixelSize)return!1;const t=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[t].resolution;let s=.5*i;if(!A(e.origin[0],this.origin[0],s)||!A(e.origin[1],this.origin[1],s))return!1;return s=.5*i/2**t/this.pixelSize*12,A(i,e.levels[t].resolution,s)}rootTilesInExtent(e,A=null,t=1/0){const i=new Array,s=this.levels[0].tileSize;if(l(e)||0===s[0]||0===s[1])return i;B.computeRowColExtent(e,s,this.origin,d);let r=d[1],n=d[3],a=d[0],g=d[2];const c=g-a,h=n-r;if(c*h>t){const e=Math.floor(Math.sqrt(t));h>e&&(r=r+Math.floor(.5*h)-Math.floor(.5*e),n=r+e),c>e&&(a=a+Math.floor(.5*c)-Math.floor(.5*e),g=a+e)}for(let e=r;e<n;e++)for(let A=a;A<g;A++)i.push([0,e,A]);return o(A)&&(A[0]=this.origin[0]+a*s[0],A[1]=this.origin[1]-n*s[1],A[2]=this.origin[0]+g*s[0],A[3]=this.origin[1]-r*s[1]),i}static computeRowColExtent(e,A,t,i){const s=.001*(e[2]-e[0]+(e[3]-e[1]));i[0]=Math.max(0,Math.floor((e[0]+s-t[0])/A[0])),i[2]=Math.max(0,Math.ceil((e[2]-s-t[0])/A[0])),i[1]=Math.max(0,Math.floor((t[1]-e[3]+s)/A[1])),i[3]=Math.max(0,Math.ceil((t[1]-e[1]-s)/A[1]))}static isPowerOfTwo(e){const A=e.lods,i=A[0].resolution*2**A[0].level;return!A.some((function(e){return!t(e.resolution,i/2**e.level)}))}static hasGapInLevels(e){const A=e.lods.map((function(e){return e.level}));A.sort((function(e,A){return e-A}));for(let e=1;e<A.length;e++)if(A[e]!==A[0]+e)return!0;return!1}static tileSizeSupported(e){const A=e.size[1];return A===e.size[0]&&0==(A&A-1)&&A>=128&&A<=512}static hasOriginPerLODs(e){const A=e.origin;return e.lods.some((e=>null!=e.origin&&(e.origin[0]!==A.x||e.origin[1]!==A.y)))}static checkUnsupported(e){return l(e)?new n("tilingscheme:tile-info-missing","Tiling scheme must have tiling information"):e.lods.length<1?new n("tilingscheme:generic","Tiling scheme must have at least one level"):B.isPowerOfTwo(e)?B.hasGapInLevels(e)?new n("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):B.tileSizeSupported(e)?B.hasOriginPerLODs(e)?new n("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new n("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new n("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,A){const t=e[2]-e[0],i=e[3]-e[1],s=g(A),r=1.2*Math.max(t,i),n=256,o=new B(new v({size:[n,n],origin:{x:e[0]-.5*(r-t),y:e[3]+.5*(r-i)},lods:[{level:0,resolution:r/n,scale:1/(n/96*.0254/(r*s))}],spatialReference:A}));return o.ensureMaxLod(20),o}static makeWebMercatorAuxiliarySphere(e){const A=new B(B.WebMercatorAuxiliarySphereTileInfo);return A.ensureMaxLod(e),A}static makeGCSWithTileSize(e,A=256,t=16){const i=256/A,s=new B(new v({size:[A,A],origin:{x:-180,y:90,spatialReference:e},spatialReference:e,lods:[{level:0,resolution:.703125*i,scale:295497598.570834*i}]}));return s.ensureMaxLod(t),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}B.WebMercatorAuxiliarySphereTileInfo=new v({size:[256,256],origin:{x:-20037508.342787,y:20037508.342787,spatialReference:u.WebMercator},spatialReference:u.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527.591555}]}),B.WebMercatorAuxiliarySphere=B.makeWebMercatorAuxiliarySphere(19);const d=r(),I=64,w=512,Q=2.5,C=i(s/10),E=4,T=e=>e<4?3:4,z=r();B.WebMercatorAuxiliarySphere.getExtent(0,0,0,z);const y=r([-180,-90,180,90]),R="Cannot extend surface to encompass all layers because it would result in too many root tiles.",S="Surface extent is too large for tile resolution at level 0.",L="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC",M=5;export{L as D,C as E,y as G,I as M,E as P,B as T,z as W,w as a,M as b,R as c,S as d,Q as e,T as g};
