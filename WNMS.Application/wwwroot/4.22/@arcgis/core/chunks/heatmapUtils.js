/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{c as t}from"./mathUtils.js";const e=(()=>{if(!("document"in globalThis))return()=>null;const t=document.createElement("canvas"),e=t.getContext("2d");return t.height=512,t.width=1,n=>{e.clearRect(0,0,1,t.height);const r=e.createLinearGradient(0,0,0,t.height);for(const{ratio:t,color:e}of n.colorStops)r.addColorStop(Math.max(t,.001),`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`);return e.fillStyle=r,e.fillRect(0,0,1,t.height),e.getImageData(0,0,1,t.height).data}})();function n(t,e,n,r){const{blurRadius:o,fieldOffset:i,field:c}=e,f=new Float64Array(n*r),u=a(o),s=Math.round(3*o);let h,l=Number.NEGATIVE_INFINITY;const d=function(t,e){if(null!=t)return"string"==typeof e?e=>-1*+e.readAttribute(t):n=>+n.readAttribute(t)+e;return t=>1}(c,i),g=new Set;for(const e of t){const t=e.getCursor();for(;t.next();){const e=t.getObjectId();if(g.has(e))continue;g.add(e);const a=t.readLegacyPointGeometry(),o=128;if(a.x<-o||a.x>=n+o||a.y<-o||a.y>r+o)continue;const i=+d(t),c=Math.round(a.x)-s,m=Math.round(a.y)-s,y=Math.max(0,c),M=Math.max(0,m),b=Math.min(r,Math.round(a.y)+s),x=Math.min(n,Math.round(a.x)+s);for(let t=M;t<b;t++){const e=u[t-m];for(let r=y;r<x;r++){const a=u[r-c];h=f[t*n+r]+=e*a*i,h>l&&(l=h)}}}}return{matrix:f.buffer,max:l}}function r(e,n,r,a,o,i){e.canvas.width=e.canvas.height=n,e.clearRect(0,0,n,n);const c=e.getImageData(0,0,n,n);r&&a&&c.data.set(new Uint8ClampedArray(function(e,n,r,a,o){const i=new Uint32Array(e*e),c="buffer"in n?n:new Float64Array(n),f="buffer"in r?new Uint32Array(r.buffer):new Uint32Array(new Uint8Array(r).buffer),u=f.length/(o-a);for(let e=0;e<c.length;e++){const n=c[e],r=Math.floor((n-a)*u);i[e]=f[t(r,0,f.length-1)]}return i.buffer}(n,r,a,o,i))),e.putImageData(c,0,0)}function a(t){const e=Math.round(3*t),n=2*t*t,r=new Float64Array(2*e+1);for(let a=0;a<=r.length;a++)r[a]=Math.exp(-((a-e)**2)/n)/Math.sqrt(2*Math.PI)*(t/2);return r}function o(t,e){return"function"==typeof t?t:t?"string"==typeof e?e=>-1*+e[t]:n=>+n[t]+e:()=>1}export{o as a,n as b,a as c,r as d,e as g};
