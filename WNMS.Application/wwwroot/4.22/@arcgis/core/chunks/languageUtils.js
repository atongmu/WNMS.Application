/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import e from"../geometry/Point.js";import{resolve as t,all as n,create as r}from"../core/promiseUtils.js";import i from"../geometry/Extent.js";import s from"../geometry/Geometry.js";import a from"../geometry/Multipoint.js";import o,{i as u}from"../geometry/Polygon.js";import l from"../geometry/Polyline.js";import{D as c}from"./datetime.js";import{b as f}from"../core/lang.js";import{p as h,f as g}from"./number3.js";import{g as m}from"./locale.js";class d{constructor(e,t){this.definition=null,this.context=null,this.definition=e,this.context=t}}class p{constructor(e=[]){this._elements=e}length(){return this._elements.length}get(e){return this._elements[e]}toArray(){const e=[];for(let t=0;t<this.length();t++)e.push(this.get(t));return e}}class y extends p{constructor(e,t,n,r,i,s){super(e),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=t,this._hasZ=n,this._hasM=r,this._cacheId=i,this._partId=s}get(t){if(void 0===this._lazyPt[t]){const n=this._elements[t];if(void 0===n)return;const r=this._hasZ,i=this._hasM;let s=null;s=r&&!i?new e(n[0],n[1],n[2],void 0,this._spRef):i&&!r?new e(n[0],n[1],void 0,n[2],this._spRef):r&&i?new e(n[0],n[1],n[2],n[3],this._spRef):new e(n[0],n[1],this._spRef),s.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=s}return this._lazyPt[t]}equalityTest(e){return e===this||null!==e&&(e instanceof y!=!1&&e.getUniqueHash()===this.getUniqueHash())}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class x extends p{constructor(e,t,n,r,i){super(e),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=n,this._hasM=r,this._spRef=t,this._cacheId=i}get(e){if(void 0===this._lazyPath[e]){const t=this._elements[e];if(void 0===t)return;this._lazyPath[e]=new y(t,this._spRef,this._hasZ,this._hasM,this._cacheId,e)}return this._lazyPath[e]}equalityTest(e){return e===this||null!==e&&(e instanceof x!=!1&&e.getUniqueHash()===this.getUniqueHash())}getUniqueHash(){return this._cacheId.toString()}}class _{constructor(e){this.value=e}}class S{constructor(e){this.value=e}}class b{constructor(e){this.fn=e}}class T{constructor(e,t){this.paramCount=t,this.fn=e}}const M=b,R=S,N=_,k=T,D={type:"VOID"},v={type:"BREAK"},A={type:"CONTINUE"};function w(e,t,n){return""===t||null==t||t===n||t===n?e:e=e.split(t).join(n)}function Z(e){return e instanceof b||e instanceof d||e instanceof T}function I(e){return!!j(e)||(!!Y(e)||(!!E(e)||(!!O(e)||(null===e||(e===D||"number"==typeof e)))))}function C(e,t){return void 0===e?t:e}function j(e){return"string"==typeof e||e instanceof String}function O(e){return"boolean"==typeof e}function Y(e){return"number"==typeof e}function F(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function J(e){return e instanceof Array}function L(e){return!0===(e&&e.declaredRootClass&&"esri.arcade.featureset.support.FeatureSet"===e.declaredRootClass)}function z(e){return!0===(e&&e.declaredRootClass&&"esri.arcade.featureSetCollection"===e.declaredRootClass)}function P(e){return e instanceof p}function E(e){return e instanceof Date}function G(e,t,n){if(e.length<t||e.length>n)throw new Error("Function called with wrong number of Parameters")}function q(e){return e<0?-Math.round(-e):Math.round(e)}function H(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))}function U(e,t){return!1===isNaN(e)?null==t||""===t?e.toString():(t=w(t,"‰",""),t=w(t,"¤",""),g(e,{pattern:t})):e.toString()}function V(e,t){const n=c.fromJSDate(e);return null==t||""===t?n.toISO({suppressMilliseconds:!0}):n.toFormat(B(t),{locale:m(),numberingSystem:"latn"})}function B(e){e=e.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$&]");let t="";const n=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of e.match(n))switch(r){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"Z":t+="ZZ";break;case"ZZ":t+="ZZZ";break;case"S":t+="'S'";break;case"SS":t+="'SS'";break;case"SSS":t+="u";break;case"A":case"a":t+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":t+=r;break;default:r.length>=2&&"["===r.slice(0,1)&&"]"===r.slice(-1)?t+=`'${r.slice(1,-1)}'`:t+=`'${r}'`}return t}function $(e,t,n){switch(n){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function Q(e,t,n){if(null===e){if(null===t||t===D)return $(null,null,n);if(Y(t))return $(0,t,n);if(j(t))return $(0,ne(t),n);if(O(t))return $(0,ne(t),n);if(E(t))return $(0,t.getTime(),n)}if(e===D){if(null===t||t===D)return $(null,null,n);if(Y(t))return $(0,t,n);if(j(t))return $(0,ne(t),n);if(O(t))return $(0,ne(t),n);if(E(t))return $(0,t.getTime(),n)}else if(Y(e)){if(Y(t))return $(e,t,n);if(O(t))return $(e,ne(t),n);if(null===t||t===D)return $(e,0,n);if(j(t))return $(e,ne(t),n);if(E(t))return $(e,t.getTime(),n)}else if(j(e)){if(j(t))return $(X(e),X(t),n);if(E(t))return $(ne(e),t.getTime(),n);if(Y(t))return $(ne(e),t,n);if(null===t||t===D)return $(ne(e),0,n);if(O(t))return $(ne(e),ne(t),n)}else if(E(e)){if(E(t))return $(e,t,n);if(null===t||t===D)return $(e.getTime(),0,n);if(Y(t))return $(e.getTime(),t,n);if(O(t))return $(e.getTime(),ne(t),n);if(j(t))return $(e.getTime(),ne(t),n)}else if(O(e)){if(O(t))return $(e,t,n);if(Y(t))return $(ne(e),ne(t),n);if(E(t))return $(ne(e),t.getTime(),n);if(null===t||t===D)return $(ne(e),0,n);if(j(t))return $(ne(e),ne(t),n)}return!!W(e,t)&&("<="===n||">="===n)}function W(t,n){if(t===n)return!0;if(null===t&&n===D||null===n&&t===D)return!0;if(E(t)&&E(n))return t.getTime()===n.getTime();if(t instanceof x)return t.equalityTest(n);if(t instanceof y)return t.equalityTest(n);if(t instanceof e&&n instanceof e){const e=t.cache._arcadeCacheId,r=n.cache._arcadeCacheId;if(null!=e)return e===r}if(void 0!==t&&void 0!==n&&null!==t&&null!==n&&"object"==typeof t&&"object"==typeof n){if(t._arcadeCacheId===n._arcadeCacheId&&void 0!==t._arcadeCacheId&&null!==t._arcadeCacheId)return!0;if(t._underlyingGraphic===n._underlyingGraphic&&void 0!==t._underlyingGraphic&&null!==t._underlyingGraphic)return!0}return!1}function X(e,t){if(j(e))return e;if(null===e)return"";if(Y(e))return U(e,t);if(O(e))return e.toString();if(E(e))return V(e,t);if(e instanceof s)return JSON.stringify(e.toJSON());if(J(e)){const t=[];for(let n=0;n<e.length;n++)t[n]=te(e[n]);return"["+t.join(",")+"]"}if(e instanceof p){const t=[];for(let n=0;n<e.length();n++)t[n]=te(e.get(n));return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText():Z(e)?"object, Function":""}function K(e){const t=[];if(!1===J(e))return null;if(e instanceof p){for(let n=0;n<e.length();n++)t[n]=ne(e.get(n));return t}for(let n=0;n<e.length;n++)t[n]=ne(e[n]);return t}function ee(e,t){if(j(e))return e;if(null===e)return"";if(Y(e))return U(e,t);if(O(e))return e.toString();if(E(e))return V(e,t);if(e instanceof s)return e instanceof i?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+ge(e.spatialReference)+"}":ge(e.toJSON(),((e,t)=>e.key===t.key?0:"spatialReference"===e.key?1:"spatialReference"===t.key||e.key<t.key?-1:e.key>t.key?1:0));if(J(e)){const t=[];for(let n=0;n<e.length;n++)t[n]=te(e[n]);return"["+t.join(",")+"]"}if(e instanceof p){const t=[];for(let n=0;n<e.length();n++)t[n]=te(e.get(n));return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText():Z(e)?"object, Function":""}function te(e){if(null===e)return"null";if(O(e)||Y(e)||j(e))return JSON.stringify(e);if(e instanceof s)return ee(e);if(e instanceof p)return ee(e);if(e instanceof Array)return ee(e);if(e instanceof Date)return JSON.stringify(V(e,""));if(null!==e&&"object"==typeof e){if(void 0!==e.castToText)return e.castToText()}else if(e===D)return"null";return"null"}function ne(e,t){return Y(e)?e:null===e||""===e?0:E(e)?NaN:O(e)?e?1:0:J(e)||""===e||void 0===e?NaN:void 0!==t&&j(e)?(t=w(t,"‰",""),t=w(t,"¤",""),h(e,{pattern:t})):e===D?0:Number(e)}function re(e){if(E(e))return e;if(j(e)){const t=se(e);if(t)return t.toJSDate()}return null}function ie(e){return E(e)?c.fromJSDate(e):j(e)?se(e):null}function se(e){const t=/ (\d\d)/;let n=c.fromISO(e);return n.isValid||t.test(e)&&(e=e.replace(t,"T$1"),n=c.fromISO(e),n.isValid)?n:null}function ae(e){return O(e)?e:j(e)?"true"===(e=e.toLowerCase()):!!Y(e)&&(0!==e&&!isNaN(e))}function oe(e,t){return f(e)?null:(null!==e.spatialReference&&void 0!==e.spatialReference||(e.spatialReference=t),e)}function ue(t){if(null===t)return null;if(t instanceof e)return"NaN"===t.x||null===t.x||isNaN(t.x)?null:t;if(t instanceof o){if(0===t.rings.length)return null;for(const e of t.rings)if(e.length>0)return t;return null}if(t instanceof l){if(0===t.paths.length)return null;for(const e of t.paths)if(e.length>0)return t;return null}return t instanceof a?0===t.points.length?null:t:t instanceof i?"NaN"===t.xmin||null===t.xmin||isNaN(t.xmin)?null:t:null}function le(e,t){if(!e)return t;if(!e.domain)return t;let n=null;if("string"===e.field.type||"esriFieldTypeString"===e.field.type)t=X(t);else{if(null==t)return null;if(""===t)return t;t=ne(t)}for(let r=0;r<e.domain.codedValues.length;r++){const i=e.domain.codedValues[r];i.code===t&&(n=i)}return null===n?t:n.name}function ce(e,t){if(!e)return t;if(!e.domain)return t;let n=null;t=X(t);for(let r=0;r<e.domain.codedValues.length;r++){const i=e.domain.codedValues[r];i.name===t&&(n=i)}return null===n?t:n.code}function fe(e,t,n=null,r){if(!t)return null;if(!t.fields)return null;let i,s,a=null;for(let n=0;n<t.fields.length;n++){const r=t.fields[n];r.name.toLowerCase()===e.toString().toLowerCase()&&(a=r)}if(null===a)throw new Error("Field not found");return r||(r=n&&t.typeIdField&&n._field(t.typeIdField)),null!=r&&t.types.some((function(e){return e.id===r&&(i=e.domains&&e.domains[a.name],i&&"inherited"===i.type&&(i=he(a.name,t),s=!0),!0)})),s||i||(i=he(e,t)),{field:a,domain:i}}function he(e,t){let n;return t.fields.some((function(t){return t.name.toLowerCase()===e.toLowerCase()&&(n=t.domain),!!n})),n}function ge(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});const n="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(i=t.cmp,function(e){return function(t,n){const r={key:t,value:e[t]},s={key:n,value:e[n]};return i(r,s)}});var i;const s=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===t)return;if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);let i,a;if(Array.isArray(t)){for(a="[",i=0;i<t.length;i++)i&&(a+=","),a+=e(t[i])||"null";return a+"]"}if(null===t)return"null";if(-1!==s.indexOf(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const o=s.push(t)-1,u=Object.keys(t).sort(r&&r(t));for(a="",i=0;i<u.length;i++){const n=u[i],r=e(t[n]);r&&(a&&(a+=","),a+=JSON.stringify(n)+":"+r)}return s.splice(o,1),"{"+a+"}"}(e)}function me(e){if(null===e)return null;const t=[];for(const n of e)n&&(n.declaredClass&&"esri.arcade.Feature"===n.declaredClass||"FeatureSetReader"===n.type)?t.push(n.geometry()):t.push(n);return t}function de(t,n){if(!(n instanceof e))throw new Error("Invalid Argument");t.push(n.hasZ?n.hasM?[n.x,n.y,n.z,n.m]:[n.x,n.y,n.z]:[n.x,n.y])}function pe(e,t){if(J(e)||P(e)){let n=!1,r=!1,i=[],s=t;if(J(e)){for(const t of e)de(i,t);i.length>0&&(s=e[0].spatialReference,n=e[0].hasZ,r=e[0].hasM)}else if(e instanceof y)i=e._elements,i.length>0&&(n=e._hasZ,r=e._hasM,s=e.get(0).spatialReference);else{if(!P(e))throw new Error("Invalid Argument");for(const t of e.toArray())de(i,t);i.length>0&&(s=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}if(0===i.length)return null;return!1===u(i,r,n)&&(i=i.slice(0).reverse()),new o({rings:[i],spatialReference:s,hasZ:n,hasM:r})}return e}function ye(e,t){if(J(e)||P(e)){let n=!1,r=!1,i=[],s=t;if(J(e)){for(const t of e)de(i,t);i.length>0&&(s=e[0].spatialReference,n=!0===e[0].hasZ,r=!0===e[0].hasM)}else if(e instanceof y)i=e._elements,i.length>0&&(n=e._hasZ,r=e._hasM,s=e.get(0).spatialReference);else if(P(e)){for(const t of e.toArray())de(i,t);i.length>0&&(s=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===i.length?null:new l({paths:[i],spatialReference:s,hasZ:n,hasM:r})}return e}function xe(e,t){if(J(e)||P(e)){let n=!1,r=!1,i=[],s=t;if(J(e)){for(const t of e)de(i,t);i.length>0&&(s=e[0].spatialReference,n=!0===e[0].hasZ,r=!0===e[0].hasM)}else if(e instanceof y)i=e._elements,i.length>0&&(n=e._hasZ,r=e._hasM,s=e.get(0).spatialReference);else if(P(e)){for(const t of e.toArray())de(i,t);i.length>0&&(s=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===i.length?null:new a({points:i,spatialReference:s,hasZ:n,hasM:r})}return e}function _e(e,t=!1){const n=[];if(null===e)return n;if(!0===J(e)){for(let r=0;r<e.length;r++){const i=X(e[r]);""===i&&!0!==t||n.push(i)}return n}if(e instanceof p){for(let r=0;r<e.length();r++){const i=X(e.get(r));""===i&&!0!==t||n.push(i)}return n}if(I(e)){const r=X(e);return""===r&&!0!==t||n.push(r),n}return[]}let Se=0;function be(e){return Se++,Se%100==0?(Se=0,r((t=>{setTimeout((()=>{t(e)}),0)}))):e}function Te(e,t,n){switch(n){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function Me(e,t=null){return null==e?null:O(e)||Y(e)||j(e)?e:e instanceof s?!0===(null==t?void 0:t.keepGeometryType)?e:e.toJSON():e instanceof p?e.toArray().map((e=>Me(e,t))):e instanceof Array?e.map((e=>Me(e,t))):e instanceof Date?e:null!==e&&"object"==typeof e&&void 0!==e.castAsJson?e.castAsJson(t):null}function Re(e,t,n,r,i){return Ne(e,t,n).then((e=>{i[r]=e}))}function Ne(e,r=null,i=null){if(e instanceof p&&(e=e.toArray()),null==e)return t(null);if(I(e)||e instanceof s||e instanceof Date)return t(Me(e,i));if(e instanceof Array){const a=[],o=[];for(const t of e)null===t||I(t)||t instanceof s||t instanceof Date?o.push(Me(t,i)):(o.push(null),a.push(Re(t,r,i,o.length-1,o)));return a.length>0?n(a).then((()=>o)):t(o)}return null!==e&&"object"==typeof e&&void 0!==e.castAsJsonAsync?e.castAsJsonAsync(r,i):t(null)}const ke=Object.freeze({__proto__:null,ReturnResultE:_,ImplicitResultE:S,NativeFunctionE:b,SizzleFunctionE:T,NativeFunction:M,ImplicitResult:R,ReturnResult:N,SizzleFunction:k,voidOperation:D,breakResult:v,continueResult:A,multiReplace:w,isFunctionParameter:Z,isSimpleType:I,defaultUndefined:C,isString:j,isBoolean:O,isNumber:Y,isInteger:F,isArray:J,isFeatureSet:L,isFeatureSetCollection:z,isImmutableArray:P,isDate:E,pcCheck:G,absRound:q,generateUUID:H,formatNumber:U,formatDate:V,standardiseDateFormat:B,greaterThanLessThan:Q,equalityTest:W,toString:X,toNumberArray:K,toStringExplicit:ee,toNumber:ne,toDate:re,toDateTime:ie,toBoolean:ae,fixSpatialReference:oe,fixNullGeometry:ue,getDomainValue:le,getDomainCode:ce,getDomain:fe,stableStringify:ge,autoCastFeatureToGeometry:me,autoCastArrayOfPointsToPolygon:pe,autoCastArrayOfPointsToPolyline:ye,autoCastArrayOfPointsToMultiPoint:xe,toStringArray:_e,tick:be,binaryOperator:Te,castAsJson:Me,castAsJsonAsync:Ne});export{oe as A,ue as B,me as C,Z as D,ye as E,d as F,pe as G,xe as H,p as I,w as J,K,H as L,L as M,M as N,z as O,Q as P,Te as Q,ke as R,k as S,v as T,A as U,x as V,N as W,R as X,be as Y,_e as Z,Y as a,j as b,Ne as c,Me as d,I as e,ne as f,ae as g,X as h,O as i,E as j,re as k,J as l,fe as m,le as n,ce as o,G as p,F as q,C as r,P as s,ee as t,W as u,D as v,B as w,ie as x,q as y,y as z};
