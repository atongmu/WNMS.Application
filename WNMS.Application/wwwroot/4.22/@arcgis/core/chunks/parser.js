/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{g as t,a as e,b as r,i as n,h as a}from"./colorUtils.js";import o from"../core/Error.js";import{p as u}from"./screenUtils.js";import{c as s,d as i}from"./mat4.js";import{c}from"./_commonjsHelpers.js";function l(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}l();class f{constructor(t,e,r){this.strength=t,this.radius=e,this.threshold=r,this.type="bloom"}interpolate(t,e,r){this.strength=y(t.strength,e.strength,r),this.radius=y(t.radius,e.radius,r),this.threshold=y(t.threshold,e.threshold,r)}clone(){return new f(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:v(this.radius),strength:this.strength,threshold:this.threshold}}}class h{constructor(t){this.radius=t,this.type="blur"}interpolate(t,e,r){this.radius=Math.round(y(t.radius,e.radius,r))}clone(){return new h(this.radius)}toJSON(){return{type:"blur",radius:v(this.radius)}}}class p{constructor(t,e){this.type=t,this.amount=e,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,e,r){this.amount=y(t.amount,e.amount,r),this._updateMatrix()}clone(){return new p(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||l();switch(this.type){case"brightness":this._colorMatrix=((t,e)=>{const r=i(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return s(r,r)})(t,this.amount);break;case"contrast":this._colorMatrix=((t,e)=>{const r=i(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return s(r,r)})(t,this.amount);break;case"grayscale":this._colorMatrix=((t,e)=>{const r=1-e,n=i(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return s(n,n)})(t,this.amount);break;case"invert":this._colorMatrix=((t,e)=>{const r=1-2*e,n=i(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return s(n,n)})(t,this.amount);break;case"saturate":this._colorMatrix=((t,e)=>{const r=i(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return s(r,r)})(t,this.amount);break;case"sepia":this._colorMatrix=((t,e)=>{const r=1-e,n=i(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return s(n,n)})(t,this.amount)}}}class m{constructor(t,e,r,n){this.offsetX=t,this.offsetY=e,this.blurRadius=r,this.color=n,this.type="drop-shadow"}interpolate(t,e,r){this.offsetX=y(t.offsetX,e.offsetX,r),this.offsetY=y(t.offsetY,e.offsetY,r),this.blurRadius=y(t.blurRadius,e.blurRadius,r),this.color[0]=Math.round(y(t.color[0],e.color[0],r)),this.color[1]=Math.round(y(t.color[1],e.color[1],r)),this.color[2]=Math.round(y(t.color[2],e.color[2],r)),this.color[3]=y(t.color[3],e.color[3],r)}clone(){return new m(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:v(this.offsetX),yoffset:v(this.offsetY),blurRadius:v(this.blurRadius),color:t}}}class g{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,e,r){this.angle=y(t.angle,e.angle,r),this._updateMatrix()}clone(){return new g(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||l();this._colorMatrix=((t,e)=>{const r=Math.sin(e*Math.PI/180),n=Math.cos(e*Math.PI/180),a=i(t,.213+.787*n-.213*r,.715-.715*n-.715*r,.072-.072*n+.928*r,0,.213-.213*n+.143*r,.715+.285*n+.14*r,.072-.072*n-.283*r,0,.213-.213*n-.787*r,.715-.715*n+.715*r,.072+.928*n+.072*r,0,0,0,0,1);return s(a,a)})(t,this.angle)}}class d{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,e,r){this.amount=y(t.amount,e.amount,r)}clone(){return new d(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function y(t,e,r){return t+(e-t)*r}function v(t){return Math.round(1e3*u(t))/1e3}function w(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new p(e.type,0);case"saturate":case"brightness":case"contrast":return new p(e.type,1);case"opacity":return new d(1);case"hue-rotate":return new g(0);case"blur":return new h(0);case"drop-shadow":return new m(0,0,0,[...t("transparent")]);case"bloom":return new f(0,0,1)}}var x,b={exports:{}};function A(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every(((t,e)=>t.type===r[e].type))}function M(t,e){const r=t.length>e.length?t:e,n=t.length>e.length?e:t;for(let t=n.length;t<r.length;t++)n.push(w(r[t]))}function _(t){const e=t[0];return!!e&&"type"in e}function C(t){if(!t||0===t.length)return null;if("string"==typeof t){const e=F(t);return e&&0!==e.length?e:null}const e=t.map((t=>{if(!Number.isFinite(t.scale)||t.scale<=0)throw new o("effect:invalid-scale","scale must be finite and greater than 0",{stop:t});return{scale:t.scale,effects:F(t.value)}}));e.sort(((t,e)=>e.effects.length-t.effects.length));for(let t=0;t<e.length-1;t++){if(!A(e[t].effects,e[t+1].effects))throw new o("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[t].effects,b:e[t+1].effects});M(e[t].effects,e[t+1].effects)}return e.sort(((t,e)=>e.scale-t.scale)),e}function F(t){let e;if(!t)return[];try{e=b.exports.parse(t)}catch(e){throw new o("effect:invalid-syntax","Invalid effect syntax",{value:t,error:e})}return e.map((t=>function(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(t){let e=1;E(t.parameters,1),1===t.parameters.length&&(e=$(t.parameters[0]));return new p(t.name,e)}(t);case"opacity":return function(t){let e=1;E(t.parameters,1),1===t.parameters.length&&(e=$(t.parameters[0]));return new d(e)}(t);case"hue-rotate":return function(t){let e=0;E(t.parameters,1),1===t.parameters.length&&(function(t){if("quantity"!==t.type||!(0===t.value&&null===t.unit||t.unit&&null!=R[t.unit]))throw new o("effect:type-error",`Expected <angle>, Actual: ${O(t)}`,{term:t})}(r=t.parameters[0]),e=r.value*R[r.unit]||0);var r;return new g(e)}(t);case"blur":return function(t){let e=0;E(t.parameters,1),1===t.parameters.length&&(e=N(t.parameters[0]),j(e,t.parameters[0]));return new h(e)}(t);case"drop-shadow":return function(t){const e=[];let r=null;for(const n of t.parameters)if("color"===n.type){if(e.length&&Object.freeze(e),r)throw new o("effect:type-error","Accepts only one color",{});r=J(n)}else{const t=N(n);if(Object.isFrozen(e))throw new o("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(t),3===e.length&&j(t,n)}if(e.length<2||e.length>3)throw new o("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new m(e[0],e[1],e[2]||0,r||X("black"))}(t);case"bloom":return function(t){let e=1,r=0,n=0;E(t.parameters,3),t.parameters[0]&&(e=$(t.parameters[0]));t.parameters[1]&&(r=N(t.parameters[1]),j(r,t.parameters[1]));t.parameters[2]&&(n=$(t.parameters[2]));return new f(e,r,n)}(t)}}catch(e){throw e.details.filter=t,e}throw new o("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}(t)))}function E(t,e){if(t.length>e)throw new o("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function O(t){if("color"===t.type)return"<color>";if(t.unit){if(S[t.unit])return"<length>";if(R[t.unit])return"<angle>";if("%"===t.unit)return"<percentage>"}return"<double>"}function j(t,e){if(t<0)throw new o("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}(x=b).exports&&(x.exports=function(){function t(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function e(t,r,n,a){var o=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(o,e.prototype),o.expected=r,o.found=n,o.location=a,o.name="SyntaxError",o}function r(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}function n(t,r){var n,a={},o=(r=void 0!==r?r:{}).grammarSource,u={start:Gt},s=Gt,i="none",c=")",l=",",f="(",h="%",p="px",m="cm",g="mm",d="in",y="pt",v="pc",w="deg",x="rad",b="grad",A="turn",M="#",_=".",C="e",F=/^[ \t\n\r]/,E=/^[a-z\-]/,O=/^[0-9a-fA-F]/,j=/^[+\-]/,R=/^[0-9]/,S=Ut("none"),$=It("none",!1),k=It(")",!1),N=It(",",!1),J=Ut("whitespace"),X=Pt([" ","\t","\n","\r"],!1,!1),Y=Ut("function"),q=It("(",!1),I=Ut("identifier"),P=Pt([["a","z"],"-"],!1,!1),z=Ut("percentage"),U=It("%",!1),T=Ut("length"),H=It("px",!1),B=It("cm",!1),D=It("mm",!1),G=It("in",!1),K=It("pt",!1),L=It("pc",!1),Q=Ut("angle"),V=It("deg",!1),W=It("rad",!1),Z=It("grad",!1),tt=It("turn",!1),et=Ut("number"),rt=Ut("color"),nt=It("#",!1),at=Pt([["0","9"],["a","f"],["A","F"]],!1,!1),ot=Pt(["+","-"],!1,!1),ut=Pt([["0","9"]],!1,!1),st=It(".",!1),it=It("e",!1),ct=function(){return[]},lt=function(t,e){return{type:"function",name:t,parameters:e||[]}},ft=function(t,e){return e.length>0?ce(t,e,3):[t]},ht=function(t){return{type:"quantity",value:t.value,unit:t.unit}},pt=function(t){return{type:"color",colorType:t.type,value:t.value}},mt=function(t){return t},gt=function(){return qt()},dt=function(t){return{value:t,unit:"%"}},yt=function(t){return{value:t,unit:"px"}},vt=function(t){return{value:t,unit:"cm"}},wt=function(t){return{value:t,unit:"mm"}},xt=function(t){return{value:t,unit:"in"}},bt=function(t){return{value:t,unit:"pt"}},At=function(t){return{value:t,unit:"pc"}},Mt=function(t){return{value:t,unit:"deg"}},_t=function(t){return{value:t,unit:"rad"}},Ct=function(t){return{value:t,unit:"grad"}},Ft=function(t){return{value:t,unit:"turn"}},Et=function(t){return{value:t,unit:null}},Ot=function(){return{type:"hex",value:qt()}},jt=function(t){return{type:"function",value:t}},Rt=function(){return{type:"named",value:qt()}},St=function(){return parseFloat(qt())},$t=0,kt=0,Nt=[{line:1,column:1}],Jt=0,Xt=[],Yt=0;if("startRule"in r){if(!(r.startRule in u))throw new Error("Can't start parsing from rule \""+r.startRule+'".');s=u[r.startRule]}function qt(){return t.substring(kt,$t)}function It(t,e){return{type:"literal",text:t,ignoreCase:e}}function Pt(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function zt(){return{type:"end"}}function Ut(t){return{type:"other",description:t}}function Tt(e){var r,n=Nt[e];if(n)return n;for(r=e-1;!Nt[r];)r--;for(n={line:(n=Nt[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Nt[e]=n,n}function Ht(t,e){var r=Tt(t),n=Tt(e);return{source:o,start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function Bt(t){$t<Jt||($t>Jt&&(Jt=$t,Xt=[]),Xt.push(t))}function Dt(t,r,n){return new e(e.buildMessage(t,r),t,r,n)}function Gt(){var t;return(t=Kt())===a&&(t=Lt()),t}function Kt(){var e,r;return Yt++,e=$t,Zt(),t.substr($t,4)===i?(r=i,$t+=4):(r=a,0===Yt&&Bt($)),r!==a?(Zt(),kt=e,e=ct()):($t=e,e=a),Yt--,e===a&&0===Yt&&Bt(S),e}function Lt(){var t,e;if(t=[],(e=Qt())!==a)for(;e!==a;)t.push(e),e=Qt();else t=a;return t}function Qt(){var e,r,n,o;return e=$t,Zt(),(r=te())!==a?(Zt(),(n=Vt())===a&&(n=null),Zt(),41===t.charCodeAt($t)?(o=c,$t++):(o=a,0===Yt&&Bt(k)),o!==a?(Zt(),kt=e,e=lt(r,n)):($t=e,e=a)):($t=e,e=a),e}function Vt(){var e,r,n,o,u,s,i,c;if(e=$t,(r=Wt())!==a){for(n=[],o=$t,u=Zt(),44===t.charCodeAt($t)?(s=l,$t++):(s=a,0===Yt&&Bt(N)),s===a&&(s=null),i=Zt(),(c=Wt())!==a?o=u=[u,s,i,c]:($t=o,o=a);o!==a;)n.push(o),o=$t,u=Zt(),44===t.charCodeAt($t)?(s=l,$t++):(s=a,0===Yt&&Bt(N)),s===a&&(s=null),i=Zt(),(c=Wt())!==a?o=u=[u,s,i,c]:($t=o,o=a);kt=e,e=ft(r,n)}else $t=e,e=a;return e}function Wt(){var t,e;return t=$t,(e=re())===a&&(e=ne())===a&&(e=ae())===a&&(e=oe()),e!==a&&(kt=t,e=ht(e)),(t=e)===a&&(t=$t,(e=ue())!==a&&(kt=t,e=pt(e)),t=e),t}function Zt(){var e,r;for(Yt++,e=[],F.test(t.charAt($t))?(r=t.charAt($t),$t++):(r=a,0===Yt&&Bt(X));r!==a;)e.push(r),F.test(t.charAt($t))?(r=t.charAt($t),$t++):(r=a,0===Yt&&Bt(X));return Yt--,r=a,0===Yt&&Bt(J),e}function te(){var e,r,n;return Yt++,e=$t,(r=ee())!==a?(40===t.charCodeAt($t)?(n=f,$t++):(n=a,0===Yt&&Bt(q)),n!==a?(kt=e,e=mt(r)):($t=e,e=a)):($t=e,e=a),Yt--,e===a&&(r=a,0===Yt&&Bt(Y)),e}function ee(){var e,r,n;if(Yt++,e=$t,r=[],E.test(t.charAt($t))?(n=t.charAt($t),$t++):(n=a,0===Yt&&Bt(P)),n!==a)for(;n!==a;)r.push(n),E.test(t.charAt($t))?(n=t.charAt($t),$t++):(n=a,0===Yt&&Bt(P));else r=a;return r!==a&&(kt=e,r=gt()),Yt--,(e=r)===a&&(r=a,0===Yt&&Bt(I)),e}function re(){var e,r,n;return Yt++,e=$t,Zt(),(r=se())!==a?(37===t.charCodeAt($t)?(n=h,$t++):(n=a,0===Yt&&Bt(U)),n!==a?(kt=e,e=dt(r)):($t=e,e=a)):($t=e,e=a),Yt--,e===a&&0===Yt&&Bt(z),e}function ne(){var e,r,n;return Yt++,e=$t,Zt(),(r=se())!==a?(t.substr($t,2)===p?(n=p,$t+=2):(n=a,0===Yt&&Bt(H)),n!==a?(kt=e,e=yt(r)):($t=e,e=a)):($t=e,e=a),e===a&&(e=$t,Zt(),(r=se())!==a?(t.substr($t,2)===m?(n=m,$t+=2):(n=a,0===Yt&&Bt(B)),n!==a?(kt=e,e=vt(r)):($t=e,e=a)):($t=e,e=a),e===a&&(e=$t,Zt(),(r=se())!==a?(t.substr($t,2)===g?(n=g,$t+=2):(n=a,0===Yt&&Bt(D)),n!==a?(kt=e,e=wt(r)):($t=e,e=a)):($t=e,e=a),e===a&&(e=$t,Zt(),(r=se())!==a?(t.substr($t,2)===d?(n=d,$t+=2):(n=a,0===Yt&&Bt(G)),n!==a?(kt=e,e=xt(r)):($t=e,e=a)):($t=e,e=a),e===a&&(e=$t,Zt(),(r=se())!==a?(t.substr($t,2)===y?(n=y,$t+=2):(n=a,0===Yt&&Bt(K)),n!==a?(kt=e,e=bt(r)):($t=e,e=a)):($t=e,e=a),e===a&&(e=$t,Zt(),(r=se())!==a?(t.substr($t,2)===v?(n=v,$t+=2):(n=a,0===Yt&&Bt(L)),n!==a?(kt=e,e=At(r)):($t=e,e=a)):($t=e,e=a)))))),Yt--,e===a&&0===Yt&&Bt(T),e}function ae(){var e,r,n;return Yt++,e=$t,(r=se())!==a?(t.substr($t,3)===w?(n=w,$t+=3):(n=a,0===Yt&&Bt(V)),n!==a?(kt=e,e=Mt(r)):($t=e,e=a)):($t=e,e=a),e===a&&(e=$t,(r=se())!==a?(t.substr($t,3)===x?(n=x,$t+=3):(n=a,0===Yt&&Bt(W)),n!==a?(kt=e,e=_t(r)):($t=e,e=a)):($t=e,e=a),e===a&&(e=$t,(r=se())!==a?(t.substr($t,4)===b?(n=b,$t+=4):(n=a,0===Yt&&Bt(Z)),n!==a?(kt=e,e=Ct(r)):($t=e,e=a)):($t=e,e=a),e===a&&(e=$t,(r=se())!==a?(t.substr($t,4)===A?(n=A,$t+=4):(n=a,0===Yt&&Bt(tt)),n!==a?(kt=e,e=Ft(r)):($t=e,e=a)):($t=e,e=a)))),Yt--,e===a&&(r=a,0===Yt&&Bt(Q)),e}function oe(){var t,e;return Yt++,t=$t,Zt(),(e=se())!==a?(kt=t,t=Et(e)):($t=t,t=a),Yt--,t===a&&0===Yt&&Bt(et),t}function ue(){var e,r,n,o;if(Yt++,e=$t,35===t.charCodeAt($t)?(r=M,$t++):(r=a,0===Yt&&Bt(nt)),r!==a){if(n=[],O.test(t.charAt($t))?(o=t.charAt($t),$t++):(o=a,0===Yt&&Bt(at)),o!==a)for(;o!==a;)n.push(o),O.test(t.charAt($t))?(o=t.charAt($t),$t++):(o=a,0===Yt&&Bt(at));else n=a;n!==a?(kt=e,e=Ot()):($t=e,e=a)}else $t=e,e=a;return e===a&&(e=$t,(r=Qt())!==a&&(kt=e,r=jt(r)),(e=r)===a&&(e=$t,(r=ee())!==a&&(kt=e,r=Rt()),e=r)),Yt--,e===a&&(r=a,0===Yt&&Bt(rt)),e}function se(){var e,r,n,o,u,s,i;for(e=$t,j.test(t.charAt($t))?(t.charAt($t),$t++):0===Yt&&Bt(ot),r=$t,n=[],R.test(t.charAt($t))?(o=t.charAt($t),$t++):(o=a,0===Yt&&Bt(ut));o!==a;)n.push(o),R.test(t.charAt($t))?(o=t.charAt($t),$t++):(o=a,0===Yt&&Bt(ut));if(46===t.charCodeAt($t)?(o=_,$t++):(o=a,0===Yt&&Bt(st)),o!==a){if(u=[],R.test(t.charAt($t))?(s=t.charAt($t),$t++):(s=a,0===Yt&&Bt(ut)),s!==a)for(;s!==a;)u.push(s),R.test(t.charAt($t))?(s=t.charAt($t),$t++):(s=a,0===Yt&&Bt(ut));else u=a;u!==a?r=n=[n,o,u]:($t=r,r=a)}else $t=r,r=a;if(r===a)if(r=[],R.test(t.charAt($t))?(n=t.charAt($t),$t++):(n=a,0===Yt&&Bt(ut)),n!==a)for(;n!==a;)r.push(n),R.test(t.charAt($t))?(n=t.charAt($t),$t++):(n=a,0===Yt&&Bt(ut));else r=a;if(r!==a){if(n=$t,101===t.charCodeAt($t)?(o=C,$t++):(o=a,0===Yt&&Bt(it)),o!==a){if(j.test(t.charAt($t))?(u=t.charAt($t),$t++):(u=a,0===Yt&&Bt(ot)),u===a&&(u=null),s=[],R.test(t.charAt($t))?(i=t.charAt($t),$t++):(i=a,0===Yt&&Bt(ut)),i!==a)for(;i!==a;)s.push(i),R.test(t.charAt($t))?(i=t.charAt($t),$t++):(i=a,0===Yt&&Bt(ut));else s=a;s!==a?n=o=[o,u,s]:($t=n,n=a)}else $t=n,n=a;n===a&&(n=null),kt=e,e=St()}else $t=e,e=a;return e}function ie(t,e){return t.map((function(t){return t[e]}))}function ce(t,e,r){return[t].concat(ie(e,r))}if((n=s())!==a&&$t===t.length)return n;throw n!==a&&$t<t.length&&Bt(zt()),Dt(Xt,Jt<t.length?t.charAt(Jt):null,Jt<t.length?Ht(Jt,Jt+1):Ht(Jt,Jt))}return t(e,Error),e.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n,a=null;for(n=0;n<t.length;n++)if(t[n].source===this.location.source){a=t[n].text.split(/\r\n|\n|\r/g);break}var o=this.location.start,u=this.location.source+":"+o.line+":"+o.column;if(a){var s=this.location.end,i=r("",o.line.toString().length),c=a[o.line-1],l=o.line===s.line?s.column:c.length+1;e+="\n --\x3e "+u+"\n"+i+" |\n"+o.line+" | "+c+"\n"+i+" | "+r("",o.column-1)+r("",l-o.column,"^")}else e+="\n at "+u}return e},e.buildMessage=function(t,e){var r={literal:function(t){return'"'+a(t.text)+'"'},class:function(t){var e=t.parts.map((function(t){return Array.isArray(t)?o(t[0])+"-"+o(t[1]):o(t)}));return"["+(t.inverted?"^":"")+e+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function a(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function o(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function u(t){return r[t.type](t)}function s(t){var e,r,n=t.map(u);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}function i(t){return t?'"'+a(t)+'"':"end of input"}return"Expected "+s(t)+" but "+i(e)+" found."},{SyntaxError:e,parse:n}}());const R={deg:1,grad:.9,rad:180/Math.PI,turn:360};const S={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function $(t){!function(t){if("quantity"!==t.type||null!==t.unit&&"%"!==t.unit)throw new o("effect:type-error",`Expected <double> or <percentage>, Actual: ${O(t)}`,{term:t})}(t);const e=t.value;return j(e,t),"%"===t.unit?.01*e:e}function k(t){return function(t){if("quantity"!==t.type||null!==t.unit)throw new o("effect:type-error",`Expected <double>, Actual: ${O(t)}`,{term:t})}(t),j(t.value,t),t.value}function N(t){return function(t){if("quantity"!==t.type||!(0===t.value&&null===t.unit||t.unit&&null!=S[t.unit]))throw new o("effect:type-error",`Expected <length>, Actual: ${O(t)}`,{term:t})}(t),t.value*S[t.unit]||0}function J(t){switch(t.colorType){case"hex":return r(t.value);case"named":return X(t.value);case"function":return function(t){if(E(t.parameters,4),Y.test(t.name))return[$(t.parameters[0]),$(t.parameters[1]),$(t.parameters[2]),t.parameters[3]?$(t.parameters[3]):1];if(q.test(t.name))return a(k(t.parameters[0]),$(t.parameters[1]),$(t.parameters[2]),t.parameters[3]?$(t.parameters[3]):1);throw new o("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}(t.value)}}function X(t){if(!n(t))throw new o("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return e(t)}const Y=/^rgba?/i,q=/^hsla?/i;export{l as a,A as c,_ as i,M as n,C as p};
