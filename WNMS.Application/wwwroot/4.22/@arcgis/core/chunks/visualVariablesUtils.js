/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{b as e}from"../core/lang.js";import{t as s,a as t}from"./screenUtils.js";import{a as n}from"./number2.js";import{N as o}from"./definitions.js";import{b as i}from"./enums.js";import{g as r}from"./visualVariablesUtils2.js";function a(e,s=0,t=!1){const n=e[s+3];return e[s+0]*=n,e[s+1]*=n,e[s+2]*=n,t||(e[s+3]*=255),e}function l(e){if(!e)return 0;const{r:s,g:t,b:o,a:i}=e;return n(s*i,t*i,o*i,255*i)}function u(e){if(!e)return 0;const[s,t,o,i]=e;return n(s*(i/255),t*(i/255),o*(i/255),i)}const c=8388607,f=0,p=1,m=e=>(8388608&e)>>>23,v=e=>8388607&e,d=e=>1===m(e)?254:255;function g(e){return 1===m(e)}function h(e,s){return((s?8388608:0)|e)>>>0}const y=(e,s)=>e&&((...e)=>s.warn("DEBUG:",...e))||(()=>null),z=!1;function S(e,s){if(!e||!s)return e;switch(s){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function b(e){return e.map((e=>function(e){return{value:e.value,size:s(e.size)}}(e)))}function E(e){if("string"==typeof e||"number"==typeof e)return s(e);const t=e;return{type:"size",expression:t.expression,stops:b(t.stops)}}const V=e=>{const s=[],n=[],i=b(e),r=i.length;for(let e=0;e<6;e++){const a=i[Math.min(e,r-1)];s.push(a.value),n.push(null==a.size?o:t(a.size))}return{values:new Float32Array(s),sizes:new Float32Array(n)}};function x(e){const s=e&&e.length>0?{}:null,t=s?{}:null;if(!s)return{vvFields:s,vvRanges:t};for(const n of e)if(n.field&&(s[n.type]=n.field),"size"===n.type){t.size||(t.size={});const e=n;switch(r(e)){case i.SIZE_MINMAX_VALUE:t.size.minMaxValue={minDataValue:e.minDataValue,maxDataValue:e.maxDataValue,minSize:E(e.minSize),maxSize:E(e.maxSize)};break;case i.SIZE_SCALE_STOPS:t.size.scaleStops={stops:b(e.stops)};break;case i.SIZE_FIELD_STOPS:if(e.levels){const s={};for(const t in e.levels)s[t]=V(e.levels[t]);t.size.fieldStops={type:"level-dependent",levels:s}}else t.size.fieldStops={type:"static",...V(e.stops)};break;case i.SIZE_UNIT_VALUE:t.size.unitValue={unit:e.valueUnit,valueRepresentation:e.valueRepresentation}}}else if("color"===n.type)t.color=D(n);else if("opacity"===n.type)t.opacity=_(n);else if("rotation"===n.type){const e=n;t.rotation={type:e.rotationType}}return{vvFields:s,vvRanges:t}}function _(e){const s={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const t=e.stops;for(let e=0;e<8;++e){const n=t[Math.min(e,t.length-1)];s.values[e]=n.value,s.opacities[e]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const t=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(let e=0;e<8;e++)s.values[e]=1/0,s.opacities[e]=t}}return s}function j(e,s,t){e[4*s+0]=t.r/255,e[4*s+1]=t.g/255,e[4*s+2]=t.b/255,e[4*s+3]=t.a}function D(s){if(e(s))return null;if(s.normalizationField)return null;const t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof s.field){if(!s.stops)return null;{if(s.stops.length>8)return null;t.field=s.field;const e=s.stops;for(let s=0;s<8;++s){const n=e[Math.min(s,e.length-1)];t.values[s]=n.value,j(t.colors,s,n.color)}}}else{if(!(s.stops&&s.stops.length>=0))return null;{const e=s.stops&&s.stops.length>=0&&s.stops[0].color;for(let s=0;s<8;s++)t.values[s]=1/0,j(t.colors,s,e)}}for(let e=0;e<32;e+=4)a(t.colors,e,!0);return t}export{p as D,f as a,m as b,d as c,y as d,z as e,S as f,v as g,h,g as i,c as j,l as k,x as l,u as p};
