/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{i as e,b as n,o as r}from"../core/lang.js";import{s as t,g as s,b as o}from"./screenUtils.js";import{b as a,m as l,l as c,s as i,d as u,f as d,g as m,a as p}from"./mathUtils.js";import{projectPoint as f}from"../geometry/projection.js";import{h as S,e as g,c as E}from"./plane.js";import{c as j}from"./ray.js";import{o as y}from"./sphere.js";import{c as x}from"./vectorStacks.js";import{d as b,a as I}from"./elevationInfoUtils.js";import{a as v}from"./ray2.js";import{n as h}from"./Intersector.js";import{T as w}from"./utils14.js";import{E as C}from"./InteractiveToolBase.js";function H(e,n){return T(e,(()=>n))}function M(e){return T(e,(e=>e.plane))}function T(r,o){const l=a(),c=a();let i=!1;return a=>{const u=o(a);if("start"===a.action){const n=t(a.screenStart,s(x.get())),o=v(r.state.camera,n,G);e(o)&&(i=S(u,o,l))}if(!i)return null;const d=t(a.screenEnd,s(x.get())),m=v(r.state.camera,d,G);return n(m)?null:S(u,m,c)?{...a,renderStart:l,renderEnd:c,plane:u,ray:m}:null}}function U(r,t,s,a=null,l=null){return function(r,t,s,a=null,l=null){let c=null;return i=>{if("start"===i.action&&(c=r.sceneIntersectionHelper.intersectElevationFromScreen(o(i.screenStart.x,i.screenStart.y),t,s,l),e(c)&&e(a)&&!f(c,c,a)))return null;if(n(c))return null;const u=r.sceneIntersectionHelper.intersectElevationFromScreen(o(i.screenEnd.x,i.screenEnd.y),t,s,l);return e(u)?e(a)&&!f(u,u,a)?null:{...i,mapStart:c,mapEnd:u}:null}}(r,s,I(t,r,s),a,l)}function P(e,n,r,t=null,s=null){return U(e,r,b(n),t,s)}function R(n,r,t,s){const o=r.toMap(n.screenStart,{include:[t]});return e(o)?P(r,t,o,s):null}function k(e,n,r){let t=null;const s=new C;return s.next(H(e,function(e,n){const r=q,t=B,s=E();e.renderCoordsHelper.worldUpAtPosition(n,r);const o=p(s,r,i(t,n,e.state.camera.eye));return p(o,o,r),g(n,o,s)}(e,n))).next(function(e,n){const r=a(),t=c(n);e.renderCoordsHelper.worldUpAtPosition(n,r);const s=a(),o=a(),p=s=>{if(i(s,s,n),y(r,s,s),"global"===e.viewingMode){c(s)*Math.sign(u(r,s))<.001-t&&i(s,d(s,r,.001),n)}return m(s,s,n),s};return e=>(e.renderStart=p(l(s,e.renderStart)),e.renderEnd=p(l(o,e.renderEnd)),e)}(e,n)).next(F(e,r)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,t=e})),e=>(t=null,s.execute(e),t)}function F(n,r){const t=n.renderCoordsHelper;return n=>{const s=t.fromRenderCoords(n.renderStart,r),o=t.fromRenderCoords(n.renderEnd,r);return e(s)&&e(o)?{...n,mapStart:s,mapEnd:o}:null}}function A(n){let r=null;return t=>{switch(t.action){case"start":r=n.disableDisplay();break;case"end":case"cancel":e(r)&&(r.remove(),r=null)}return t}}function D(s,l=null){const c=h(s.state.viewingMode);c.options.selectionMode=!0,c.options.store=0,c.options.hud=!1;const i=o(),u={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},d=a(),m=r(l,s.spatialReference),p=e=>{s.map.ground&&s.map.ground.opacity<1?u.exclude.add(w):u.exclude.delete(w),s.sceneIntersectionHelper.intersectIntersectorScreen(t(e,i),c,u);const n=c.results.min;let r;if(n.getIntersectionPoint(d))r=2===n.intersector?0:1;else{if(!c.results.ground.getIntersectionPoint(d))return null;r=0}return{location:s.renderCoordsHelper.fromRenderCoords(d,m),surfaceType:r}};let f;return r=>{if("start"===r.action){const n=p(r.screenStart);f=e(n)?n.location:null}if(n(f))return null;const t=p(r.screenEnd);return e(t)&&e(t.location)?{...r,mapStart:f,mapEnd:t.location,surfaceType:t.surfaceType}:null}}const q=a(),B=a(),G=j();export{H as a,U as b,k as c,R as d,M as e,F as f,P as g,A as h,D as s};
