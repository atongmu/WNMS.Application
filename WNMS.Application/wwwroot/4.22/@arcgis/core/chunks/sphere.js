/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
import{b as t}from"../core/lang.js";import{L as n}from"./Logger.js";import{d as r,l as s,i as e,n as o,a as i,b as a,f as c,w as u,m as f,g,E as l,j as m,s as h,M as p,N as d,e as M}from"./mathUtils.js";import{i as j,r as y}from"./mat4.js";import{c as A,f as b}from"./vec4f64.js";import{b as R}from"./ray.js";import{b as S,s as w}from"./vectorStacks.js";function x(t,n,s){const e=r(t,n)/r(t,t);return c(s,t,e)}function P(t,n){return r(t,n)/s(t)}function _(t,n){const o=r(t,n)/(s(t)*s(n));return-e(o)}function v(t,n,s){o(C,t),o(E,n);const a=r(C,E),c=e(a),u=i(C,C,E);return r(u,s)<0?2*Math.PI-c:c}const C=a(),E=a(),L=n.getLogger("esri.geometry.support.sphere");function k(){return A()}function q(t,n=k()){return u(n,t)}function O(t,n){return b(t[0],t[1],t[2],n)}function T(t){return t}function z(t){t[0]=t[1]=t[2]=t[3]=0}function I(t){return t}function N(t){return Array.isArray(t)?t[3]:t}function U(t){return Array.isArray(t)?t:Y}function V(t,n,r,s){return b(t,n,r,s)}function B(n,r,s){if(t(r))return!1;const{origin:e,direction:o}=r,i=D;i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2];const a=o[0]*o[0]+o[1]*o[1]+o[2]*o[2],c=2*(o[0]*i[0]+o[1]*i[1]+o[2]*i[2]),u=c*c-4*a*(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]-n[3]*n[3]);if(u<0)return!1;const f=Math.sqrt(u);let g=(-c-f)/(2*a);const l=(-c+f)/(2*a);return(g<0||l<g&&l>0)&&(g=l),!(g<0)&&(s&&(s[0]=e[0]+o[0]*g,s[1]=e[1]+o[1]*g,s[2]=e[2]+o[2]*g),!0)}const D=a();function F(t,n){return B(t,n,null)}function G(t,n,r){const e=S.get(),o=w.get();i(e,n.origin,n.direction);const a=N(t);i(r,e,n.origin),c(r,r,1/s(r)*a);const u=K(t,n.origin),f=_(n.origin,r);return j(o),y(o,o,f+u,e),m(r,r,o),r}function H(t,n,r){const e=h(S.get(),n,U(t)),o=c(S.get(),e,t[3]/s(e));return g(r,o,U(t))}function J(t,n){const r=h(S.get(),n,U(t)),s=p(r),e=t[3]*t[3];return Math.sqrt(Math.abs(s-e))}function K(t,n){const r=h(S.get(),n,U(t)),o=s(r),i=N(t),a=i+Math.abs(i-o);return e(i/a)}const Q=a();function W(t,n,r,s){const e=h(Q,n,U(t));switch(r){case 0:{const t=d(e,Q)[2];return M(s,-Math.sin(t),Math.cos(t),0)}case 1:{const t=d(e,Q),n=t[1],r=t[2],o=Math.sin(n);return M(s,-o*Math.cos(r),-o*Math.sin(r),Math.cos(n))}case 2:return o(s,e);default:return}}function X(t,n){const r=h(Z,n,U(t));return s(r)-t[3]}const Y=a(),Z=a(),$=Object.freeze({__proto__:null,create:k,copy:q,fromCenterAndRadius:O,wrap:T,clear:z,fromRadius:I,getRadius:N,getCenter:U,fromValues:V,elevate:function(t,n,r){return t!==r&&f(r,t),r[3]=t[3]+n,r},setExtent:function(t,n,r){return L.error("sphere.setExtent is not yet supported"),t===r?r:q(t,r)},intersectRay:B,intersectsRay:F,intersectRayClosestSilhouette:function(t,n,r){if(B(t,n,r))return r;const e=G(t,n,S.get());return g(r,n.origin,c(S.get(),n.direction,l(n.origin,e)/s(n.direction))),r},closestPointOnSilhouette:G,closestPoint:function(t,n,r){return B(t,n,r)?r:(R(n,U(t),r),H(t,r,r))},projectPoint:H,distanceToSilhouette:J,angleToSilhouette:K,axisAt:W,altitudeAt:X,setAltitudeAt:function(t,n,r,s){const e=X(t,n),o=W(t,n,2,Z),i=c(Z,o,r-e);return g(s,n,i)}});export{_ as a,I as b,G as c,k as d,J as e,O as f,U as g,v as h,B as i,N as j,V as k,z as l,q as m,F as n,x as o,P as p,$ as s,T as w};
